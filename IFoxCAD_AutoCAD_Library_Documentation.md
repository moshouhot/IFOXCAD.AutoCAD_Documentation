# IFoxCAD.AutoCAD åº“æ–‡æ¡£

## æ¦‚è¿°

IFoxCAD.AutoCAD æ˜¯ä¸€ä¸ªåŸºäº .NET çš„ AutoCAD äºŒæ¬¡å¼€å‘ç±»åº“ï¼Œæ—¨åœ¨ç®€åŒ–å’Œå¢å¼º AutoCAD åº”ç”¨ç¨‹åºå¼€å‘ã€‚è¯¥åº“æä¾›äº†ä¸°å¯Œçš„æ‰©å±•æ–¹æ³•ã€å·¥å…·ç±»å’ŒæŠ½è±¡ï¼Œä½¿å¾—ä½¿ç”¨ AutoCAD .NET API æ›´åŠ ç›´è§‚å’Œé«˜æ•ˆã€‚

### åº“ä¿¡æ¯
- **åŒ…åç§°**: IFox.CAD.ACAD
- **å½“å‰ç‰ˆæœ¬**: 0.9.6 (æˆªè‡³ 2025å¹´5æœˆ)
- **ç›®æ ‡æ¡†æ¶**:
  - .NET 8.0 (Windows 7.0+)
  - .NET Framework 4.8
- **ä¾èµ–é¡¹**: AutoCAD.NET API
- **è®¸å¯è¯**: å¼€æº
- **ä»£ç ä»“åº“**: https://gitee.com/inspirefunction/ifoxcad

### é¡¹ç›®èƒŒæ™¯

IFoxCAD é¡¹ç›®èµ·æºäºé›ªå±±é£ç‹åœ¨æ˜ç»è®ºå›å‘å¸ƒçš„å¼€æºåº“ï¼Œåç»è½é­„å±±äººæ•´ç†å’Œé‡æ„ï¼Œå½¢æˆäº†ç°åœ¨çš„ IFoxCAD ç±»åº“ã€‚é¡¹ç›®åç§°å¯“æ„ä¸º"I(çˆ±)Fox(ç‹å“¥)"ï¼Œè¡¨è¾¾å¯¹åŸä½œè€…çš„æ•¬æ„ã€‚è¯¥é¡¹ç›®å‘å¸ƒäº Inspire Functionï¼ˆä¸­æ–‡åï¼šè·ƒåŠ¨æ–¹ç¨‹ï¼‰ç»„ç»‡ä¸‹ã€‚

## æ ¸å¿ƒåŠŸèƒ½

### 1. **ç©ºé—´æ•°æ®ç»“æ„**
- **å››å‰æ ‘å®ç°**: é«˜æ€§èƒ½çš„ CAD å®ä½“ç©ºé—´ç´¢å¼•
- **ç¢°æ’æ£€æµ‹**: å…ˆè¿›çš„å®ä½“ç›¸äº¤å’Œé‚»è¿‘æ£€æµ‹ç®—æ³•
- **ç©ºé—´æŸ¥è¯¢**: é«˜æ•ˆçš„èŒƒå›´æŸ¥è¯¢å’Œæœ€è¿‘é‚»æœç´¢

### 2. **å®ä½“ç®¡ç†**
- **æ•°æ®åº“æ‰©å±•**: ç®€åŒ–çš„æ•°æ®åº“æ“ä½œå’Œäº‹åŠ¡å¤„ç†
- **å®ä½“æ‰©å±•**: ä¸°å¯Œçš„ AutoCAD å®ä½“æ‰©å±•æ–¹æ³•
- **é›†åˆå·¥å…·**: å¢å¼ºçš„é›†åˆå¤„ç†å’Œæ“ä½œåŠŸèƒ½

### 3. **å‡ ä½•å·¥å…·**
- **çŸ©å½¢æ“ä½œ**: å…¨é¢çš„çŸ©å½¢/åŒ…å›´ç›’å·¥å…·
- **ç‚¹å¤„ç†**: 2D/3D ç‚¹æ“ä½œï¼Œæ”¯æŒå®¹å·®å¤„ç†
- **å‡ ä½•è®¡ç®—**: å‘é‡è¿ç®—ã€å‰ç§¯å’Œç©ºé—´å…³ç³»è®¡ç®—

### 4. **ç¼–è¾‘å™¨å’ŒUIæ‰©å±•**
- **é€‰æ‹©å·¥å…·**: å¢å¼ºçš„å®ä½“é€‰æ‹©æ–¹æ³•
- **ç”¨æˆ·è¾“å…¥**: ç®€åŒ–çš„ç”¨æˆ·äº¤äº’å’Œè¾“å…¥å¤„ç†
- **å‘½ä»¤è¡Œæ‰©å±•**: ä¸°å¯Œçš„å‘½ä»¤è¡Œç•Œé¢å·¥å…·

### 5. **æ•°æ®ç®¡ç†**
- **æ‰©å±•æ•°æ® (XData)**: ç®€åŒ–çš„æ‰©å±•æ•°æ®æ“ä½œ
- **å­—å…¸æ“ä½œ**: å¢å¼ºçš„æ•°æ®åº“å­—å…¸å¤„ç†
- **ç¼–ç»„ç®¡ç†**: å®ä½“åˆ†ç»„å’Œç»„ç»‡å·¥å…·

## ğŸ“‹ æ–‡æ¡£ç›®å½•

### ğŸš€ [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [å®‰è£…å’Œé…ç½®](#å®‰è£…å’Œé…ç½®)
- [åŸºæœ¬ä½¿ç”¨](#åŸºæœ¬ä½¿ç”¨)
- [Hello Worldç¤ºä¾‹](#hello-worldç¤ºä¾‹)

### ğŸ—ï¸ [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
- [äº‹åŠ¡ç®¡ç† (DBTrans)](#äº‹åŠ¡ç®¡ç†-dbtrans)
- [æ•°æ®åº“æ‰©å±• (DatabaseEx)](#æ•°æ®åº“æ‰©å±•-databaseex)
- [æ–‡æ¡£é”ç®¡ç†](#æ–‡æ¡£é”ç®¡ç†)
- [DWGæ–‡ä»¶æ ‡è®°](#dwgæ–‡ä»¶æ ‡è®°)

### ğŸ“ [å®ä½“æ“ä½œ](#å®ä½“æ“ä½œ)
- [å®ä½“æ‰©å±• (EntityEx)](#å®ä½“æ“ä½œ-entityex)
- [å¡«å……æ‰©å±• (HatchEx)](#å¡«å……æ‰©å±•-hatchex)
- [å‡ ä½•è®¡ç®—](#å‡ ä½•è®¡ç®—)
- [å®ä½“åˆ›å»ºå’Œç¼–è¾‘](#å®ä½“åˆ›å»ºå’Œç¼–è¾‘)

### ğŸ–±ï¸ [ç”¨æˆ·äº¤äº’](#ç”¨æˆ·äº¤äº’)
- [ç¼–è¾‘å™¨æ‰©å±• (EditorEx)](#ç¼–è¾‘å™¨æ‰©å±•-editorex)
- [é€‰æ‹©é›†æ‰©å±• (SelectionSetEx)](#é€‰æ‹©é›†æ‰©å±•-selectionsetex)
- [å¤¹ç‚¹æ“ä½œ (JigEx)](#å¤¹ç‚¹æ“ä½œ-jigex)
- [ç”¨æˆ·è¾“å…¥å¤„ç†](#ç”¨æˆ·è¾“å…¥å¤„ç†)

### ğŸ” [ç©ºé—´æ•°æ®ç»“æ„](#ç©ºé—´æ•°æ®ç»“æ„)
- [å››å‰æ ‘ (QuadTree)](#å››å‰æ ‘-quadtree)
- [ç©ºé—´æŸ¥è¯¢å’Œç´¢å¼•](#ç©ºé—´æŸ¥è¯¢å’Œç´¢å¼•)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)

### ğŸ“ [æ–‡ä»¶å’Œæ•°æ®å¤„ç†](#æ–‡ä»¶å’Œæ•°æ®å¤„ç†)
- [PEæ–‡ä»¶åˆ†æ](#peæ–‡ä»¶åˆ†æ)
- [å…³è”åŠŸèƒ½](#å…³è”åŠŸèƒ½)
- [æ•°æ®è½¬æ¢](#æ•°æ®è½¬æ¢)

### ğŸ› ï¸ [å·¥å…·ç±»å’Œæ‰©å±•](#å·¥å…·ç±»å’Œæ‰©å±•)
- [IFoxCAD.Basalå‘½åç©ºé—´](#ifoxcadbasal-å‘½åç©ºé—´)
- [æ•°ç»„å’ŒLINQæ‰©å±•](#arrayex-æ•°ç»„æ‰©å±•ç±»)
- [ç¯é“¾è¡¨ (LoopList)](#looplist-ç¯é“¾è¡¨ç±»)
- [ç³»ç»ŸAPIå°è£…](#pinvokeuser32-ç³»ç»Ÿapiå°è£…ç±»)
- [è°ƒè¯•å’ŒéªŒè¯å·¥å…·](#debugex-è°ƒè¯•å·¥å…·ç±»)

### âš ï¸ [é”™è¯¯å¤„ç†](#é”™è¯¯å¤„ç†)
- [CADé”™è¯¯ä¿¡æ¯](#cadé”™è¯¯ä¿¡æ¯å¤„ç†-errorinfoex)
- [å¼‚å¸¸å¤„ç†æœºåˆ¶](#å¼‚å¸¸å¤„ç†æœºåˆ¶)
- [è°ƒè¯•å’Œè¯Šæ–­](#è°ƒè¯•å’Œè¯Šæ–­)

### ğŸ“Š [æšä¸¾å’Œå¸¸é‡](#æšä¸¾å’Œå¸¸é‡å®šä¹‰)
- [æ“ä½œæ¨¡å¼æšä¸¾](#æ“ä½œæ¨¡å¼æšä¸¾)
- [ç³»ç»Ÿé…ç½®æšä¸¾](#ç³»ç»Ÿé…ç½®æšä¸¾)
- [é”™è¯¯å’ŒçŠ¶æ€æšä¸¾](#é”™è¯¯å’ŒçŠ¶æ€æšä¸¾)
- [UIå’Œäº¤äº’æšä¸¾](#uiå’Œäº¤äº’æšä¸¾)
- [å¸¸é‡å’Œé…ç½®é¡¹](#å¸¸é‡å’Œé…ç½®é¡¹)

### ğŸ“š [APIå‚è€ƒæ‰‹å†Œ](#api-å‚è€ƒæ‰‹å†Œ)
- [IFoxCAD.Cadå‘½åç©ºé—´](#ifoxcadcad-å‘½åç©ºé—´)
- [IFoxCAD.Basalå‘½åç©ºé—´](#ifoxcadbasal-å‘½åç©ºé—´-1)
- [å¿«é€ŸæŸ¥æ‰¾ç´¢å¼•](#å¿«é€ŸæŸ¥æ‰¾ç´¢å¼•)

### ğŸ’¡ [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [æ€§èƒ½ä¼˜åŒ–å»ºè®®](#æ€§èƒ½ä¼˜åŒ–å»ºè®®)
- [å†…å­˜ç®¡ç†](#å†…å­˜ç®¡ç†)
- [é”™è¯¯å¤„ç†ç­–ç•¥](#é”™è¯¯å¤„ç†ç­–ç•¥)
- [ä»£ç ç»„ç»‡](#ä»£ç ç»„ç»‡)

---

## å¿«é€Ÿå¼€å§‹

### å®‰è£…å’Œé…ç½®

### ä½¿ç”¨åŒ…ç®¡ç†å™¨æ§åˆ¶å°
```powershell
Install-Package IFox.CAD.ACAD -Version 0.9.6
```

### ä½¿ç”¨ .NET CLI
```bash
dotnet add package IFox.CAD.ACAD --version 0.9.6
```

### ä½¿ç”¨ PackageReference
```xml
<PackageReference Include="IFox.CAD.ACAD" Version="0.9.6" />
```

### æ”¯æŒçš„æ¡†æ¶å’Œä¾èµ–é¡¹

**æ”¯æŒçš„æ¡†æ¶:**
- .NET 8.0 (Windows 7.0+)
- .NET Framework 4.8

**å¿…éœ€ä¾èµ–é¡¹:**
- **AutoCAD.NET**:
  - .NET Framework 4.8 éœ€è¦ç‰ˆæœ¬ >= 20.0.0
  - .NET 8.0 éœ€è¦ç‰ˆæœ¬ >= 25.0.1
- **IndexRange**: >= 1.0.3 (ä»… .NET Framework 4.8)

**å…¼å®¹çš„ AutoCAD ç‰ˆæœ¬:**
- AutoCAD 2018 åŠæ›´é«˜ç‰ˆæœ¬
- å…¼å®¹ ZwCAD å’Œå…¶ä»– AutoCAD å…¼å®¹å¹³å°

## æ ¸å¿ƒç±»å’Œå‘½åç©ºé—´

### IFoxCAD.Cad å‘½åç©ºé—´

ä¸»è¦çš„ CAD åŠŸèƒ½å‘½åç©ºé—´ï¼ŒåŒ…å«æ‰€æœ‰æ ¸å¿ƒæ‰©å±•ç±»å’Œå·¥å…·ã€‚

#### å››å‰æ ‘ç³»ç»Ÿ
- **QuadTree<T>**: ç©ºé—´ç´¢å¼•çš„æ ¹èŠ‚ç‚¹æ§åˆ¶å™¨
- **QuadTreeNode<T>**: å››å‰æ ‘ç»“æ„ä¸­çš„å•ä¸ªèŠ‚ç‚¹
- **QuadEntity**: å¯åœ¨å››å‰æ ‘ä¸­ç´¢å¼•çš„å®ä½“åŸºç±»
- **QuadTreeEvn**: å››å‰æ ‘æ“ä½œçš„ç¯å¢ƒå˜é‡å’Œé…ç½®

#### å‡ ä½•ç±»
- **Rect**: å…·æœ‰ç©ºé—´æ“ä½œçš„ç»¼åˆçŸ©å½¢ç±»
- **BulgeVertexWidth**: å¤šæ®µçº¿é¡¶ç‚¹æ•°æ®ï¼ŒåŒ…å«å‡¸åº¦å’Œå®½åº¦ä¿¡æ¯
- **TolerancePoint2d**: ç”¨äºå»é‡çš„å®¹å·®ç‚¹æ¯”è¾ƒ

#### æ‰©å±•ç±»
- **BaseEx**: åŸºç¡€æ‰©å±•å·¥å…·
- **CollectionEx**: é›†åˆæ“ä½œæ‰©å±•
- **DatabaseEx**: æ•°æ®åº“æ“ä½œæ‰©å±•
- **DBDictionaryEx**: å­—å…¸æ“ä½œæ‰©å±•
- **DBObjectEx**: æ•°æ®åº“å¯¹è±¡æ‰©å±•
- **DBTransEx**: äº‹åŠ¡æ‰©å±•
- **EditorEx**: ç¼–è¾‘å™¨å’Œé€‰æ‹©æ‰©å±•

### IFoxCAD.Cad.Assoc å‘½åç©ºé—´

å…³è”å¯¹è±¡ç›¸å…³åŠŸèƒ½ï¼Œç”¨äºå¤„ç† AutoCAD çš„å…³è”æ€§åŠŸèƒ½å’Œå­å®ä½“ç®¡ç†ã€‚

#### å…³è”å­å®ä½“æ‰©å±• (AssocPersSubentityIdPEEx)

ç”¨äºç®¡ç†å’ŒæŸ¥è¯¢AutoCADå®ä½“çš„å­å¯¹è±¡å…³ç³»ï¼Œæä¾›ä¸ªæ€§åŒ–å­å®ä½“IDçš„è·å–å’Œæ“ä½œåŠŸèƒ½ã€‚

**ä¸»è¦æ–¹æ³•ï¼š**

**GetPersSubentityIdPE æ–¹æ³•ï¼š**
```csharp
public static AssocPersSubentityIdPE GetPersSubentityIdPE(Entity entity)
```
- **å‚æ•°ï¼š** `entity` - è¦æŸ¥è¯¢çš„å®ä½“
- **è¿”å›å€¼ï¼š** ä¸ªæ€§åŒ–å­å¯¹è±¡å…³ç³»Idå®ä¾‹ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›null
- **ç”¨é€”ï¼š** è·å–å®ä½“çš„å…³è”æ€§æ‰©å±•æ¥å£

**GetAllSubentityIds æ–¹æ³•ï¼š**
```csharp
public static SubentityId[] GetAllSubentityIds(Entity entity, SubentityType subentityType)
```
- **å‚æ•°ï¼š**
  - `entity` - è¦æŸ¥è¯¢çš„å®ä½“
  - `subentityType` - å­å¯¹è±¡çš„ç±»å‹ï¼ˆFaceã€Edgeã€Vertexç­‰ï¼‰
- **è¿”å›å€¼ï¼š** æ‰€æœ‰æŒ‡å®šç±»å‹çš„å­å¯¹è±¡Idæ•°ç»„
- **ç”¨é€”ï¼š** æ‰¹é‡è·å–ç‰¹å®šç±»å‹çš„å­å®ä½“ID

**GetAllSubentities æ–¹æ³•ï¼š**
```csharp
public static List<Subentity> GetAllSubentities(Entity entity, SubentityType subentityType)
```
- **å‚æ•°ï¼š**
  - `entity` - è¦æŸ¥è¯¢çš„å®ä½“
  - `subentityType` - å­å¯¹è±¡çš„ç±»å‹
- **è¿”å›å€¼ï¼š** æ‰€æœ‰æŒ‡å®šç±»å‹çš„å­å¯¹è±¡åˆ—è¡¨
- **ç”¨é€”ï¼š** è·å–å­å®ä½“å¯¹è±¡çš„å®Œæ•´ä¿¡æ¯

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// è·å–å®ä½“çš„æ‰€æœ‰é¢å­å®ä½“
var solid = // è·å–3Då®ä½“
var faceIds = AssocPersSubentityIdPEEx.GetAllSubentityIds(solid, SubentityType.Face);
Console.WriteLine($"å®ä½“åŒ…å« {faceIds.Length} ä¸ªé¢");

// è·å–è¾¹å­å®ä½“
var edgeSubentities = AssocPersSubentityIdPEEx.GetAllSubentities(solid, SubentityType.Edge);
foreach (var edge in edgeSubentities)
{
    // å¤„ç†æ¯ä¸ªè¾¹å­å®ä½“
    Console.WriteLine($"è¾¹å­å®ä½“ID: {edge.SubentityId}");
}

// æ£€æŸ¥å®ä½“æ˜¯å¦æ”¯æŒå…³è”æ€§
var persIdPE = AssocPersSubentityIdPEEx.GetPersSubentityIdPE(solid);
if (persIdPE != null)
{
    Console.WriteLine("å®ä½“æ”¯æŒå…³è”æ€§åŠŸèƒ½");
}
```

#### å…³è”åŠ¨ä½œå·¥å…· (AssocUtils)

æä¾›AutoCADå…³è”æ€§ç³»ç»Ÿçš„é«˜çº§å·¥å…·æ–¹æ³•ï¼Œç”¨äºåˆ›å»ºå’Œç®¡ç†å…³è”åŠ¨ä½œã€‚

**ä¸»è¦æ–¹æ³•ï¼š**

**CreateActionAndActionBodyAndPostToDatabase æ–¹æ³•ï¼š**
```csharp
public static ErrorStatus CreateActionAndActionBodyAndPostToDatabase(
    RXClass actionBodyClass,
    ObjectId ownerId,
    out ObjectId actionId,
    out ObjectId actionBodyId)
```
- **å‚æ•°ï¼š**
  - `actionBodyClass` - actionBodyçš„RXClassç±»å‹
  - `ownerId` - æ‹¥æœ‰è€…å¯¹è±¡ID
  - `actionId` - è¾“å‡ºçš„åŠ¨ä½œID
  - `actionBodyId` - è¾“å‡ºçš„åŠ¨ä½œä½“ID
- **è¿”å›å€¼ï¼š** æ“ä½œç»“æœçš„é”™è¯¯çŠ¶æ€
- **ç”¨é€”ï¼š** æ›¿ä»£åŸç”Ÿçš„AssocActionBody.CreateActionAndActionBodyAndPostToDatabase()æ–¹æ³•

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// åˆ›å»ºå…³è”åŠ¨ä½œ
using (var tr = new DBTrans())
{
    var ownerObject = // è·å–æ‹¥æœ‰è€…å¯¹è±¡
    var actionBodyClass = // è·å–åŠ¨ä½œä½“ç±»å‹

    var result = AssocUtils.CreateActionAndActionBodyAndPostToDatabase(
        actionBodyClass,
        ownerObject.ObjectId,
        out ObjectId actionId,
        out ObjectId actionBodyId);

    if (result == ErrorStatus.OK)
    {
        Console.WriteLine($"å…³è”åŠ¨ä½œåˆ›å»ºæˆåŠŸ: Action={actionId}, Body={actionBodyId}");
        tr.Commit();
    }
    else
    {
        Console.WriteLine($"åˆ›å»ºå¤±è´¥: {result}");
    }
}
```

**é«˜çº§åº”ç”¨åœºæ™¯ï¼š**
```csharp
// æ‰¹é‡å¤„ç†å®ä½“çš„å­å¯¹è±¡
public void ProcessEntitySubentities(Entity entity)
{
    // è·å–æ‰€æœ‰ç±»å‹çš„å­å®ä½“
    var faces = AssocPersSubentityIdPEEx.GetAllSubentities(entity, SubentityType.Face);
    var edges = AssocPersSubentityIdPEEx.GetAllSubentities(entity, SubentityType.Edge);
    var vertices = AssocPersSubentityIdPEEx.GetAllSubentities(entity, SubentityType.Vertex);

    Console.WriteLine($"å®ä½“åˆ†æç»“æœ:");
    Console.WriteLine($"  é¢æ•°é‡: {faces.Count}");
    Console.WriteLine($"  è¾¹æ•°é‡: {edges.Count}");
    Console.WriteLine($"  é¡¶ç‚¹æ•°é‡: {vertices.Count}");

    // æ£€æŸ¥å…³è”æ€§æ”¯æŒ
    var persIdPE = AssocPersSubentityIdPEEx.GetPersSubentityIdPE(entity);
    if (persIdPE != null)
    {
        Console.WriteLine("  æ”¯æŒå…³è”æ€§åŠŸèƒ½");
    }
}
```

### IFoxCAD.Basal å‘½åç©ºé—´

åŸºç¡€å·¥å…·ç±»å‘½åç©ºé—´ï¼Œæä¾›é€šç”¨çš„æ‰©å±•æ–¹æ³•å’Œå·¥å…·å‡½æ•°ã€‚

**æ ¸å¿ƒå·¥å…·ç±»ï¼š**
- `ArrayEx` - æ•°ç»„æ‰©å±•ç±»
- `DebugEx` - è°ƒè¯•å·¥å…·
- `EnumEx` - æšä¸¾æ‰©å±•
- `LinqEx` - LINQ æ‰©å±•ç±»
- `SystemEx` - ç³»ç»Ÿæ‰©å±•
- `RandomEx` - éšæœºå€¼æ‰©å±•ç±»

**æ•°æ®ç»“æ„ï¼š**
- `LoopList<T>` - ç¯é“¾è¡¨
- `LoopListNode<T>` - ç¯é“¾è¡¨èŠ‚ç‚¹
- `LoopState` - æ§åˆ¶å¾ªç¯ç»“æŸ
- `ProState` - æ§åˆ¶ç¨‹åºæµç¨‹

**ç³»ç»ŸAPIï¼š**
- `PInvokeUser32` - User32 API å°è£…
- `WindowsAPI` - Windows API å·¥å…·
- `HookType` - é’©å­ç±»å‹æšä¸¾
- `WM` - æ¶ˆæ¯ç±»å‹

**å‚æ•°éªŒè¯ï¼š**
- `ArgumentNullEx` - å‚æ•°nullæ£€æŸ¥ç±»

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬å®ä½“é€‰æ‹©
```csharp
using IFoxCAD.Cad;

// å¢å¼ºçš„å®ä½“é€‰æ‹©
var entities = editor.SelectAtPoint(point);
var filteredEntities = editor.SelectByFilter(filter);
```

### å››å‰æ ‘ç©ºé—´ç´¢å¼•
```csharp
// åˆ›å»ºç”¨äºç©ºé—´ç´¢å¼•çš„å››å‰æ ‘
var bounds = new Rect(0, 0, 1000, 1000);
var quadTree = new QuadTree<QuadEntity>(bounds);

// æ’å…¥å®ä½“
quadTree.Insert(entity);

// æŸ¥è¯¢åŒºåŸŸå†…çš„å®ä½“
var results = quadTree.Query(queryRect, QuadTreeSelectMode.IntersectsWith);
```

### æ•°æ®åº“æ“ä½œ
```csharp
// ç®€åŒ–çš„æ•°æ®åº“æ“ä½œ
using (var tr = db.TransactionManager.StartTransaction())
{
    var blockTable = tr.GetObject(db.BlockTableId, OpenMode.ForRead) as BlockTable;
    // å¢å¼ºçš„æ“ä½œ...
    tr.Commit();
}
```

### äº‹åŠ¡ç®¡ç† (DBTrans)
```csharp
// ä½¿ç”¨ DBTrans è¿›è¡Œäº‹åŠ¡æ“ä½œ
using var tr = new DBTrans();
var line = new Line(Point3d.Origin, new Point3d(100, 100, 0));
tr.CurrentSpace.AddEntity(line);
tr.Commit();
```

### å¡«å……æ“ä½œ
```csharp
// åˆ›å»ºå¡«å……
var hatchInfo = new HatchInfo
{
    PatternName = "SOLID",
    PatternScale = 1.0,
    BoundaryIds = boundaryEntityIds
};

using var tr = new DBTrans();
var hatch = hatchInfo.CreateHatch();
tr.CurrentSpace.AddEntity(hatch);
tr.Commit();
```

### ç¬¦å·è¡¨ç®¡ç†
```csharp
// æ·»åŠ å›¾å±‚
using var tr = new DBTrans();
var layerTable = tr.LayerTable;
layerTable.Add("NewLayer", Color.FromColorIndex(ColorMethod.ByAci, 1));

// æ·»åŠ æ–‡å­—æ ·å¼
var textStyleTable = tr.TextStyleTable;
textStyleTable.Add("NewStyle", "arial.ttf", 2.5);
```

### å¤–éƒ¨å‚ç…§æ“ä½œ
```csharp
// åŠ è½½å¤–éƒ¨å‚ç…§
using var tr = new DBTrans();
var xrefFactory = tr.XrefFactory(XrefModes.Attach, null);
xrefFactory.AttachXref("drawing.dwg", "XrefBlock", Point3d.Origin);
```

## ä¸»è¦åŠŸèƒ½æ¨¡å—è¯¦è§£

### 1. æ•°æ®ç»“æ„å’Œç®—æ³•

#### å››å‰æ ‘ (QuadTree)

é«˜æ•ˆçš„ç©ºé—´æ•°æ®ç»“æ„ï¼Œç”¨äºå¿«é€ŸæŸ¥è¯¢å’Œç¢°æ’æ£€æµ‹ã€‚

**æ ¸å¿ƒç±»ï¼š**
- `QuadTree<TEntity>` - å››å‰æ ‘æ ¹èŠ‚ç‚¹æ§åˆ¶å™¨
- `QuadTreeNode<TEntity>` - å››å‰æ ‘å­èŠ‚ç‚¹
- `QuadEntity` - å››å‰æ ‘å›¾å…ƒ
- `QuadTreeEvn` - å››å‰æ ‘ç¯å¢ƒå˜é‡

#### QuadTree<T> ç±»è¯¦ç»†æ–¹æ³•

**æ„é€ å‡½æ•°ï¼š**
```csharp
public QuadTree(Rect rect)
```
- **å‚æ•°ï¼š** `rect` - å››å‰æ ‘çš„çŸ©å½¢èŒƒå›´
- **ç”¨é€”ï¼š** åˆ›å»ºå››å‰æ ‘æ ¹èŠ‚ç‚¹æ§åˆ¶å™¨

**Insert æ–¹æ³•ï¼š**
```csharp
public void Insert(T ent)
```
- **å‚æ•°ï¼š** `ent` - è¦æ’å…¥çš„æ•°æ®é¡¹
- **ç”¨é€”ï¼š** é€šè¿‡æ ¹èŠ‚ç‚¹æ’å…¥æ•°æ®é¡¹åˆ°å››å‰æ ‘ä¸­

**Query æ–¹æ³•ï¼š**
```csharp
public List<T> Query(Rect rect, QuadTreeSelectMode selectMode)
```
- **å‚æ•°ï¼š**
  - `rect` - çŸ©å½¢é€‰åŒºæŸ¥è¯¢èŒƒå›´
  - `selectMode` - æŸ¥è¯¢æ¨¡å¼ï¼ˆIntersectsWith/Containsï¼‰
- **è¿”å›å€¼ï¼š** æŸ¥è¯¢ç»“æœåˆ—è¡¨
- **ç”¨é€”ï¼š** æŸ¥è¯¢å››å‰æ ‘ï¼Œè¿”å›ç»™å®šåŒºåŸŸçš„æ•°æ®é¡¹

**Remove æ–¹æ³•é‡è½½ï¼š**
```csharp
// æ ¹æ®èŒƒå›´åˆ é™¤
public void Remove(Rect rect)

// æ ¹æ®å›¾å…ƒåˆ é™¤
public void Remove(T ent)
```
- **å‚æ•°ï¼š**
  - `rect` - è¦åˆ é™¤çš„çŸ©å½¢èŒƒå›´
  - `ent` - è¦åˆ é™¤çš„å›¾å…ƒ
- **ç”¨é€”ï¼š** åˆ é™¤æŒ‡å®šèŒƒå›´æˆ–å›¾å…ƒçš„å­èŠ‚ç‚¹

**FindNeibor æ–¹æ³•ï¼š**
```csharp
public List<T> FindNeibor(Rect rect, QuadTreeFindMode findMode)
```
- **å‚æ•°ï¼š**
  - `rect` - æŸ¥æ‰¾çš„çŸ©å½¢åŒºåŸŸ
  - `findMode` - æŸ¥æ‰¾æ–¹å‘æ¨¡å¼ï¼ˆLeft/Right/Top/Bottomç­‰ï¼‰
- **è¿”å›å€¼ï¼š** é™„è¿‘èŠ‚ç‚¹å›¾å…ƒåˆ—è¡¨
- **ç”¨é€”ï¼š** æ‰¾åˆ°æŒ‡å®šæ–¹å‘çš„é™„è¿‘èŠ‚ç‚¹å›¾å…ƒ

**FindNearEntity æ–¹æ³•ï¼š**
```csharp
public List<T> FindNearEntity(Rect rect)
```
- **å‚æ•°ï¼š** `rect` - æŸ¥æ‰¾çš„çŸ©å½¢åŒºåŸŸ
- **è¿”å›å€¼ï¼š** é™„è¿‘å›¾å…ƒåˆ—è¡¨
- **ç”¨é€”ï¼š** æ‰¾åˆ°é™„è¿‘çš„æ‰€æœ‰å›¾å…ƒ

**ForEach æ–¹æ³•ï¼š**
```csharp
public void ForEach(QTAction action)
```
- **å‚æ•°ï¼š** `action` - è¦æ‰§è¡Œçš„æ“ä½œå§”æ‰˜
- **ç”¨é€”ï¼š** å¯¹å››å‰æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œç‰¹å®šæ“ä½œ

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

**åŸºæœ¬å››å‰æ ‘æ“ä½œï¼š**
```csharp
// åˆ›å»ºå››å‰æ ‘
var boundary = new Rect(0, 0, 1000, 1000);
var quadTree = new QuadTree<Entity>(boundary);

// æ’å…¥å®ä½“
using (var tr = new DBTrans())
{
    var entities = tr.CurrentSpace.GetEntities<Entity>();
    foreach (var entity in entities)
    {
        quadTree.Insert(entity);
    }
}

// æŸ¥è¯¢æŒ‡å®šåŒºåŸŸçš„å®ä½“
var queryRect = new Rect(100, 100, 200, 200);
var foundEntities = quadTree.Query(queryRect, QuadTreeSelectMode.IntersectsWith);
Console.WriteLine($"æ‰¾åˆ° {foundEntities.Count} ä¸ªç›¸äº¤çš„å®ä½“");

// æŸ¥è¯¢å®Œå…¨åŒ…å«åœ¨åŒºåŸŸå†…çš„å®ä½“
var containedEntities = quadTree.Query(queryRect, QuadTreeSelectMode.Contains);
Console.WriteLine($"æ‰¾åˆ° {containedEntities.Count} ä¸ªå®Œå…¨åŒ…å«çš„å®ä½“");
```

**é‚»è¿‘æŸ¥æ‰¾ç¤ºä¾‹ï¼š**
```csharp
// æŸ¥æ‰¾é™„è¿‘çš„å®ä½“
var searchRect = new Rect(500, 500, 50, 50);
var nearEntities = quadTree.FindNearEntity(searchRect);
Console.WriteLine($"é™„è¿‘æ‰¾åˆ° {nearEntities.Count} ä¸ªå®ä½“");

// æŸ¥æ‰¾ç‰¹å®šæ–¹å‘çš„é‚»å±…
var leftNeighbors = quadTree.FindNeibor(searchRect, QuadTreeFindMode.Left);
var rightNeighbors = quadTree.FindNeibor(searchRect, QuadTreeFindMode.Right);
var topNeighbors = quadTree.FindNeibor(searchRect, QuadTreeFindMode.Top);
var bottomNeighbors = quadTree.FindNeibor(searchRect, QuadTreeFindMode.Bottom);

Console.WriteLine($"å·¦ä¾§é‚»å±…: {leftNeighbors.Count}");
Console.WriteLine($"å³ä¾§é‚»å±…: {rightNeighbors.Count}");
Console.WriteLine($"ä¸Šæ–¹é‚»å±…: {topNeighbors.Count}");
Console.WriteLine($"ä¸‹æ–¹é‚»å±…: {bottomNeighbors.Count}");
```

**åˆ é™¤å’Œéå†æ“ä½œï¼š**
```csharp
// åˆ é™¤æŒ‡å®šåŒºåŸŸçš„æ‰€æœ‰å®ä½“
var deleteRect = new Rect(200, 200, 100, 100);
quadTree.Remove(deleteRect);

// åˆ é™¤ç‰¹å®šå®ä½“
var entityToRemove = foundEntities.FirstOrDefault();
if (entityToRemove != null)
{
    quadTree.Remove(entityToRemove);
}

// éå†æ‰€æœ‰èŠ‚ç‚¹å¹¶æ‰§è¡Œæ“ä½œ
quadTree.ForEach((node, entities) =>
{
    Console.WriteLine($"èŠ‚ç‚¹åŒ…å« {entities.Count} ä¸ªå®ä½“");
    // å¯¹æ¯ä¸ªå®ä½“æ‰§è¡Œæ“ä½œ
    foreach (var entity in entities)
    {
        Console.WriteLine($"  å®ä½“ID: {entity.ObjectId}");
    }
});
```

#### çŸ©å½¢ç±» (Rect)

æä¾›çŸ©å½¢æ“ä½œçš„å®Œæ•´åŠŸèƒ½é›†ã€‚

**ä¸»è¦å±æ€§ï¼š**
- X, Y, Left, Right, Top, Bottom, Width, Height, Area
- MinPoint, MaxPoint, CenterPointï¼ˆå‡ ä½•ç‚¹ï¼‰

**ä¸»è¦åŠŸèƒ½ï¼š**
- çŸ©å½¢åˆ›å»ºå’Œæ“ä½œ
- åŒ…å«å…³ç³»æ£€æµ‹
- ç¢°æ’æ£€æµ‹
- ç‚¹ç§¯å’Œå‰ç§¯è®¡ç®—
- åˆ—æ‰«ç¢°æ’æ£€æµ‹ç®—æ³•

### 2. æ•°æ®åº“æ“ä½œ

#### äº‹åŠ¡ç®¡ç† (DBTrans)

ç®€åŒ–çš„äº‹åŠ¡æ“ä½œå°è£…ï¼Œæä¾›æ›´ä¾¿æ·çš„æ•°æ®åº“è®¿é—®æ–¹å¼å’Œäº‹åŠ¡æ ˆç®¡ç†ã€‚

**æ ¸å¿ƒç±»ï¼š**
- `DBTrans` - äº‹åŠ¡æ ˆç®¡ç†
- `DatabaseEx` - æ•°æ®åº“æ‰©å±•æ–¹æ³•
- `SwitchDatabase` - è‡ªåŠ¨åˆ‡æ¢æ´»åŠ¨æ•°æ®åº“

#### DBTrans ç±»è¯¦ç»†æ–¹æ³•

**é™æ€æ–¹æ³•ï¼š**

**GetTopTransaction æ–¹æ³•ï¼š**
```csharp
public static Transaction GetTopTransaction(Database database)
```
- **å‚æ•°ï¼š** `database` - ç›®æ ‡æ•°æ®åº“
- **è¿”å›å€¼ï¼š** é¡¶å±‚äº‹åŠ¡å¯¹è±¡
- **ç”¨é€”ï¼š** è·å–æŒ‡å®šæ•°æ®åº“çš„å½“å‰é¡¶å±‚äº‹åŠ¡

**GetTop æ–¹æ³•ï¼š**
```csharp
public static DBTrans GetTop(Database database)
```
- **å‚æ•°ï¼š** `database` - ç›®æ ‡æ•°æ®åº“
- **è¿”å›å€¼ï¼š** é¡¶å±‚DBTransäº‹åŠ¡å¯¹è±¡
- **å¼‚å¸¸ï¼š** å‚æ•°ä¸ºnullæ—¶æŠ›å‡º `ArgumentNullEx`
- **ç”¨é€”ï¼š** è·å–æŒ‡å®šæ•°æ®åº“çš„é¡¶å±‚DBTransäº‹åŠ¡

**æ„é€ å‡½æ•°é‡è½½ï¼š**

**æ–‡æ¡£æ„é€ å‡½æ•°ï¼š**
```csharp
public DBTrans(Document doc, bool commit = true, bool docLock = false)
```
- **å‚æ•°ï¼š**
  - `doc` - è¦æ‰“å¼€çš„æ–‡æ¡£
  - `commit` - æ˜¯å¦è‡ªåŠ¨æäº¤äº‹åŠ¡ï¼ˆé»˜è®¤trueï¼‰
  - `docLock` - æ˜¯å¦é”å®šæ–‡æ¡£ï¼ˆé»˜è®¤falseï¼‰
- **ç”¨é€”ï¼š** åŸºäºæ–‡æ¡£åˆ›å»ºäº‹åŠ¡ï¼Œæ”¯æŒæ–‡æ¡£é”å®š

**æ•°æ®åº“æ„é€ å‡½æ•°ï¼š**
```csharp
public DBTrans(Database database, bool commit = true)
```
- **å‚æ•°ï¼š**
  - `database` - è¦æ‰“å¼€çš„æ•°æ®åº“
  - `commit` - æ˜¯å¦è‡ªåŠ¨æäº¤äº‹åŠ¡ï¼ˆé»˜è®¤trueï¼‰
- **ç”¨é€”ï¼š** åŸºäºæ•°æ®åº“åˆ›å»ºäº‹åŠ¡

**æ–‡ä»¶æ„é€ å‡½æ•°ï¼š**
```csharp
public DBTrans(string fileName, bool commit = true, FileOpenMode fileOpenMode = FileOpenMode.OpenForReadAndAllShare, string password = "", bool docLock = false)
```
- **å‚æ•°ï¼š**
  - `fileName` - è¦æ‰“å¼€çš„æ–‡ä»¶å
  - `commit` - æ˜¯å¦è‡ªåŠ¨æäº¤äº‹åŠ¡
  - `fileOpenMode` - æ–‡ä»¶æ‰“å¼€æ¨¡å¼
  - `password` - æ–‡ä»¶å¯†ç 
  - `docLock` - æ˜¯å¦é”å®šæ–‡æ¡£
- **ç”¨é€”ï¼š** ç›´æ¥ä»æ–‡ä»¶åˆ›å»ºäº‹åŠ¡

**æ ¸å¿ƒæ–¹æ³•ï¼š**

**GetObject æ–¹æ³•ï¼š**
```csharp
public DBObject GetObject(ObjectId id, OpenMode openMode = OpenMode.ForRead, bool openErased = false, bool openLockedLayer = false)
```
- **å‚æ•°ï¼š**
  - `id` - å¯¹è±¡ID
  - `openMode` - æ‰“å¼€æ¨¡å¼ï¼ˆé»˜è®¤åªè¯»ï¼‰
  - `openErased` - æ˜¯å¦æ‰“å¼€å·²åˆ é™¤å¯¹è±¡ï¼ˆé»˜è®¤falseï¼‰
  - `openLockedLayer` - æ˜¯å¦æ‰“å¼€é”å®šå›¾å±‚å¯¹è±¡ï¼ˆé»˜è®¤falseï¼‰
- **è¿”å›å€¼ï¼š** æ•°æ®åº“å¯¹è±¡

**GetObject<T> æ³›å‹æ–¹æ³•ï¼š**
```csharp
public T GetObject<T>(ObjectId id, OpenMode openMode = OpenMode.ForRead, bool openErased = false, bool openLockedLayer = false) where T : DBObject
```
- **ç±»å‹å‚æ•°ï¼š** `T` - è¦è·å–çš„å¯¹è±¡ç±»å‹
- **è¿”å›å€¼ï¼š** æŒ‡å®šç±»å‹çš„æ•°æ®åº“å¯¹è±¡

**Task æ–¹æ³•ï¼š**
```csharp
public void Task(Action action, bool isForeground = true)
```
- **å‚æ•°ï¼š**
  - `action` - è¦æ‰§è¡Œçš„æ“ä½œ
  - `isForeground` - æ˜¯å¦åœ¨å‰å°æ‰§è¡Œï¼ˆé»˜è®¤trueï¼‰
- **ç”¨é€”ï¼š** å‰å°åå°ä»»åŠ¡åˆ†åˆ«å¤„ç†
- **å¤‡æ³¨ï¼š**
  - æ–‡å­—åç§»é—®é¢˜ä¸»è¦å‡ºç°åœ¨çº¿æ€§å¼•æ“å‡½æ•°ä¸Š
  - åå°å¤„ç†åˆ©ç”¨å‰å°å½“å‰æ•°æ®åº“è¿›è¡Œå¤„ç†

**äº‹åŠ¡æ§åˆ¶æ–¹æ³•ï¼š**

**Commit æ–¹æ³•ï¼š**
```csharp
public void Commit()
```
- **åŠŸèƒ½ï¼š** æäº¤å½“å‰äº‹åŠ¡

**Abort æ–¹æ³•ï¼š**
```csharp
public void Abort()
```
- **åŠŸèƒ½ï¼š** å–æ¶ˆå½“å‰äº‹åŠ¡

**éšå¼è½¬æ¢ï¼š**
```csharp
public static implicit operator Transaction(DBTrans tr)
```
- **åŠŸèƒ½ï¼š** å°†DBTranséšå¼è½¬æ¢ä¸ºTransactionå¯¹è±¡

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// é™æ€æ–¹æ³•ä½¿ç”¨
var topTransaction = DBTrans.GetTopTransaction(database);
var topDBTrans = DBTrans.GetTop(database);

// ä¸åŒæ„é€ æ–¹å¼
// 1. åŸºäºå½“å‰æ–‡æ¡£
using (var tr = new DBTrans())
{
    var line = new Line(Point3d.Origin, new Point3d(100, 100, 0));
    tr.CurrentSpace.AddEntity(line);
    tr.Commit();
}

// 2. åŸºäºç‰¹å®šæ•°æ®åº“
using (var tr = new DBTrans(targetDatabase))
{
    var entity = tr.GetObject<Entity>(objectId, OpenMode.ForWrite);
    entity.Color = Color.FromColorIndex(ColorMethod.ByAci, 1);
    tr.Commit();
}

// 3. åŸºäºæ–‡ä»¶
using (var tr = new DBTrans(@"C:\Drawing.dwg", true, FileOpenMode.OpenForReadAndAllShare))
{
    // å¤„ç†å¤–éƒ¨æ–‡ä»¶
    tr.Commit();
}

// 4. å‰å°åå°ä»»åŠ¡å¤„ç†
using (var tr = new DBTrans())
{
    tr.Task(() =>
    {
        // åœ¨åå°æ‰§è¡Œçš„æ“ä½œ
        var entities = tr.CurrentSpace.GetEntities<Line>();
        foreach (var line in entities)
        {
            line.Color = Color.FromColorIndex(ColorMethod.ByAci, 2);
        }
    }, false); // falseè¡¨ç¤ºåå°æ‰§è¡Œ

    tr.Commit();
}

// 5. æ–‡æ¡£é”å®šæ¨¡å¼
using (var tr = new DBTrans(document, true, true)) // ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºtrueè¡¨ç¤ºé”å®šæ–‡æ¡£
{
    // åœ¨é”å®šçŠ¶æ€ä¸‹æ‰§è¡Œæ“ä½œ
    tr.Commit();
}
```

#### å­—å…¸æ“ä½œ (DBDictionaryEx)

æ‰©å±•å­—å…¸æ“ä½œåŠŸèƒ½ï¼Œæ”¯æŒå„ç§æ•°æ®ç±»å‹çš„å­˜å‚¨å’Œæ£€ç´¢ã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**
- æ‰©å±•æ•°æ®ç®¡ç†
- ç¼–ç»„æ“ä½œ
- æ•°æ®è¡¨åˆ›å»º
- å­å­—å…¸ç®¡ç†

### 3. å›¾å½¢å®ä½“æ‰©å±•

#### å®ä½“æ“ä½œ (EntityEx)

ä¸ºå„ç§ AutoCAD å®ä½“æä¾›æ‰©å±•æ–¹æ³•ï¼ŒåŒ…æ‹¬å˜æ¢æ“ä½œã€å±æ€§è®¾ç½®å’Œå‡ ä½•è®¡ç®—ã€‚

#### EntityEx ç±»è¯¦ç»†æ–¹æ³•

**ç§»åŠ¨æ“ä½œï¼š**

**Move æ–¹æ³•é‡è½½ï¼š**
```csharp
// åŸºäºä¸¤ç‚¹ç§»åŠ¨
public static void Move(Entity ent, Point3d from, Point3d to)

// åŸºäºå‘é‡ç§»åŠ¨
public static void Move(Entity ent, Vector3d vector)
```
- **å‚æ•°ï¼š**
  - `ent` - è¦ç§»åŠ¨çš„å®ä½“
  - `from` - ç§»åŠ¨èµ·ç‚¹
  - `to` - ç§»åŠ¨ç»ˆç‚¹
  - `vector` - ç§»åŠ¨å‘é‡
- **ç”¨é€”ï¼š** ç§»åŠ¨å®ä½“åˆ°æ–°ä½ç½®

**ç¼©æ”¾æ“ä½œï¼š**

**Scale æ–¹æ³•ï¼š**
```csharp
public static void Scale(Entity ent, Point3d center, double scaleFactor)
```
- **å‚æ•°ï¼š**
  - `ent` - è¦ç¼©æ”¾çš„å®ä½“
  - `center` - ç¼©æ”¾åŸºç‚¹åæ ‡
  - `scaleFactor` - ç¼©æ”¾æ¯”ä¾‹
- **ç”¨é€”ï¼š** æŒ‰æŒ‡å®šæ¯”ä¾‹ç¼©æ”¾å®ä½“

**æ—‹è½¬æ“ä½œï¼š**

**Rotation æ–¹æ³•é‡è½½ï¼š**
```csharp
// 3Dæ—‹è½¬
public static void Rotation(Entity ent, Point3d center, double angle, Vector3d axis)

// XYå¹³é¢æ—‹è½¬
public static void Rotation(Entity ent, Point3d center, double angle)
```
- **å‚æ•°ï¼š**
  - `ent` - è¦æ—‹è½¬çš„å®ä½“
  - `center` - æ—‹è½¬ä¸­å¿ƒ
  - `angle` - æ—‹è½¬è§’åº¦ï¼ˆå¼§åº¦ï¼‰
  - `axis` - æ—‹è½¬è½´å‘é‡ï¼ˆ3Dæ—‹è½¬ï¼‰
- **ç”¨é€”ï¼š** æ—‹è½¬å®ä½“

**é•œåƒæ“ä½œï¼š**

**Mirror æ–¹æ³•é‡è½½ï¼š**
```csharp
// æŒ‰å¯¹ç§°è½´é•œåƒ
public static void Mirror(Entity ent, Point3d startPoint, Point3d endPoint)

// æŒ‰å¯¹ç§°é¢é•œåƒ
public static void Mirror(Entity ent, Plane plane)

// æŒ‰å¯¹ç§°ç‚¹é•œåƒ
public static void Mirror(Entity ent, Point3d basePoint)
```
- **å‚æ•°ï¼š**
  - `ent` - è¦é•œåƒçš„å®ä½“
  - `startPoint` - å¯¹ç§°è½´èµ·ç‚¹
  - `endPoint` - å¯¹ç§°è½´ç»ˆç‚¹
  - `plane` - å¯¹ç§°å¹³é¢
  - `basePoint` - å¯¹ç§°ç‚¹
- **ç”¨é€”ï¼š** é•œåƒå®ä½“

**å‡ ä½•ä¿¡æ¯è·å–ï¼š**

**GetExtents æ–¹æ³•ï¼š**
```csharp
public static Extents3d GetExtents(IEnumerable<Entity> ents)
```
- **å‚æ•°ï¼š** `ents` - å®ä½“è¿­ä»£å™¨
- **è¿”å›å€¼ï¼š** å®ä½“é›†åˆçš„èŒƒå›´
- **ç”¨é€”ï¼š** è·å–å¤šä¸ªå®ä½“çš„æ€»ä½“èŒƒå›´

**GetBoundingBoxEx æ–¹æ³•ï¼š**
```csharp
public static BoundingBox GetBoundingBoxEx(Entity ent)
```
- **å‚æ•°ï¼š** `ent` - å®ä½“
- **è¿”å›å€¼ï¼š** åŒ…å›´ç›’ä¿¡æ¯
- **ç”¨é€”ï¼š** è·å–å›¾å…ƒåŒ…å›´ç›’

**GetStretchPoints æ–¹æ³•ï¼š**
```csharp
public static Point3dCollection GetStretchPoints(Entity ent)
```
- **å‚æ•°ï¼š** `ent` - å®ä½“
- **è¿”å›å€¼ï¼š** æ‹‰ä¼¸ç‚¹é›†åˆ
- **ç”¨é€”ï¼š** è·å–å®ä½“çš„æ‹‰ä¼¸ç‚¹

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

**åŸºæœ¬å˜æ¢æ“ä½œï¼š**
```csharp
using (var tr = new DBTrans())
{
    var entity = tr.GetObject<Entity>(entityId, OpenMode.ForWrite);

    // ç§»åŠ¨å®ä½“
    EntityEx.Move(entity, Point3d.Origin, new Point3d(100, 100, 0));

    // æ—‹è½¬å®ä½“ï¼ˆç»•åŸç‚¹æ—‹è½¬45åº¦ï¼‰
    EntityEx.Rotation(entity, Point3d.Origin, Math.PI / 4);

    // ç¼©æ”¾å®ä½“ï¼ˆæ”¾å¤§2å€ï¼‰
    EntityEx.Scale(entity, Point3d.Origin, 2.0);

    // é•œåƒå®ä½“ï¼ˆä»¥Yè½´ä¸ºå¯¹ç§°è½´ï¼‰
    EntityEx.Mirror(entity, Point3d.Origin, new Point3d(0, 100, 0));

    tr.Commit();
}
```

**æ‰¹é‡æ“ä½œç¤ºä¾‹ï¼š**
```csharp
using (var tr = new DBTrans())
{
    var entities = tr.CurrentSpace.GetEntities<Entity>();

    // è·å–æ‰€æœ‰å®ä½“çš„æ€»ä½“èŒƒå›´
    var totalExtents = EntityEx.GetExtents(entities);
    Console.WriteLine($"æ€»ä½“èŒƒå›´: {totalExtents.MinPoint} åˆ° {totalExtents.MaxPoint}");

    // æ‰¹é‡ç§»åŠ¨æ‰€æœ‰å®ä½“
    var moveVector = new Vector3d(50, 50, 0);
    foreach (var entity in entities)
    {
        entity.UpgradeOpen();
        EntityEx.Move(entity, moveVector);
    }

    tr.Commit();
}
```

**æ”¯æŒçš„å®ä½“ç±»å‹ï¼š**
- åœ†å¼§ (ArcEx)
- åœ† (CircleEx)
- æ›²çº¿ (CurveEx)
- å¤šæ®µçº¿ (PolylineEx)
- æ–‡å­— (DBTextEx, MTextEx)
- å—å‚ç…§ (BlockReferenceEx)
- é¢åŸŸ (RegionEx)

#### å‡ ä½•è®¡ç®— (GeometryEx)

æä¾›ä¸°å¯Œçš„å‡ ä½•è®¡ç®—åŠŸèƒ½ã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**
- ç‚¹ä¸å¤šè¾¹å½¢å…³ç³»åˆ¤æ–­
- å‘é‡è®¡ç®—
- å¹³é¢æ“ä½œ
- ç‚¹æ“ä½œå’Œå˜æ¢

### 4. ç”¨æˆ·äº¤äº’

#### ç¼–è¾‘å™¨æ‰©å±• (EditorEx)

å¢å¼ºçš„ç”¨æˆ·äº¤äº’åŠŸèƒ½ï¼Œæä¾›é€‰æ‹©é›†æ“ä½œã€ç”¨æˆ·è¾“å…¥ã€åæ ‡å˜æ¢å’Œè§†å›¾æ§åˆ¶ç­‰åŠŸèƒ½ã€‚

#### EditorEx ç±»è¯¦ç»†æ–¹æ³•

**é€‰æ‹©é›†æ“ä½œï¼š**

**SelectAtPoint æ–¹æ³•ï¼š**
```csharp
public static PromptSelectionResult SelectAtPoint(Editor editor, Point3d point, SelectionFilter filter = null)
```
- **å‚æ•°ï¼š**
  - `editor` - å‘½ä»¤è¡Œå¯¹è±¡
  - `point` - é€‰æ‹©ç‚¹
  - `filter` - é€‰æ‹©è¿‡æ»¤å™¨ï¼ˆå¯é€‰ï¼‰
- **è¿”å›å€¼ï¼š** é€‰æ‹©ç»“æœ
- **ç”¨é€”ï¼š** é€‰æ‹©ç©¿è¿‡ä¸€ä¸ªç‚¹çš„å¯¹è±¡

**SelectByLineWeight æ–¹æ³•ï¼š**
```csharp
public static PromptSelectionResult SelectByLineWeight(Editor editor, LineWeight lineWeight)
```
- **å‚æ•°ï¼š**
  - `editor` - å‘½ä»¤è¡Œå¯¹è±¡
  - `lineWeight` - çº¿å®½
- **è¿”å›å€¼ï¼š** é€‰æ‹©ç»“æœ
- **ç”¨é€”ï¼š** æ ¹æ®çº¿å®½åˆ›å»ºå›¾å±‚é€‰æ‹©é›†

**SSGet æ–¹æ³•ï¼š**
```csharp
public static PromptSelectionResult SSGet(Editor editor, string mode, SelectionFilter filter = null, (string, string)? message = null, Dictionary<string, (string, Action)> keywords = null)
```
- **å‚æ•°ï¼š**
  - `editor` - å‘½ä»¤è¡Œå¯¹è±¡
  - `mode` - é€‰æ‹©æ¨¡å¼
  - `filter` - é€‰æ‹©è¿‡æ»¤å™¨
  - `message` - æç¤ºæ¶ˆæ¯
  - `keywords` - å…³é”®å­—å’Œå›è°ƒ
- **è¿”å›å€¼ï¼š** é€‰æ‹©ç»“æœ
- **ç”¨é€”ï¼š** é«˜çº§é€‰æ‹©é›†æ“ä½œ

**æ¶ˆæ¯å’Œå¯¹è¯æ¡†ï¼š**

**StreamMessage æ–¹æ³•é‡è½½ï¼š**
```csharp
// æ ¼å¼åŒ–æ¶ˆæ¯
public static void StreamMessage(string format, params object[] args)

// ç®€å•æ¶ˆæ¯
public static void StreamMessage(string message)
```
- **å‚æ•°ï¼š**
  - `format` - å¸¦æ ¼å¼é¡¹çš„å­—ç¬¦ä¸²
  - `args` - æ ¼å¼åŒ–å¯¹è±¡æ•°ç»„
  - `message` - æ¶ˆæ¯å†…å®¹
- **ç”¨é€”ï¼š** å¸¦é”™è¯¯æç¤ºå¯¹è¯æ¡†çš„æ‰“å°ä¿¡æ¯

**InfoMessageBox æ–¹æ³•é‡è½½ï¼š**
```csharp
// å¸¦æ ‡é¢˜çš„æ¶ˆæ¯æ¡†
public static void InfoMessageBox(string caption, string message)

// æ ¼å¼åŒ–æ¶ˆæ¯æ¡†
public static void InfoMessageBox(string caption, string format, params object[] args)

// é»˜è®¤æ ‡é¢˜æ¶ˆæ¯æ¡†
public static void InfoMessageBox(string message)

// æ ¼å¼åŒ–é»˜è®¤æ ‡é¢˜æ¶ˆæ¯æ¡†
public static void InfoMessageBox(string format, params object[] args)
```
- **å‚æ•°ï¼š**
  - `caption` - å¯¹è¯æ¡†æ ‡é¢˜
  - `message` - æ¶ˆæ¯å†…å®¹
  - `format` - æ ¼å¼åŒ–å­—ç¬¦ä¸²
  - `args` - æ ¼å¼åŒ–å‚æ•°
- **ç”¨é€”ï¼š** æ˜¾ç¤ºæç¤ºä¿¡æ¯å¯¹è¯æ¡†

**WriteMessage æ–¹æ³•é‡è½½ï¼š**
```csharp
// ç®€å•æ¶ˆæ¯
public static void WriteMessage(string message)

// æ ¼å¼åŒ–æ¶ˆæ¯
public static void WriteMessage(string format, params object[] args)
```
- **å‚æ•°ï¼š**
  - `message` - æ¶ˆæ¯å†…å®¹
  - `format` - æ ¼å¼åŒ–å­—ç¬¦ä¸²
  - `args` - æ ¼å¼åŒ–å‚æ•°
- **ç”¨é€”ï¼š** å‘½ä»¤è¡Œæ‰“å°å­—ç¬¦ä¸²

**çŠ¶æ€æ£€æŸ¥ï¼š**

**HasEditor æ–¹æ³•ï¼š**
```csharp
public static bool HasEditor()
```
- **è¿”å›å€¼ï¼š** æ˜¯å¦æœ‰æ´»åŠ¨çš„ç¼–è¾‘å™¨å¯¹è±¡
- **ç”¨é€”ï¼š** åˆ¤æ–­æ˜¯å¦æœ‰æ´»åŠ¨çš„ç¼–è¾‘å™¨

**Acceptable æ–¹æ³•ï¼š**
```csharp
public static bool Acceptable()
```
- **è¿”å›å€¼ï¼š** æ˜¯å¦å¯ä»¥æ‰“å°å­—ç¬¦ä¸²
- **ç”¨é€”ï¼š** åˆ¤æ–­æ˜¯å¦å¯ä»¥æ‰“å°å­—ç¬¦ä¸²

**çŸ¢é‡ç»˜åˆ¶ï¼š**

**DrawVectors æ–¹æ³•é‡è½½ï¼š**
```csharp
// å¸¦é—­åˆé€‰é¡¹
public static void DrawVectors(Editor editor, IEnumerable<Point2d> pnts, short color, bool isClosed)

// ä¸é—­åˆ
public static void DrawVectors(Editor editor, IEnumerable<Point2d> pnts, short color)
```
- **å‚æ•°ï¼š**
  - `editor` - ç¼–è¾‘å™¨å¯¹è±¡
  - `pnts` - ç‚¹è¡¨
  - `color` - é¢œè‰²
  - `isClosed` - æ˜¯å¦é—­åˆ
- **ç”¨é€”ï¼š** ç”»çŸ¢é‡çº¿

**DrawCircles æ–¹æ³•ï¼š**
```csharp
public static void DrawCircles(Editor editor, IEnumerable<Point2d> pnts, short color, double radius, int sides)
```
- **å‚æ•°ï¼š**
  - `editor` - ç¼–è¾‘å™¨å¯¹è±¡
  - `pnts` - ç‚¹è¡¨
  - `color` - é¢œè‰²
  - `radius` - åŠå¾„
  - `sides` - è¾¹æ•°
- **ç”¨é€”ï¼š** ç”¨çŸ¢é‡çº¿ç”»è¿‘ä¼¼åœ†ï¼ˆæ­£å¤šè¾¹å½¢ï¼‰

**DrawLineVectors æ–¹æ³•ï¼š**
```csharp
public static void DrawLineVectors(Editor editor, IEnumerable<Point3d> points, int color, bool isClosed)
```
- **å‚æ•°ï¼š**
  - `editor` - ç”¨æˆ·äº¤äº’å¯¹è±¡
  - `points` - ç‚¹è¡¨
  - `color` - é¢œè‰²
  - `isClosed` - æ˜¯å¦é—­åˆ
- **ç”¨é€”ï¼š** æ ¹æ®ç‚¹è¡¨ç»˜åˆ¶çŸ¢é‡çº¿æ®µï¼ˆæ¯ä¸¤ç‚¹ä¸ºä¸€æ¡çº¿æ®µï¼‰

**DrawEndToEndVectors æ–¹æ³•ï¼š**
```csharp
public static void DrawEndToEndVectors(Editor editor, IEnumerable<Point3d> points, int color, bool isClosed, bool isVisible)
```
- **å‚æ•°ï¼š**
  - `editor` - ç”¨æˆ·äº¤äº’å¯¹è±¡
  - `points` - ç‚¹è¡¨
  - `color` - é¢œè‰²
  - `isClosed` - æ˜¯å¦é—­åˆ
  - `isVisible` - æ˜¯å¦å¯è§
- **ç”¨é€”ï¼š** æ ¹æ®ç‚¹è¡¨ç»˜åˆ¶é¦–å°¾ç›¸è¿çš„çŸ¢é‡

**åæ ‡å˜æ¢ï¼š**

**GetMatrixFromUcsToWcs æ–¹æ³•ï¼š**
```csharp
public static Matrix3d GetMatrixFromUcsToWcs(Editor editor)
```
- **å‚æ•°ï¼š** `editor` - å‘½ä»¤è¡Œå¯¹è±¡
- **è¿”å›å€¼ï¼š** UCSåˆ°WCSçš„å˜æ¢çŸ©é˜µ
- **ç”¨é€”ï¼š** è·å–ç”¨æˆ·åæ ‡ç³»åˆ°ä¸–ç•Œåæ ‡ç³»çš„å˜æ¢çŸ©é˜µ

**GetMatrixFromWcsToUcs æ–¹æ³•ï¼š**
```csharp
public static Matrix3d GetMatrixFromWcsToUcs(Editor editor)
```
- **å‚æ•°ï¼š** `editor` - å‘½ä»¤è¡Œå¯¹è±¡
- **è¿”å›å€¼ï¼š** WCSåˆ°UCSçš„å˜æ¢çŸ©é˜µ
- **ç”¨é€”ï¼š** è·å–ä¸–ç•Œåæ ‡ç³»åˆ°ç”¨æˆ·åæ ‡ç³»çš„å˜æ¢çŸ©é˜µ

**GetMatrix æ–¹æ³•ï¼š**
```csharp
public static Matrix3d GetMatrix(Editor editor, CoordinateSystemCode from, CoordinateSystemCode to)
```
- **å‚æ•°ï¼š**
  - `editor` - å‘½ä»¤è¡Œå¯¹è±¡
  - `from` - æºåæ ‡ç³»
  - `to` - ç›®æ ‡åæ ‡ç³»
- **è¿”å›å€¼ï¼š** å˜æ¢çŸ©é˜µ
- **ç”¨é€”ï¼š** è·å–ä»»æ„åæ ‡ç³»ä¹‹é—´çš„å˜æ¢çŸ©é˜µ

**è§†å›¾æ§åˆ¶ï¼š**

**ZoomWindow æ–¹æ³•é‡è½½ï¼š**
```csharp
// åŸºäºèŒƒå›´ç¼©æ”¾
public static void ZoomWindow(Editor ed, Extents3d ext, double factor = 1.0)

// åŸºäºä¸¤ç‚¹ç¼©æ”¾
public static void ZoomWindow(Editor ed, Point3d lpt, Point3d rpt, double factor = 1.0)
```
- **å‚æ•°ï¼š**
  - `ed` - å‘½ä»¤è¡Œå¯¹è±¡
  - `ext` - çª—å£èŒƒå›´
  - `lpt` - ç¬¬ä¸€ç‚¹
  - `rpt` - ç¬¬äºŒç‚¹
  - `factor` - ç¼©æ”¾å› å­
- **ç”¨é€”ï¼š** ç¼©æ”¾çª—å£åˆ°æŒ‡å®šèŒƒå›´

**Zoom æ–¹æ³•ï¼š**
```csharp
public static void Zoom(Editor ed, Point3d cenPt, double height, double width)
```
- **å‚æ•°ï¼š**
  - `ed` - å‘½ä»¤è¡Œå¯¹è±¡
  - `cenPt` - ä¸­å¿ƒç‚¹
  - `height` - é«˜åº¦
  - `width` - å®½åº¦
- **ç”¨é€”ï¼š** æŒ‰èŒƒå›´ç¼©æ”¾

**ZoomExtents æ–¹æ³•ï¼š**
```csharp
public static void ZoomExtents(Editor ed, double offsetDist = 0.0)
```
- **å‚æ•°ï¼š**
  - `ed` - å‘½ä»¤è¡Œå¯¹è±¡
  - `offsetDist` - åç§»è·ç¦»
- **ç”¨é€”ï¼š** åŠ¨æ€ç¼©æ”¾åˆ°å…¨éƒ¨èŒƒå›´

**ZoomObject æ–¹æ³•ï¼š**
```csharp
public static void ZoomObject(Editor ed, Entity ent, double factor = 1.0)
```
- **å‚æ•°ï¼š**
  - `ed` - å‘½ä»¤è¡Œå¯¹è±¡
  - `ent` - å®ä½“å¯¹è±¡
  - `factor` - ç¼©æ”¾å› å­
- **ç”¨é€”ï¼š** æ ¹æ®å®ä½“å¯¹è±¡çš„èŒƒå›´æ˜¾ç¤ºè§†å›¾

**ç”¨æˆ·è¾“å…¥ï¼š**

**GetPoint æ–¹æ³•ï¼š**
```csharp
public static PromptPointResult GetPoint(Editor ed, string message, Point3d basePoint)
```
- **å‚æ•°ï¼š**
  - `ed` - å‘½ä»¤è¡Œå¯¹è±¡
  - `message` - æç¤ºä¿¡æ¯
  - `basePoint` - åŸºç‚¹
- **è¿”å›å€¼ï¼š** ç‚¹é€‰æ‹©ç»“æœ
- **ç”¨é€”ï¼š** è·å–ç”¨æˆ·è¾“å…¥çš„ç‚¹

**GetDouble æ–¹æ³•ï¼š**
```csharp
public static PromptDoubleResult GetDouble(Editor ed, string message, double defaultValue)
```
- **å‚æ•°ï¼š**
  - `ed` - å‘½ä»¤è¡Œå¯¹è±¡
  - `message` - æç¤ºä¿¡æ¯
  - `defaultValue` - é»˜è®¤å€¼
- **è¿”å›å€¼ï¼š** åŒç²¾åº¦æ•°é€‰æ‹©ç»“æœ
- **ç”¨é€”ï¼š** è·å–ç”¨æˆ·è¾“å…¥çš„åŒç²¾åº¦æ•°

**GetInteger æ–¹æ³•ï¼š**
```csharp
public static PromptIntegerResult GetInteger(Editor ed, string message, int defaultValue)
```
- **å‚æ•°ï¼š**
  - `ed` - å‘½ä»¤è¡Œå¯¹è±¡
  - `message` - æç¤ºä¿¡æ¯
  - `defaultValue` - é»˜è®¤å€¼
- **è¿”å›å€¼ï¼š** æ•´æ•°é€‰æ‹©ç»“æœ
- **ç”¨é€”ï¼š** è·å–ç”¨æˆ·è¾“å…¥çš„æ•´æ•°

**GetString æ–¹æ³•ï¼š**
```csharp
public static PromptResult GetString(Editor ed, string message, string defaultValue)
```
- **å‚æ•°ï¼š**
  - `ed` - å‘½ä»¤è¡Œå¯¹è±¡
  - `message` - æç¤ºä¿¡æ¯
  - `defaultValue` - é»˜è®¤å€¼
- **è¿”å›å€¼ï¼š** å­—ç¬¦ä¸²é€‰æ‹©ç»“æœ
- **ç”¨é€”ï¼š** è·å–ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²

**é«˜çº§åŠŸèƒ½ï¼š**

**RunLisp æ–¹æ³•ï¼š**
```csharp
public static void RunLisp(Editor ed, string lispCode, RunLispFlag flag)
```
- **å‚æ•°ï¼š**
  - `ed` - ç¼–è¾‘å™¨å¯¹è±¡
  - `lispCode` - Lispè¯­å¥
  - `flag` - æ‰§è¡Œæ ‡å¿—
- **ç”¨é€”ï¼š** å‘é€Lispè¯­å¥å­—ç¬¦ä¸²åˆ°CADæ‰§è¡Œ

**PrepareForJig æ–¹æ³•é‡è½½ï¼š**
```csharp
// æ•°ç»„ç‰ˆæœ¬
public static void PrepareForJig(Editor ed, Entity[] ents)

// é›†åˆç‰ˆæœ¬
public static void PrepareForJig(Editor ed, IEnumerable<Entity> ents)
```
- **å‚æ•°ï¼š**
  - `ed` - å‘½ä»¤æ 
  - `ents` - å®ä½“ï¼ˆå·²å­˜åœ¨æ•°æ®åº“ä¸­ï¼‰
- **ç”¨é€”ï¼š** Jigå‰çš„å‡†å¤‡å·¥ä½œï¼Œä½¿å›¾å…ƒæš—æ˜¾

**GetCurrentMouthPoint æ–¹æ³•ï¼š**
```csharp
public static Point3d? GetCurrentMouthPoint(Editor ed)
```
- **å‚æ•°ï¼š** `ed` - å‘½ä»¤æ 
- **è¿”å›å€¼ï¼š** é¼ æ ‡å½“å‰ä½ç½®åæ ‡ï¼ˆå¯èƒ½ä¸ºnullï¼‰
- **ç”¨é€”ï¼š** è·å–CADé¼ æ ‡å½“å‰ä½ç½®åæ ‡

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

**é€‰æ‹©å’Œæ¶ˆæ¯ç¤ºä¾‹ï¼š**
```csharp
var ed = Application.DocumentManager.MdiActiveDocument.Editor;

// é€‰æ‹©å¯¹è±¡
var result = EditorEx.SelectAtPoint(ed, new Point3d(100, 100, 0));
if (result.Status == PromptStatus.OK)
{
    EditorEx.WriteMessage($"é€‰æ‹©äº† {result.Value.Count} ä¸ªå¯¹è±¡");
}

// æ˜¾ç¤ºæ¶ˆæ¯
EditorEx.InfoMessageBox("æç¤º", "æ“ä½œå®Œæˆï¼");
EditorEx.StreamMessage("å¤„ç†äº† {0} ä¸ªå¯¹è±¡", result.Value.Count);
```

**ç”¨æˆ·è¾“å…¥ç¤ºä¾‹ï¼š**
```csharp
var ed = Application.DocumentManager.MdiActiveDocument.Editor;

// è·å–ç‚¹
var pointResult = EditorEx.GetPoint(ed, "è¯·é€‰æ‹©ä¸€ä¸ªç‚¹: ", Point3d.Origin);
if (pointResult.Status == PromptStatus.OK)
{
    var point = pointResult.Value;

    // è·å–åŠå¾„
    var radiusResult = EditorEx.GetDouble(ed, "è¯·è¾“å…¥åŠå¾„: ", 10.0);
    if (radiusResult.Status == PromptStatus.OK)
    {
        var radius = radiusResult.Value;

        // åˆ›å»ºåœ†
        using (var tr = new DBTrans())
        {
            var circle = new Circle(point, Vector3d.ZAxis, radius);
            tr.CurrentSpace.AddEntity(circle);
            tr.Commit();
        }

        EditorEx.WriteMessage("åœ†åˆ›å»ºå®Œæˆï¼");
    }
}
```

**è§†å›¾æ§åˆ¶ç¤ºä¾‹ï¼š**
```csharp
var ed = Application.DocumentManager.MdiActiveDocument.Editor;

// ç¼©æ”¾åˆ°å…¨éƒ¨
EditorEx.ZoomExtents(ed);

// ç¼©æ”¾åˆ°æŒ‡å®šçª—å£
var ext = new Extents3d(new Point3d(0, 0, 0), new Point3d(100, 100, 0));
EditorEx.ZoomWindow(ed, ext, 1.1);

// ç¼©æ”¾åˆ°ç‰¹å®šå¯¹è±¡
using (var tr = new DBTrans())
{
    var entity = tr.GetObject<Entity>(objectId);
    EditorEx.ZoomObject(ed, entity, 1.2);
}
```

**çŸ¢é‡ç»˜åˆ¶ç¤ºä¾‹ï¼š**
```csharp
var ed = Application.DocumentManager.MdiActiveDocument.Editor;

// ç»˜åˆ¶çŸ¢é‡çº¿
var points = new List<Point2d>
{
    new Point2d(0, 0),
    new Point2d(100, 0),
    new Point2d(100, 100),
    new Point2d(0, 100)
};

EditorEx.DrawVectors(ed, points, 1, true); // çº¢è‰²é—­åˆçº¿

// ç»˜åˆ¶åœ†å½¢
var centerPoints = new List<Point2d> { new Point2d(50, 50) };
EditorEx.DrawCircles(ed, centerPoints, 2, 25.0, 16); // é»„è‰²åœ†ï¼Œ16è¾¹å½¢è¿‘ä¼¼
```

#### é€‰æ‹©é›†æ‰©å±• (SelectionSetEx)

æä¾›æ›´å¼ºå¤§çš„é€‰æ‹©é›†æ“ä½œåŠŸèƒ½ã€‚

### 5. ç³»ç»Ÿç®¡ç†

#### ç¯å¢ƒç®¡ç† (Env)

ç³»ç»Ÿå˜é‡å’Œç¯å¢ƒè®¾ç½®çš„ç»Ÿä¸€ç®¡ç†ã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**
- ç³»ç»Ÿå˜é‡ç®¡ç†
- æ•æ‰æ¨¡å¼æ§åˆ¶
- æ ‡æ³¨è®¾ç½®
- æ–‡æ¡£å’Œæ•°æ®åº“è®¿é—®

#### è‡ªåŠ¨åŠ è½½ (AutoReg)

ç¨‹åºé›†è‡ªåŠ¨æ³¨å†Œå’Œåˆå§‹åŒ–åŠŸèƒ½ã€‚

**æ ¸å¿ƒç±»ï¼š**
- `AutoRegAssem` - æ³¨å†Œä¸­å¿ƒ
- `IFoxAutoGo` - è‡ªåŠ¨æ‰§è¡Œæ¥å£
- `IFoxInitializeAttribute` - åˆå§‹åŒ–ç‰¹æ€§

### 6. è¿‡æ»¤å™¨ç³»ç»Ÿ

#### é€‰æ‹©é›†è¿‡æ»¤å™¨ (OpFilter)

å¼ºå¤§çš„é€‰æ‹©é›†è¿‡æ»¤åŠŸèƒ½ã€‚

**è¿‡æ»¤å™¨ç±»å‹ï¼š**
- `OpEqual` - ç›¸ç­‰è¿‡æ»¤å™¨
- `OpAnd` - é€»è¾‘ä¸
- `OpOr` - é€»è¾‘æˆ–
- `OpNot` - é€»è¾‘é
- `OpXor` - é€»è¾‘å¼‚æˆ–

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// åˆ›å»ºè¿‡æ»¤å™¨
var filter = OpFilter.Build(
    OpEqual.Create(DxfCode.Start, "LINE"),
    OpEqual.Create(DxfCode.LayerName, "0")
);

// åº”ç”¨è¿‡æ»¤å™¨é€‰æ‹©
var selection = Env.Editor.SelectAll(filter.ToSelectionFilter());
```

### 7. æ•°æ®å°è£…

#### æ•°æ®åˆ—è¡¨ç±»

- `TypedValueList` - é€šç”¨æ•°æ®åˆ—è¡¨ï¼Œç”¨äºé›†ä¸­ç®¡ç†æ‰©å±•æ•°æ®/æ‰©å±•å­—å…¸/resultBuffer
- `XDataList` - æ‰©å±•æ•°æ®åˆ—è¡¨
- `XRecordDataList` - æ‰©å±•å­—å…¸æ•°æ®åˆ—è¡¨
- `LispList` - Lisp æ•°æ®å°è£…

### 8. å¡«å……ç³»ç»Ÿ

#### å¡«å……æ‰©å±• (HatchEx)

å¼ºå¤§çš„å¡«å……æ“ä½œåŠŸèƒ½ï¼Œæä¾›è¾¹ç•Œç®¡ç†ã€æ ·å¼è®¾ç½®å’Œå…³è”æ€§å¤„ç†ã€‚

**æ ¸å¿ƒç±»ï¼š**
- `HatchEx` - å¡«å……æ‰©å±•ç±»
- `HatchInfo` - å›¾æ¡ˆå¡«å……ä¿¡æ¯
- `HatchConverter` - å¡«å……è¾¹ç•Œè½¬æ¢å™¨
- `HatchDialog` - å¡«å……å›¾æ¡ˆé€‰æ‹©å¯¹è¯æ¡†

#### HatchEx ç±»è¯¦ç»†æ–¹æ³•

**ForEach æ–¹æ³•ï¼š**
```csharp
public static void ForEach(Hatch hatch, Action<HatchLoop> action)
```
- **å‚æ•°ï¼š**
  - `hatch` - å¡«å……å¯¹è±¡
  - `action` - å¯¹æ¯ä¸ªè¾¹ç•Œç¯æ‰§è¡Œçš„æ“ä½œ
- **ç”¨é€”ï¼š** éå†å¡«å……çš„æ¯æ¡è¾¹ç•Œç¯å¹¶æ‰§è¡ŒæŒ‡å®šæ“ä½œ

**GetAssociatedBoundaryIds æ–¹æ³•ï¼š**
```csharp
public static List<ObjectIdCollection> GetAssociatedBoundaryIds(Hatch hatch)
```
- **å‚æ•°ï¼š** `hatch` - å¡«å……å¯¹è±¡
- **è¿”å›å€¼ï¼š** è¾¹ç•Œå¯¹è±¡IDé›†åˆåˆ—è¡¨ï¼ˆæ¯ä¸ªè¾¹ç•Œç¯çš„æ‰€æœ‰å¯¹è±¡IDç»„æˆä¸€ä¸ªObjectIdCollectionï¼‰
- **å¼‚å¸¸ï¼š** å‚æ•°æ— æ•ˆæ—¶æŠ›å‡º `ArgumentException`
- **ç”¨é€”ï¼š** æå–å·²å­˜åœ¨çš„å…³è”è¾¹ç•Œ

**CreateBoundarys æ–¹æ³•ï¼š**
```csharp
public static List<DBObjectCollection> CreateBoundarys(Hatch hatch)
```
- **å‚æ•°ï¼š** `hatch` - å¡«å……å¯¹è±¡
- **è¿”å›å€¼ï¼š** è¾¹ç•Œç¯åˆ—è¡¨ï¼ˆæ¯ä¸ªè¾¹ç•Œç¯çš„æ‰€æœ‰å¯¹è±¡ç»„æˆä¸€ä¸ªDBObjectCollectionï¼‰
- **ç”¨é€”ï¼š** åˆ›å»ºè¾¹ç•Œå¯¹è±¡ï¼ˆä»…åˆ›å»ºäºå†…å­˜ä¸­ï¼ŒæœªåŠ å…¥æ•°æ®åº“ï¼‰

**ResetBoundarys æ–¹æ³•ï¼š**
```csharp
public static void ResetBoundarys(Hatch hatch, List<ObjectIdCollection> boundaryIds, bool? associative = null)
```
- **å‚æ•°ï¼š**
  - `hatch` - å¡«å……å¯¹è±¡
  - `boundaryIds` - è¾¹ç•Œå¯¹è±¡IDé›†åˆåˆ—è¡¨
  - `associative` - æ˜¯å¦å…³è”ï¼ˆå¯é€‰ï¼‰
- **ç”¨é€”ï¼š** é‡æ–°è®¾ç½®è¾¹ç•Œå¹¶è®¡ç®—å¡«å……
- **æ³¨æ„äº‹é¡¹ï¼š**
  - è¾¹ç•Œå¿…é¡»æ˜¯å°é—­çš„ç¯ï¼Œå¯ä»¥æ˜¯ä¸€æ¡çº¿å›´åˆæˆ–å¤šæ¡çº¿é¦–å°¾ç›¸è¿å›´åˆ
  - å¤šä¸ªå¤–è¾¹ç•Œæ—¶ï¼Œå»ºè®®é¡ºåºä¸ºï¼šå¤–è¾¹ç•Œâ†’å¤–è¾¹ç•Œâ†’å¤–è¾¹ç•Œâ†’æ™®é€šè¾¹ç•Œï¼Œæˆ–å¤–è¾¹ç•Œâ†’æ™®é€šè¾¹ç•Œâ†’å¤–è¾¹ç•Œâ†’æ™®é€šè¾¹ç•Œ

**è¾¹ç•Œå¤„ç†ä¸“ç”¨æ–¹æ³•ï¼š**

**HatchLoopIsPolyline æ–¹æ³•ï¼š**
```csharp
public static void HatchLoopIsPolyline(HatchLoop loop, DBObjectCollection objColl)
```
- **å‚æ•°ï¼š**
  - `loop` - å¡«å……è¾¹ç•Œç¯
  - `objColl` - æ”¶é›†è¾¹ç•Œå›¾å…ƒçš„é›†åˆ
- **ç”¨é€”ï¼š** å¤„ç†å¤šæ®µçº¿ç±»å‹çš„è¾¹ç•Œ

**TwoArcFormOneCircle æ–¹æ³•ï¼š**
```csharp
public static void TwoArcFormOneCircle(HatchLoop loop, DBObjectCollection objColl)
```
- **å‚æ•°ï¼š**
  - `loop` - å¡«å……è¾¹ç•Œç¯
  - `objColl` - æ”¶é›†è¾¹ç•Œå›¾å…ƒçš„é›†åˆ
- **ç”¨é€”ï¼š** å¤„ç†ä¸¤ä¸ªåœ†å¼§ç»„æˆåœ†å½¢çš„ç‰¹æ®Šæƒ…å†µ

**HatchLoopIsCurve2d æ–¹æ³•ï¼š**
```csharp
public static void HatchLoopIsCurve2d(HatchLoop loop, DBObjectCollection objColl)
```
- **å‚æ•°ï¼š**
  - `loop` - å¡«å……è¾¹ç•Œç¯
  - `objColl` - æ”¶é›†è¾¹ç•Œå›¾å…ƒçš„é›†åˆ
- **ç”¨é€”ï¼š** å¤„ç†2Dæ›²çº¿ç±»å‹çš„è¾¹ç•Œ

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

**åŸºæœ¬è¾¹ç•Œæ“ä½œï¼š**
```csharp
using (var tr = new DBTrans())
{
    // è·å–å¡«å……å¯¹è±¡
    var hatch = tr.GetObject<Hatch>(hatchId, OpenMode.ForWrite);

    // è·å–ç°æœ‰è¾¹ç•Œ
    var boundaryIds = HatchEx.GetAssociatedBoundaryIds(hatch);
    Console.WriteLine($"å¡«å……åŒ…å« {boundaryIds.Count} ä¸ªè¾¹ç•Œç¯");

    // éå†æ¯ä¸ªè¾¹ç•Œç¯
    HatchEx.ForEach(hatch, loop =>
    {
        Console.WriteLine($"è¾¹ç•Œç±»å‹: {loop.LoopType}");
        Console.WriteLine($"è¾¹ç•ŒåŒ…å« {loop.Curves.Count} ä¸ªæ›²çº¿");
    });

    tr.Commit();
}
```

**åˆ›å»ºå’Œé‡è®¾è¾¹ç•Œï¼š**
```csharp
using (var tr = new DBTrans())
{
    // åˆ›å»ºæ–°çš„å¡«å……
    var hatch = new Hatch();
    tr.CurrentSpace.AddEntity(hatch);

    // è®¾ç½®å¡«å……æ ·å¼
    hatch.SetHatchPattern(HatchPatternType.PreDefined, "ANSI31");
    hatch.PatternScale = 1.0;

    // åˆ›å»ºè¾¹ç•Œï¼ˆåœ†å½¢ï¼‰
    var circle = new Circle(Point3d.Origin, Vector3d.ZAxis, 50);
    tr.CurrentSpace.AddEntity(circle);

    // è®¾ç½®è¾¹ç•Œ
    var boundaryIds = new List<ObjectIdCollection>
    {
        new ObjectIdCollection { circle.ObjectId }
    };

    HatchEx.ResetBoundarys(hatch, boundaryIds, true); // å…³è”è¾¹ç•Œ

    tr.Commit();
}
```

### 9. ç¬¦å·è¡¨ç®¡ç†

#### ç¬¦å·è¡¨æ‰©å±• (SymbolTableEx)

æä¾›ç¬¦å·è¡¨çš„é«˜çº§æ“ä½œåŠŸèƒ½ã€‚

**æ ¸å¿ƒç±»ï¼š**
- `SymbolTable<TTable, TRecord>` - ç¬¦å·è¡¨ç®¡ç†ç±»
- `SymbolTableEx` - ç¬¦å·è¡¨æ‰©å±•æ–¹æ³•
- `SymbolTableRecordEx` - ç¬¦å·è¡¨è®°å½•æ‰©å±•

**ä¸»è¦åŠŸèƒ½ï¼š**
- å›¾å±‚ç®¡ç†
- æ–‡å­—æ ·å¼ç®¡ç†
- çº¿å‹ç®¡ç†
- å—å®šä¹‰ç®¡ç†

### 10. Jig äº¤äº’

#### Jig æ‰©å±• (JigEx)

å¢å¼ºçš„ç”¨æˆ·äº¤äº’ç»˜å›¾åŠŸèƒ½ã€‚

**æ ¸å¿ƒç±»ï¼š**
- `JigEx` - Jig æ‰©å±•ç±»
- `JigExTransient` - ç¬æ€å®¹å™¨
- `WorldDrawEvent` - é‡ç»˜äº‹ä»¶

**ä¸»è¦åŠŸèƒ½ï¼š**
- åŠ¨æ€ç»˜å›¾
- å®æ—¶é¢„è§ˆ
- ç”¨æˆ·äº¤äº’
- ç¬æ€å›¾å½¢

### 11. å¤–éƒ¨å‚ç…§ç®¡ç†

#### å¤–éƒ¨å‚ç…§æ‰©å±• (XrefEx)

å®Œæ•´çš„å¤–éƒ¨å‚ç…§ç®¡ç†åŠŸèƒ½ã€‚

**æ ¸å¿ƒç±»ï¼š**
- `XrefEx` - å¤–éƒ¨å‚ç…§æ‰©å±•
- `XrefFactory` - å‚ç…§å·¥å‚ç±»
- `XrefPath` - å¤–éƒ¨å‚ç…§è·¯å¾„ç®¡ç†
- `IXrefBindModes` - å‚ç…§ç»‘å®šæ¨¡å¼æ¥å£

**ä¸»è¦åŠŸèƒ½ï¼š**
- å¤–éƒ¨å‚ç…§åŠ è½½å’Œå¸è½½
- è·¯å¾„ç®¡ç†
- ç»‘å®šæ“ä½œ
- å‚ç…§çŠ¶æ€ç®¡ç†

### 12. ç³»ç»Ÿå˜é‡ç®¡ç†

#### ç³»ç»Ÿå˜é‡ç®¡ç†å™¨ (SystemVariableManager)

ç»Ÿä¸€çš„ç³»ç»Ÿå˜é‡ç®¡ç†æ¥å£ã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**
- ç³»ç»Ÿå˜é‡è¯»å–å’Œè®¾ç½®
- æ‰¹é‡å˜é‡æ“ä½œ
- å˜é‡çŠ¶æ€ä¿å­˜å’Œæ¢å¤
- ç¯å¢ƒé…ç½®ç®¡ç†

### 13. PE æ–‡ä»¶åˆ†æ

#### PE æ–‡ä»¶ä¿¡æ¯åˆ†æç³»ç»Ÿ

ç”¨äºåˆ†æWindows PEï¼ˆPortable Executableï¼‰æ–‡ä»¶ç»“æ„ï¼Œæä¾›å¯¹AutoCADç›¸å…³DLLå’ŒEXEæ–‡ä»¶çš„æ·±åº¦åˆ†æèƒ½åŠ›ã€‚

**æ ¸å¿ƒç±»ï¼š**
- `PeInfo` - PEæ–‡ä»¶ä¿¡æ¯åˆ†æä¸»ç±»
- `AcadPeInfo` - AutoCADä¸“ç”¨PEä¿¡æ¯è·å–
- `PeFunction` - PEå‡½æ•°æŸ¥æ‰¾å·¥å…·
- `DosHeader` - DOSæ–‡ä»¶å¤´ç»“æ„
- `PEHeader` - PEæ–‡ä»¶å¤´ç»“æ„
- `OptionalHeader` - PEæ‰©å±•å¤´ç»“æ„
- `ExportDirectory` - å‡½æ•°å¯¼å‡ºè¡¨
- `ImportDirectory` - å‡½æ•°å¯¼å…¥è¡¨
- `ResourceDirectory` - èµ„æºè¡¨

#### PeInfo ä¸»ç±»

**æ„é€ å‡½æ•°ï¼š**
```csharp
public PeInfo(string fullName)
```
- **å‚æ•°ï¼š** `fullName` - PEæ–‡ä»¶çš„å®Œæ•´è·¯å¾„
- **å¼‚å¸¸ï¼š** æ–‡ä»¶ä¸å­˜åœ¨æˆ–æ ¼å¼é”™è¯¯æ—¶æŠ›å‡º `ArgumentException`

**ä¸»è¦å±æ€§ï¼š**
- `OpenFile` - æ–‡ä»¶æ˜¯å¦æ­£å¸¸æ‰“å¼€
- `ExportDirectory` - å‡½æ•°æ¥å£åå•
- `FullName` - PEæ–‡ä»¶å®Œæ•´è·¯å¾„

**ä¸»è¦æ–¹æ³•ï¼š**

**LoadFile æ–¹æ³•ï¼š**
```csharp
public void LoadFile()
```
- **åŠŸèƒ½ï¼š** å¼€å§‹è¯»å–å’Œè§£æPEæ–‡ä»¶ç»“æ„

**LoadDosHeader æ–¹æ³•ï¼š**
```csharp
public void LoadDosHeader()
```
- **åŠŸèƒ½ï¼š** è·å–DOSæ–‡ä»¶å¤´ä¿¡æ¯

**LoadPEHeader æ–¹æ³•ï¼š**
```csharp
public bool LoadPEHeader()
```
- **åŠŸèƒ½ï¼š** è·å–PEæ–‡ä»¶å¤´ä¿¡æ¯
- **è¿”å›å€¼ï¼š** æ˜¯å¦æˆåŠŸåŠ è½½

**LoadExportDirectory æ–¹æ³•ï¼š**
```csharp
public void LoadExportDirectory()
```
- **åŠŸèƒ½ï¼š** è¯»å–å‡½æ•°å¯¼å‡ºè¡¨

**GetPETable æ–¹æ³•ï¼š**
```csharp
public DataSet GetPETable()
```
- **åŠŸèƒ½ï¼š** è·å–å®Œæ•´çš„PEä¿¡æ¯æ•°æ®é›†
- **è¿”å›å€¼ï¼š** åŒ…å«å¤šä¸ªè¡¨çš„æ•°æ®é›†

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// åˆ†æAutoCADæ ¸å¿ƒDLL
var peInfo = new PeInfo(@"C:\Program Files\Autodesk\AutoCAD 2024\accore.dll");

try
{
    peInfo.LoadFile();

    if (peInfo.OpenFile)
    {
        Console.WriteLine($"æˆåŠŸåŠ è½½PEæ–‡ä»¶: {peInfo.FullName}");

        // è·å–å¯¼å‡ºå‡½æ•°åˆ—è¡¨
        var exportDir = peInfo.ExportDirectory;
        var functionNames = exportDir.FunctionNames();

        Console.WriteLine($"å¯¼å‡ºå‡½æ•°æ•°é‡: {functionNames.Count}");
        foreach (var funcName in functionNames.Take(10)) // æ˜¾ç¤ºå‰10ä¸ª
        {
            Console.WriteLine($"  - {funcName}");
        }

        // è·å–å®Œæ•´PEä¿¡æ¯è¡¨
        var peDataSet = peInfo.GetPETable();
        Console.WriteLine($"PEä¿¡æ¯è¡¨æ•°é‡: {peDataSet.Tables.Count}");
    }
}
catch (ArgumentException ex)
{
    Console.WriteLine($"PEæ–‡ä»¶åˆ†æå¤±è´¥: {ex.Message}");
}
```

#### AcadPeInfo ç±»

ä¸“é—¨ç”¨äºè·å–AutoCADç›¸å…³PEæ–‡ä»¶çš„å‡½æ•°æŒ‡é’ˆå’Œæ¥å£ä¿¡æ¯ã€‚

**æ„é€ å‡½æ•°ï¼š**
```csharp
public AcadPeInfo(string methodName, AcadPeEnum acadPeEnum)
```
- **å‚æ•°ï¼š**
  - `methodName` - ä¸å¸¦ä¿®é¥°çš„å‡½æ•°å
  - `acadPeEnum` - è¯»å–çš„CADæ–‡ä»¶ç±»å‹æšä¸¾

**ä¸»è¦å±æ€§ï¼š**
- `PeForAcadExe` - AutoCADä¸»ç¨‹åºPEä¿¡æ¯
- `PeForAccoreDll` - accore.dll PEä¿¡æ¯
- `PeForAcdbDll` - acdb.dll PEä¿¡æ¯
- `Methods` - åŒåå‡½æ•°æŒ‡é’ˆé›†åˆ

**ä¸»è¦æ–¹æ³•ï¼š**

**GetDelegate æ–¹æ³•ï¼š**
```csharp
public static TDelegate GetDelegate<TDelegate>(string methodName, AcadPeEnum acadPeEnum)
```
- **åŠŸèƒ½ï¼š** è·å–CADå‡½æ•°çš„å§”æ‰˜æŒ‡é’ˆ
- **å‚æ•°ï¼š**
  - `methodName` - å‡½æ•°å
  - `acadPeEnum` - CADæ–‡ä»¶ç±»å‹
- **è¿”å›å€¼ï¼š** æŒ‡å®šç±»å‹çš„å§”æ‰˜

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// è·å–AutoCADå†…éƒ¨å‡½æ•°æŒ‡é’ˆ
try
{
    // å®šä¹‰å‡½æ•°å§”æ‰˜ç±»å‹
    [UnmanagedFunctionPointer(CallingConvention.Cdecl)]
    public delegate int AcedCommandDelegate(IntPtr cmdStr);

    // è·å–acedCommandå‡½æ•°æŒ‡é’ˆ
    var acedCommand = AcadPeInfo.GetDelegate<AcedCommandDelegate>(
        "acedCommand",
        AcadPeEnum.AcadExe);

    if (acedCommand != null)
    {
        Console.WriteLine("æˆåŠŸè·å–acedCommandå‡½æ•°æŒ‡é’ˆ");
        // å¯ä»¥è°ƒç”¨AutoCADå†…éƒ¨å‡½æ•°
    }
}
catch (GetPeMethodException ex)
{
    Console.WriteLine($"è·å–å‡½æ•°æŒ‡é’ˆå¤±è´¥: {ex.ErrorMsg}");
}
```

#### PeFunction å·¥å…·ç±»

**ä¸»è¦æ–¹æ³•ï¼š**

**Finds æ–¹æ³•ï¼š**
```csharp
public static void Finds(PeInfo peInfo, string findFuncName, List<PeFunction> funcAdress_Out)
```
- **åŠŸèƒ½ï¼š** åœ¨PEæ–‡ä»¶ä¸­æŸ¥æ‰¾æŒ‡å®šåç§°çš„æ‰€æœ‰å‡½æ•°
- **å‚æ•°ï¼š**
  - `peInfo` - PEæ–‡ä»¶ä¿¡æ¯
  - `findFuncName` - è¦æŸ¥æ‰¾çš„å‡½æ•°å
  - `funcAdress_Out` - è¾“å‡ºçš„å‡½æ•°é›†åˆ

**é«˜çº§åº”ç”¨ç¤ºä¾‹ï¼š**
```csharp
// æ‰¹é‡åˆ†æAutoCADç›¸å…³DLL
public void AnalyzeAutoCadDlls()
{
    var cadPath = @"C:\Program Files\Autodesk\AutoCAD 2024\";
    var dllFiles = new[]
    {
        "accore.dll",
        "acdb24.dll",
        "acge24.dll",
        "acad.exe"
    };

    foreach (var fileName in dllFiles)
    {
        var fullPath = Path.Combine(cadPath, fileName);
        if (File.Exists(fullPath))
        {
            try
            {
                var peInfo = new PeInfo(fullPath);
                peInfo.LoadFile();

                if (peInfo.OpenFile)
                {
                    Console.WriteLine($"\n=== {fileName} ===");

                    // æŸ¥æ‰¾ç‰¹å®šå‡½æ•°
                    var functions = new List<PeFunction>();
                    PeFunction.Finds(peInfo, "acdb", functions);

                    Console.WriteLine($"æ‰¾åˆ° {functions.Count} ä¸ªacdbç›¸å…³å‡½æ•°");

                    // è·å–PEä¿¡æ¯è¡¨
                    var dataSet = peInfo.GetPETable();
                    foreach (DataTable table in dataSet.Tables)
                    {
                        Console.WriteLine($"  è¡¨: {table.TableName}, è¡Œæ•°: {table.Rows.Count}");
                    }
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"åˆ†æ {fileName} å¤±è´¥: {ex.Message}");
            }
        }
    }
}
```

### 14. çª—å£å’ŒUIæ‰©å±•

#### çª—å£æ‰©å±• (WindowEx)

çª—ä½“å’Œç”¨æˆ·ç•Œé¢æ‰©å±•åŠŸèƒ½ã€‚

**æ ¸å¿ƒç±»ï¼š**
- `WindowEx` - çª—ä½“æ‰©å±•
- `PaneEx` - æ‰˜ç›˜ç±»æ‰©å±•
- `PaneMarginType` - æ‰˜ç›˜è¾¹è·ç±»å‹

**ä¸»è¦åŠŸèƒ½ï¼š**
- çª—å£æ“ä½œ
- æ‰˜ç›˜ç®¡ç†
- UIå¸ƒå±€æ§åˆ¶
- çª—å£äº‹ä»¶å¤„ç†

### 15. æ–‡æ¡£é”ç®¡ç†

#### æ–‡æ¡£é”ç®¡ç†å™¨ (DocumentLockManager)

ç”¨äºç®¡ç†AutoCADæ–‡æ¡£çš„å®‰å…¨é”å®šå’Œè§£é”ï¼Œç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ–‡æ¡£æ“ä½œå®‰å…¨ã€‚

**æ ¸å¿ƒç±»ï¼š**
- `DocumentLockManager` - æ–‡æ¡£é”ç®¡ç†å™¨
- `DocumentLockManagerExtension` - æ–‡æ¡£é”ç®¡ç†æ‰©å±•æ–¹æ³•

**ä¸»è¦åŠŸèƒ½ï¼š**
- è‡ªåŠ¨æ–‡æ¡£é”å®šç®¡ç†
- å®‰å…¨çš„èµ„æºé‡Šæ”¾
- å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ–‡æ¡£ä¿æŠ¤
- ç®€åŒ–çš„é”å®šæ“ä½œæ¥å£

**ä½¿ç”¨åœºæ™¯ï¼š**
- å¤šçº¿ç¨‹AutoCADåº”ç”¨ç¨‹åº
- éœ€è¦ç¡®ä¿æ–‡æ¡£æ“ä½œåŸå­æ€§çš„åœºæ™¯
- é˜²æ­¢æ–‡æ¡£å¹¶å‘è®¿é—®å†²çª
- è‡ªåŠ¨åŒ–æ‰¹å¤„ç†æ“ä½œ

**åŸºæœ¬ç”¨æ³•ï¼š**
```csharp
// ä½¿ç”¨æ‰©å±•æ–¹æ³•å®‰å…¨é”å®šæ–‡æ¡£
using (var lockManager = document.SecurelyLock())
{
    // åœ¨é”å®šçŠ¶æ€ä¸‹æ‰§è¡Œæ–‡æ¡£æ“ä½œ
    using (var tr = document.Database.TransactionManager.StartTransaction())
    {
        // å®‰å…¨çš„æ–‡æ¡£æ“ä½œ
        tr.Commit();
    }
} // è‡ªåŠ¨é‡Šæ”¾æ–‡æ¡£é”

// æ‰‹åŠ¨åˆ›å»ºæ–‡æ¡£é”ç®¡ç†å™¨
var lockManager = new DocumentLockManager(document);
try
{
    // æ‰§è¡Œéœ€è¦é”å®šçš„æ“ä½œ
}
finally
{
    lockManager.Dispose(); // æ‰‹åŠ¨é‡Šæ”¾
}
```

**é«˜çº§ç”¨æ³•ï¼š**
```csharp
// æ£€æŸ¥é”å®šçŠ¶æ€
using (var lockManager = document.SecurelyLock())
{
    if (!lockManager.IsDisposed)
    {
        // æ‰§è¡Œæ“ä½œ
        Console.WriteLine("æ–‡æ¡£å·²å®‰å…¨é”å®š");
    }
}

// åœ¨å‘½ä»¤ä¸­ä½¿ç”¨æ–‡æ¡£é”
[CommandMethod("SAFE_OPERATION")]
public void SafeOperation()
{
    var doc = Application.DocumentManager.MdiActiveDocument;

    using (var lockManager = doc.SecurelyLock())
    {
        // å®‰å…¨çš„æ–‡æ¡£æ“ä½œ
        using (var tr = new DBTrans())
        {
            // æ‰§è¡Œæ•°æ®åº“æ“ä½œ
            tr.Commit();
        }
    }
}
```

### 16. DWGæ–‡ä»¶æ ‡è®°

#### DWGæ–‡ä»¶æ ‡è®°ç®¡ç† (DwgMark)

ç”¨äºä¸ºDWGæ–‡ä»¶æ·»åŠ ã€ç§»é™¤å’Œè·å–è‡ªå®šä¹‰æ ‡è®°ï¼Œå®ç°æ–‡ä»¶æ ‡è¯†å’Œç‰ˆæœ¬ç®¡ç†åŠŸèƒ½ã€‚

**æ ¸å¿ƒç±»ï¼š**
- `DwgMark` - DWGæ–‡ä»¶æ ‡è®°ç®¡ç†ç±»

**ä¸»è¦åŠŸèƒ½ï¼š**
- ä¸ºDWGæ–‡ä»¶æ·»åŠ ASCIIæ ‡è¯†å­—èŠ‚
- ç§»é™¤æ–‡ä»¶æ ‡è®°ï¼Œæ¢å¤é»˜è®¤å€¼
- è·å–æ–‡ä»¶çš„å½“å‰æ ‡è®°
- æ–‡ä»¶å®Œæ•´æ€§éªŒè¯

**æ–¹æ³•è¯¦è§£ï¼š**

**AddMark æ–¹æ³•ï¼š**
```csharp
public static void AddMark(FileInfo file, int bite)
```
- **å‚æ•°ï¼š**
  - `file`: DWGæ–‡ä»¶ä¿¡æ¯
  - `bite`: ASCIIæ ‡è¯†å­—èŠ‚ (0x00~0x7F)
- **å¼‚å¸¸ï¼š** éDWGæ–‡ä»¶æˆ–å­—èŠ‚è¶…å‡ºèŒƒå›´æ—¶æŠ›å‡º `ArgumentException`

**RemoveMark æ–¹æ³•ï¼š**
```csharp
public static void RemoveMark(FileInfo file)
```
- **å‚æ•°ï¼š**
  - `file`: è¦ç§»é™¤æ ‡è®°çš„DWGæ–‡ä»¶
- **å¼‚å¸¸ï¼š** éDWGæ–‡ä»¶æ—¶æŠ›å‡º `ArgumentException`

**GetMark æ–¹æ³•ï¼š**
```csharp
public static int GetMark(FileInfo file)
```
- **å‚æ•°ï¼š**
  - `file`: è¦è·å–æ ‡è®°çš„DWGæ–‡ä»¶
- **è¿”å›å€¼ï¼š** æ–‡ä»¶çš„å½“å‰æ ‡è®°å­—èŠ‚
- **å¼‚å¸¸ï¼š** éDWGæ–‡ä»¶æ—¶æŠ›å‡º `ArgumentException`

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// ä¸ºDWGæ–‡ä»¶æ·»åŠ æ ‡è®°
var dwgFile = new FileInfo(@"C:\Drawings\sample.dwg");

try
{
    // æ·»åŠ æ ‡è®° (ä½¿ç”¨ASCIIå­—ç¬¦ 'A' = 65)
    DwgMark.AddMark(dwgFile, 65);
    Console.WriteLine("æ ‡è®°æ·»åŠ æˆåŠŸ");

    // è·å–å½“å‰æ ‡è®°
    int currentMark = DwgMark.GetMark(dwgFile);
    Console.WriteLine($"å½“å‰æ ‡è®°: {currentMark} (å­—ç¬¦: {(char)currentMark})");

    // ç§»é™¤æ ‡è®°
    DwgMark.RemoveMark(dwgFile);
    Console.WriteLine("æ ‡è®°å·²ç§»é™¤");
}
catch (ArgumentException ex)
{
    Console.WriteLine($"æ“ä½œå¤±è´¥: {ex.Message}");
}
```

**å®é™…åº”ç”¨åœºæ™¯ï¼š**
```csharp
// æ‰¹é‡æ–‡ä»¶æ ‡è®°ç®¡ç†
public void BatchMarkFiles(string folderPath, int markValue)
{
    var dwgFiles = Directory.GetFiles(folderPath, "*.dwg")
                           .Select(f => new FileInfo(f));

    foreach (var file in dwgFiles)
    {
        try
        {
            DwgMark.AddMark(file, markValue);
            Console.WriteLine($"å·²æ ‡è®°æ–‡ä»¶: {file.Name}");
        }
        catch (ArgumentException)
        {
            Console.WriteLine($"è·³è¿‡æ— æ•ˆæ–‡ä»¶: {file.Name}");
        }
    }
}

// ç‰ˆæœ¬æ ‡è®°ç³»ç»Ÿ
public enum DrawingVersion
{
    Draft = 68,      // 'D'
    Review = 82,     // 'R'
    Final = 70,      // 'F'
    Archive = 65     // 'A'
}

public void SetDrawingVersion(FileInfo dwgFile, DrawingVersion version)
{
    DwgMark.AddMark(dwgFile, (int)version);
}

public DrawingVersion GetDrawingVersion(FileInfo dwgFile)
{
    int mark = DwgMark.GetMark(dwgFile);
    return (DrawingVersion)mark;
}
```

### 17. å¤©æ­£æ¥å£

#### å¤©æ­£æ‰©å±• (TangentEx)

å¤©æ­£CADæ¥å£æ”¯æŒã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**
- å¤©æ­£æ¯”ä¾‹è·å–
- å¤©æ­£å‘½ä»¤è°ƒç”¨
- å¤©æ­£æ•°æ®äº¤äº’

## ç¤¾åŒºå’Œæ”¯æŒ

### ç¤¾åŒºèµ„æº
- **QQ ç¾¤ï¼š** IFoxCadäº¤æµç¾¤
- **QQ é¢‘é“ï¼š** CADäºŒæ¬¡å¼€å‘
- **é¡¹ç›®åœ°å€ï¼š** https://gitee.com/inspirefunction/ifoxcad
- **æ–‡æ¡£åœ°å€ï¼š** [IFoxCADç±»åº“ä»å…¥é—¨åˆ°ç²¾é€š](https://www.kdocs.cn/l/cc6ZXSa0vMgD)
- **API æ–‡æ¡£ï¼š** [IFoxCAD API æ–‡æ¡£](https://inspirefunction.github.io/ifoxdoc/)

### è´¡çŒ®æŒ‡å—

æ¬¢è¿å‚ä¸é¡¹ç›®è´¡çŒ®ï¼š

1. æäº¤ Issue æŠ¥å‘Šé—®é¢˜æˆ–å»ºè®®
2. å‚ä¸æ–‡æ¡£ç¼–å†™
3. Fork é¡¹ç›®å¹¶æäº¤ Pull Request
4. å¸®åŠ©å®Œå–„åŠŸèƒ½å’Œä¿®å¤ Bug

## æ€§èƒ½ä¼˜åŒ–

### å››å‰æ ‘æ€§èƒ½
- å¯¹äºç©ºé—´æŸ¥è¯¢ï¼Œæ¯”çº¿æ€§æœç´¢å¿«å¾—å¤š
- é’ˆå¯¹ CAD å®ä½“ç¢°æ’æ£€æµ‹è¿›è¡Œäº†ä¼˜åŒ–
- å¯é€šè¿‡ QuadTreeEvn é…ç½®æ·±åº¦å’Œåˆ†å‰²é˜ˆå€¼

### å†…å­˜ç®¡ç†
- AutoCAD å¯¹è±¡çš„æ­£ç¡®é‡Šæ”¾æ¨¡å¼
- è‡ªåŠ¨äº‹åŠ¡ç®¡ç†å·¥å…·
- èµ„æºæ¸…ç†åŠ©æ‰‹

### ç¢°æ’æ£€æµ‹ä¼˜åŒ–

IFoxCAD æä¾›äº†æ¯”å››å‰æ ‘æ›´å¿«çš„åˆ—æ‰«ç¢°æ’æ£€æµ‹ç®—æ³•ï¼š

```csharp
Rect.XCollision(entities,
    firstProcessing: entity => false,
    collisionProcessing: (a, b) => { /* å¤„ç†ç¢°æ’ */ return false; },
    lastProcessing: entity => { /* åå¤„ç† */ }
);
```

## æœ€ä½³å®è·µ

1. **å¤„ç†å¤§é‡å®ä½“æ—¶ä½¿ç”¨å››å‰æ ‘è¿›è¡Œç©ºé—´æ“ä½œ**
2. **åˆ©ç”¨æ‰©å±•æ–¹æ³•ç¼–å†™æ›´æ¸…æ´ã€å¯è¯»çš„ä»£ç **
3. **ä½¿ç”¨äº‹åŠ¡åŠ©æ‰‹è¿›è¡Œé€‚å½“çš„èµ„æºç®¡ç†**
4. **å¯¹å‡ ä½•æ“ä½œåº”ç”¨åŸºäºå®¹å·®çš„æ¯”è¾ƒ**
5. **ä½¿ç”¨é›†åˆå·¥å…·è¿›è¡Œé«˜æ•ˆçš„æ•°æ®æ“ä½œ**

è¯¥åº“é€šè¿‡æä¾›é«˜çº§æŠ½è±¡åŒæ—¶ä¿æŒæ€§èƒ½å’Œçµæ´»æ€§ï¼Œæ˜¾è‘—ç®€åŒ–äº† AutoCAD .NET å¼€å‘ã€‚

## é«˜çº§åŠŸèƒ½

### 1. æ–‡æ¡£é”ç®¡ç†

```csharp
using var lockManager = document.SecurelyLock();
// åœ¨é”å®šçŠ¶æ€ä¸‹æ‰§è¡Œæ“ä½œ
```

### 2. ç³»ç»Ÿå˜é‡ç®¡ç†

```csharp
// ä¸´æ—¶ä¿®æ”¹ç³»ç»Ÿå˜é‡
using var osmode = Env.SetOsmode(OSModeType.None);
// æ“ä½œå®Œæˆåè‡ªåŠ¨æ¢å¤
```

### 3. è‡ªåŠ¨åˆå§‹åŒ–

```csharp
[IFoxInitialize]
public static void Initialize()
{
    // ç¨‹åºé›†åŠ è½½æ—¶è‡ªåŠ¨æ‰§è¡Œ
}

public class AutoRunner : IFoxAutoGo
{
    public int SequenceId() => 1;
    public void Go()
    {
        // è‡ªåŠ¨æ‰§è¡Œçš„ä»£ç 
    }
}
```

## è¯¦ç»† API å‚è€ƒ

### å››å‰æ ‘ç³»ç»Ÿç±»

#### QuadTree<T> ç±»
```csharp
public class QuadTree<T> where T : class
```

**ä¸»è¦æˆå‘˜ï¼š**
- `Count`: å››å‰æ ‘ä¸­èŠ‚ç‚¹çš„æ•°é‡
- `Insert(T entity)`: å°†å®ä½“æ’å…¥ç©ºé—´ç´¢å¼•
- `Query(Rect rect, QuadTreeSelectMode selectMode)`: æŸ¥è¯¢çŸ©å½¢åŒºåŸŸå†…çš„å®ä½“
- `Remove(Rect rect)`: æ ¹æ®åŒ…å›´çŸ©å½¢åˆ é™¤å®ä½“
- `Remove(T entity)`: åˆ é™¤ç‰¹å®šå®ä½“
- `FindNeibor(Rect rect, QuadTreeFindMode findMode)`: æŸ¥æ‰¾é‚»è¿‘å®ä½“
- `FindNearEntity(Rect rect)`: æŸ¥æ‰¾çŸ©å½¢é™„è¿‘çš„å®ä½“
- `ForEach(QTAction action)`: å¯¹æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œæ“ä½œ

**é€‰æ‹©æ¨¡å¼ï¼š**
- `IntersectsWith`: é€‰æ‹©ä¸æŸ¥è¯¢çŸ©å½¢ç›¸äº¤çš„å®ä½“
- `Contains`: é€‰æ‹©å®Œå…¨åŒ…å«åœ¨æŸ¥è¯¢çŸ©å½¢å†…çš„å®ä½“

**æŸ¥æ‰¾æ¨¡å¼ï¼š**
- `Top`, `Bottom`, `Left`, `Right`: æ–¹å‘æ€§é‚»å±…æœç´¢

#### QuadTreeNode<T> ç±»
```csharp
public class QuadTreeNode<T>
```

**è±¡é™å±æ€§ï¼š**
- `RightTopTree`: ç¬¬ä¸€è±¡é™ï¼ˆä¸œåŒ—ï¼‰
- `LeftTopTree`: ç¬¬äºŒè±¡é™ï¼ˆè¥¿åŒ—ï¼‰
- `LeftBottomTree`: ç¬¬ä¸‰è±¡é™ï¼ˆè¥¿å—ï¼‰
- `RightBottomTree`: ç¬¬å››è±¡é™ï¼ˆä¸œå—ï¼‰

**ä¸»è¦å±æ€§ï¼š**
- `Nodes`: æ‰€æœ‰å­èŠ‚ç‚¹é›†åˆ
- `NodesIsEmpty`: æ‰€æœ‰å­èŠ‚ç‚¹æ˜¯å¦ä¸ºç©º
- `Parent`: çˆ¶èŠ‚ç‚¹å¼•ç”¨
- `Depth`: èŠ‚ç‚¹åœ¨å››å‰æ ‘ä¸­çš„æ·±åº¦
- `Contents`: æ­¤èŠ‚ç‚¹åŒ…å«çš„å®ä½“
- `CountSubTree`: å­æ ‘ä¸­çš„å®ä½“æ€»æ•°

#### QuadTreeEvn é…ç½®
```csharp
public static class QuadTreeEvn
```

**é…ç½®å­—æ®µï¼š**
- `MinArea`: æœ€å°èŠ‚ç‚¹é¢ç§¯ï¼ˆå¿…é¡» > 0ï¼‰
- `SelectMode`: é»˜è®¤é€‰æ‹©æ¨¡å¼
- `QuadTreeMaximumDepth`: æœ€å¤§æ ‘æ·±åº¦
- `QuadTreeContentsCountSplit`: èŠ‚ç‚¹åˆ†å‰²çš„å®ä½“æ•°é‡é˜ˆå€¼

### å¡«å……ç³»ç»Ÿç±»

#### HatchEx ç±»
```csharp
public static class HatchEx
```

**ä¸»è¦æ–¹æ³•ï¼š**
- `ForEach(Hatch hatch, Action<HatchLoop> action)`: éå†å¡«å……å¾ªç¯
- `CreateHatch(HatchInfo hatchInfo)`: åˆ›å»ºå¡«å……å¯¹è±¡
- `SetBoundary(Hatch hatch, ObjectIdCollection boundaryIds)`: è®¾ç½®å¡«å……è¾¹ç•Œ

#### HatchInfo ç±»
```csharp
public class HatchInfo
```

**ä¸»è¦å±æ€§ï¼š**
- `PatternName`: å›¾æ¡ˆåç§°
- `PatternScale`: å›¾æ¡ˆæ¯”ä¾‹
- `PatternAngle`: å›¾æ¡ˆè§’åº¦
- `BoundaryIds`: è¾¹ç•Œå®ä½“IDé›†åˆ
- `IsGradient`: æ˜¯å¦ä¸ºæ¸å˜å¡«å……

**æ¸å˜å¡«å……ï¼š**
- `GradientName.Linear`: çº¿æ€§æ¸å˜
- `GradientName.Cylindrical`: åœ†æŸ±æ¸å˜
- `GradientName.Inverted`: åå‘æ¸å˜

### ç¬¦å·è¡¨ç®¡ç†ç±»

#### SymbolTable<TTable, TRecord> ç±»
```csharp
public class SymbolTable<TTable, TRecord>
```

**ä¸»è¦æ–¹æ³•ï¼š**
- `Add(string name, ...)`: æ·»åŠ ç¬¦å·è¡¨è®°å½•
- `Has(string name)`: æ£€æŸ¥è®°å½•æ˜¯å¦å­˜åœ¨
- `GetRecord(string name)`: è·å–è®°å½•
- `Remove(string name)`: åˆ é™¤è®°å½•

#### SymbolTableEx æ‰©å±•
```csharp
public static class SymbolTableEx
```

**å›¾å±‚æ“ä½œï¼š**
- `Add(LayerTable table, string name, Color color)`: æ·»åŠ å›¾å±‚
- `SetLayerColor(string layerName, Color color)`: è®¾ç½®å›¾å±‚é¢œè‰²
- `SetLayerLinetype(string layerName, string linetypeName)`: è®¾ç½®å›¾å±‚çº¿å‹

**æ–‡å­—æ ·å¼æ“ä½œï¼š**
- `Add(TextStyleTable table, string name, string fontFile, double height)`: æ·»åŠ æ–‡å­—æ ·å¼

### ç³»ç»Ÿå˜é‡ç®¡ç†ç±»

#### SystemVariableManager ç±»
```csharp
public class SystemVariableManager
```

**ä¸»è¦å±æ€§ï¼š**
- `ApBox`: è‡ªåŠ¨å‘å¸ƒæ¡†
- `Attdia`: å±æ€§å¯¹è¯æ¡†
- `Attreq`: å±æ€§è¯·æ±‚
- `Blipmode`: æ ‡è®°æ¨¡å¼
- `Cmdecho`: å‘½ä»¤å›æ˜¾

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
var sysVarManager = new SystemVariableManager();
sysVarManager.Cmdecho = false; // å…³é—­å‘½ä»¤å›æ˜¾
```

### Jig äº¤äº’ç±»

#### JigEx ç±»
```csharp
public class JigEx : EntityJig
```

**äº‹ä»¶ï¼š**
- `WorldDrawEvent`: é‡ç»˜äº‹ä»¶

**ä¸»è¦æ–¹æ³•ï¼š**
- `StartJig()`: å¼€å§‹Jigæ“ä½œ
- `UpdateEntity()`: æ›´æ–°å®ä½“
- `GetKeywords()`: è·å–å…³é”®å­—

#### JigExTransient ç±»
```csharp
public class JigExTransient
```

**å±æ€§ï¼š**
- `Entities`: ç¬æ€å®ä½“é›†åˆ

**æ–¹æ³•ï¼š**
- `AddTransient(Entity entity)`: æ·»åŠ ç¬æ€å®ä½“
- `RemoveTransient(Entity entity)`: ç§»é™¤ç¬æ€å®ä½“
- `ClearTransients()`: æ¸…é™¤æ‰€æœ‰ç¬æ€å®ä½“

### å‡ ä½•ç±»

#### Rect ç±»
```csharp
public struct Rect : IEquatable<Rect>, IFormattable, IComparable<Rect>
```

**æ ¸å¿ƒå±æ€§ï¼š**
- `X`, `Y`: ä½ç½®åæ ‡
- `Left`, `Bottom`, `Right`, `Top`: è¾¹ç•Œåæ ‡
- `Width`, `Height`: å°ºå¯¸
- `Area`: è®¡ç®—é¢ç§¯
- `IsPoint`: çŸ©å½¢æ˜¯å¦è¡¨ç¤ºå•ä¸ªç‚¹

**ç‚¹å±æ€§ï¼š**
- `MinPoint`, `MaxPoint`: è§’ç‚¹ï¼ˆå·¦ä¸‹ï¼Œå³ä¸Šï¼‰
- `CenterPoint`: ä¸­å¿ƒç‚¹
- `LeftLower`, `LeftMidst`, `LeftUpper`: å·¦è¾¹ç¼˜ç‚¹
- `RightUpper`, `RightMidst`, `RightBottom`: å³è¾¹ç¼˜ç‚¹
- `MidstUpper`, `MidstBottom`: ä¸Š/ä¸‹ä¸­å¿ƒç‚¹

**ä¸»è¦æ–¹æ³•ï¼š**
- `Contains(Point2d point)`: ç‚¹åŒ…å«æµ‹è¯•
- `Contains(Rect rect)`: çŸ©å½¢åŒ…å«æµ‹è¯•
- `IntersectsWith(Rect rect)`: ç›¸äº¤æµ‹è¯•
- `Expand(double amount)`: æŒ‰é‡æ‰©å±•çŸ©å½¢
- `ToPolyLine()`: è½¬æ¢ä¸º AutoCAD å¤šæ®µçº¿
- `ToPoints()`: è·å–è§’ç‚¹æ•°ç»„

**é™æ€å·¥å…·æ–¹æ³•ï¼š**
- `GetMinMax(IEnumerable<Point2d> pts)`: è·å–ç‚¹çš„åŒ…å›´ç›’
- `IsRect(List<Point2d> pts, double tolerance)`: æµ‹è¯•ç‚¹æ˜¯å¦å½¢æˆè½´å¯¹é½çŸ©å½¢
- `IsRectAngle(List<Point2d> pts, double tolerance)`: æµ‹è¯•ç‚¹æ˜¯å¦å½¢æˆæ—‹è½¬çŸ©å½¢
- `XCollision<T>()`: é«˜æ€§èƒ½ç¢°æ’æ£€æµ‹ç®—æ³•

#### BulgeVertexWidth ç»“æ„
```csharp
public struct BulgeVertexWidth
```

**å±æ€§ï¼š**
- `X`, `Y`: é¡¶ç‚¹åæ ‡
- `Bulge`: å¼§å‡¸åº¦å€¼
- `StartWidth`, `EndWidth`: æ®µå®½åº¦
- `Vertex`: Point2d è¡¨ç¤º

**æ„é€ å‡½æ•°ï¼š**
- `BulgeVertexWidth(double x, double y, double bulge, double startWidth, double endWidth)`
- `BulgeVertexWidth(Point2d vertex, double bulge, double startWidth, double endWidth)`
- `BulgeVertexWidth(BulgeVertex bulgeVertex)`
- `BulgeVertexWidth(Polyline polyline, int index)`

### æ‰©å±•ç±»

#### DatabaseEx æ‰©å±•
```csharp
public static class DatabaseEx
```

**ä¸»è¦æ–¹æ³•ï¼š**
- `SwitchDatabase(Database db)`: è¿”å›ç”¨äºä¸´æ—¶æ•°æ®åº“åˆ‡æ¢çš„ IDisposable
- `SaveDwgFile(Database db, DwgVersion version)`: ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬ä¿å­˜
- `SaveFile(Database db, DwgVersion version, bool automatic, string saveAsFile, bool echoes)`: é«˜çº§ä¿å­˜é€‰é¡¹

#### CollectionEx æ‰©å±•
```csharp
public static class CollectionEx
```

**é›†åˆè½¬æ¢æ–¹æ³•ï¼š**
- `ToCollection(IEnumerable<ObjectId> ids)`: è½¬æ¢ä¸º ObjectIdCollection
- `ToCollection<T>(IEnumerable<T> objs)`: è½¬æ¢ä¸ºå®ä½“é›†åˆ
- `ToCollection(IEnumerable<Point2d> pts)`: è½¬æ¢ä¸º Point2dCollection
- `ToCollection(IEnumerable<Point3d> pts)`: è½¬æ¢ä¸º Point3dCollection
- `ToList(ObjectIdCollection ids)`: è½¬æ¢ä¸º List<ObjectId>

**è¿­ä»£æ–¹æ³•ï¼š**
- `ForEach<T>(IEnumerable<T> source, Action<T> action)`: ç®€å•è¿­ä»£
- `ForEach<T>(IEnumerable<T> source, Action<int, T> action)`: å¸¦ç´¢å¼•çš„è¿­ä»£
- `ForEach<T>(IEnumerable<T> source, Action<T, LoopState> action)`: å¸¦ä¸­æ–­æ§åˆ¶çš„è¿­ä»£

**å…³é”®å­—å·¥å…·ï¼š**
- `Contains(KeywordCollection collection, string name, KeywordName keywordName)`: æ£€æŸ¥å…³é”®å­—å­˜åœ¨
- `ToDictionary(KeywordCollection collection)`: è½¬æ¢ä¸ºå­—å…¸ä»¥å®ç° O(1) æŸ¥æ‰¾

#### DBObjectEx æ‰©å±•
```csharp
public static class DBObjectEx
```

**å¯¹è±¡ç®¡ç†ï¼š**
- `Erase(IEnumerable<DBObject> objects)`: æ‰¹é‡åˆ é™¤å¯¹è±¡
- `CloneEx<T>(T obj)`: å¢å¼ºçš„å¯¹è±¡å…‹éš†
- `ForWrite<T>(T obj, Action<T> action)`: è‡ªåŠ¨å†™æ¨¡å¼ç®¡ç†
- `ForWrite(DBObject obj)`: è¿”å›å†™è®¿é—®çš„å‡çº§ç®¡ç†å™¨

**æ‰©å±•æ•°æ®æ–¹æ³•ï¼š**
- `RemoveXData(DBObject obj, string appName)`: åˆ é™¤åº”ç”¨ç¨‹åºçš„æ‰€æœ‰æ‰©å±•æ•°æ®
- `RemoveXData(DBObject obj, string appName, DxfCode dxfCode)`: åˆ é™¤ç‰¹å®šæ‰©å±•æ•°æ®
- `ChangeXData(DBObject obj, string appName, DxfCode dxfCode, object newValue)`: ä¿®æ”¹æ‰©å±•æ•°æ®

### å¤–éƒ¨å‚ç…§ç®¡ç†ç±»

#### XrefEx æ‰©å±•
```csharp
public static class XrefEx
```

**ä¸»è¦æ–¹æ³•ï¼š**
- `XrefFactory(DBTrans tr, XrefModes mode, HashSet<string> xrefNames)`: åˆ›å»ºå‚ç…§å·¥å‚

#### XrefFactory ç±»
```csharp
public class XrefFactory
```

**ä¸»è¦æ–¹æ³•ï¼š**
- `AttachXref(string fileName, string blockName, Point3d insertPoint)`: é™„åŠ å¤–éƒ¨å‚ç…§
- `DetachXref(string blockName)`: åˆ†ç¦»å¤–éƒ¨å‚ç…§
- `ReloadXref(string blockName)`: é‡æ–°åŠ è½½å¤–éƒ¨å‚ç…§
- `BindXref(string blockName)`: ç»‘å®šå¤–éƒ¨å‚ç…§

**å¤–éƒ¨å‚ç…§æ¨¡å¼ï¼š**
- `XrefModes.Attach`: é™„åŠ æ¨¡å¼
- `XrefModes.Overlay`: è¦†ç›–æ¨¡å¼
- `XrefModes.Bind`: ç»‘å®šæ¨¡å¼
- `XrefModes.Detach`: åˆ†ç¦»æ¨¡å¼

### å®ä½“æ‰©å±•ç±»

#### EntityEx æ‰©å±•
```csharp
public static class EntityEx
```

**å˜æ¢æ“ä½œï¼š**
- `Move(Entity entity, Point3d from, Point3d to)`: ç§»åŠ¨å®ä½“
- `Rotate(Entity entity, Point3d basePoint, double angle)`: æ—‹è½¬å®ä½“
- `Scale(Entity entity, Point3d basePoint, double scaleFactor)`: ç¼©æ”¾å®ä½“
- `Mirror(Entity entity, Point3d point1, Point3d point2)`: é•œåƒå®ä½“

**å±æ€§æ“ä½œï¼š**
- `SetLayer(Entity entity, string layerName)`: è®¾ç½®å›¾å±‚
- `SetColor(Entity entity, Color color)`: è®¾ç½®é¢œè‰²
- `SetLinetype(Entity entity, string linetypeName)`: è®¾ç½®çº¿å‹

#### å‡ ä½•å®ä½“æ‰©å±•

#### ArcEx - åœ†å¼§æ‰©å±•ç±»

**CreateArcSCE æ–¹æ³•ï¼š**
```csharp
public static Arc CreateArcSCE(Point3d startPoint, Point3d centerPoint, Point3d endPoint)
```
- **å‚æ•°ï¼š**
  - `startPoint` - èµ·ç‚¹
  - `centerPoint` - åœ†å¿ƒ
  - `endPoint` - ç»ˆç‚¹
- **è¿”å›å€¼ï¼š** åˆ›å»ºçš„åœ†å¼§å¯¹è±¡
- **ç”¨é€”ï¼š** æ ¹æ®åœ†å¿ƒã€èµ·ç‚¹ã€ç»ˆç‚¹åˆ›å»ºåœ†å¼§ï¼ˆäºŒç»´ï¼‰

**CreateArc æ–¹æ³•é‡è½½ï¼š**
```csharp
// ä¸‰ç‚¹æ³•åˆ›å»ºåœ†å¼§
public static Arc CreateArc(Point3d startPoint, Point3d pointOnArc, Point3d endPoint)

// èµ·ç‚¹ã€åœ†å¿ƒã€è§’åº¦æ³•åˆ›å»ºåœ†å¼§
public static Arc CreateArc(Point3d startPoint, Point3d centerPoint, double sweepAngle)
```
- **å‚æ•°ï¼š**
  - `startPoint` - èµ·ç‚¹
  - `pointOnArc` - åœ†å¼§ä¸Šçš„ç‚¹
  - `endPoint` - ç»ˆç‚¹
  - `centerPoint` - åœ†å¿ƒ
  - `sweepAngle` - åœ†å¼§è§’åº¦ï¼ˆå¼§åº¦ï¼‰
- **ç”¨é€”ï¼š** ä¸åŒæ–¹å¼åˆ›å»ºåœ†å¼§

**ToPolyline æ–¹æ³•ï¼š**
```csharp
public static Polyline ToPolyline(Arc arc)
```
- **å‚æ•°ï¼š** `arc` - åœ†å¼§å¯¹è±¡
- **è¿”å›å€¼ï¼š** è½¬æ¢åçš„å¤šæ®µçº¿
- **ç”¨é€”ï¼š** å°†åœ†å¼§è½¬æ¢ä¸ºå¤šæ®µçº¿

#### CircleEx - åœ†æ‰©å±•ç±»

**CreateCircle æ–¹æ³•é‡è½½ï¼š**
```csharp
// ä¸¤ç‚¹åˆ›å»ºåœ†ï¼ˆä¸¤ç‚¹ä¸­ç‚¹ä¸ºåœ†å¿ƒï¼‰
public static Circle CreateCircle(Point3d startPoint, Point3d endPoint)

// ä¸‰ç‚¹æ³•åˆ›å»ºåœ†
public static Circle CreateCircle(Point3d pt1, Point3d pt2, Point3d pt3)

// åœ†å¿ƒåŠå¾„æ³•åˆ›å»ºåœ†
public static Circle CreateCircle(Point3d center, double radius, double startAngle, double endAngle, double thickness)
```
- **å‚æ•°ï¼š**
  - `startPoint` - èµ·ç‚¹
  - `endPoint` - ç»ˆç‚¹
  - `pt1`, `pt2`, `pt3` - ä¸‰ä¸ªç‚¹
  - `center` - åœ†å¿ƒ
  - `radius` - åŠå¾„
  - `startAngle` - èµ·å§‹è§’åº¦
  - `endAngle` - ç»“æŸè§’åº¦
  - `thickness` - åšåº¦
- **è¿”å›å€¼ï¼š** åˆ›å»ºçš„åœ†å¯¹è±¡ï¼ˆä¸‰ç‚¹æ³•å¤±è´¥æ—¶è¿”å›nullï¼‰
- **ç”¨é€”ï¼š** ä¸åŒæ–¹å¼åˆ›å»ºåœ†

#### PolylineEx - å¤šæ®µçº¿æ‰©å±•ç±»

**GetPoints æ–¹æ³•é‡è½½ï¼š**
```csharp
// è·å–äºŒç»´å¤šæ®µçº¿ç«¯ç‚¹
public static List<Point3d> GetPoints(Polyline2d pl2d)

// è·å–ä¸‰ç»´å¤šæ®µçº¿ç«¯ç‚¹
public static List<Point3d> GetPoints(Polyline3d pl3d)

// è·å–å¤šæ®µçº¿ç«¯ç‚¹
public static List<Point3d> GetPoints(Polyline pl)
```
- **å‚æ•°ï¼š** ä¸åŒç±»å‹çš„å¤šæ®µçº¿å¯¹è±¡
- **è¿”å›å€¼ï¼š** ç«¯ç‚¹åæ ‡é›†åˆ
- **ç”¨é€”ï¼š** è·å–å¤šæ®µçº¿çš„æ‰€æœ‰ç«¯ç‚¹åæ ‡

**CreatePolyline æ–¹æ³•é‡è½½ï¼š**
```csharp
// åŸºäºç‚¹é›†åˆ›å»ºå¤šæ®µçº¿
public static Polyline CreatePolyline(IEnumerable<Point3d> points, Action<Polyline> action = null)

// åŸºäºå¤æ‚ç‚¹é›†åˆ›å»ºå¤šæ®µçº¿
public static Polyline CreatePolyline(IEnumerable<(Point3d pt, double bulge, double startWidth, double endWidth)> pts, Action<Polyline> action = null)

// åŸºäºExtents3dåˆ›å»ºå¤šæ®µçº¿
public static Polyline CreatePolyline(Extents3d extents, Action<Polyline> action = null)
```
- **å‚æ•°ï¼š**
  - `points` - ç‚¹é›†
  - `pts` - ç«¯ç‚¹è¡¨ï¼ˆåŒ…å«ç‚¹ã€å‡¸åº¦ã€èµ·å§‹å®½åº¦ã€ç»“æŸå®½åº¦ï¼‰
  - `extents` - ä¸‰ç»´èŒƒå›´
  - `action` - å¤šæ®µçº¿å±æ€§è®¾ç½®å§”æ‰˜
- **è¿”å›å€¼ï¼š** åˆ›å»ºçš„å¤šæ®µçº¿å¯¹è±¡
- **ç”¨é€”ï¼š** ä¸åŒæ–¹å¼åˆ›å»ºå¤šæ®µçº¿

**ToPolyline æ–¹æ³•é‡è½½ï¼š**
```csharp
// 2Dç‚¹è¡¨ç”Ÿæˆå¤šæ®µçº¿
public static Polyline ToPolyline(IEnumerable<Point2d> pointList, double plineWidth = 0, bool isClosed = false)

// 3Dç‚¹è¡¨ç”Ÿæˆå¤šæ®µçº¿
public static Polyline ToPolyline(IEnumerable<Point3d> pointList, double plineWidth = 0, bool isClosed = false)
```
- **å‚æ•°ï¼š**
  - `pointList` - ç‚¹è¡¨
  - `plineWidth` - çº¿å®½
  - `isClosed` - æ˜¯å¦é—­åˆ
- **è¿”å›å€¼ï¼š** ç”Ÿæˆçš„å¤šæ®µçº¿
- **ç”¨é€”ï¼š** ä»ç‚¹è¡¨ç”Ÿæˆå¤šæ®µçº¿

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

**åœ†å¼§æ“ä½œç¤ºä¾‹ï¼š**
```csharp
using (var tr = new DBTrans())
{
    // ä¸‰ç‚¹æ³•åˆ›å»ºåœ†å¼§
    var arc1 = ArcEx.CreateArc(
        new Point3d(0, 0, 0),
        new Point3d(50, 50, 0),
        new Point3d(100, 0, 0));
    tr.CurrentSpace.AddEntity(arc1);

    // èµ·ç‚¹ã€åœ†å¿ƒã€ç»ˆç‚¹æ³•åˆ›å»ºåœ†å¼§
    var arc2 = ArcEx.CreateArcSCE(
        new Point3d(0, 100, 0),
        new Point3d(50, 100, 0),
        new Point3d(100, 100, 0));
    tr.CurrentSpace.AddEntity(arc2);

    // åœ†å¼§è½¬å¤šæ®µçº¿
    var polyline = ArcEx.ToPolyline(arc1);
    tr.CurrentSpace.AddEntity(polyline);

    tr.Commit();
}
```

**åœ†æ“ä½œç¤ºä¾‹ï¼š**
```csharp
using (var tr = new DBTrans())
{
    // ä¸¤ç‚¹åˆ›å»ºåœ†
    var circle1 = CircleEx.CreateCircle(
        new Point3d(0, 0, 0),
        new Point3d(100, 100, 0));
    tr.CurrentSpace.AddEntity(circle1);

    // ä¸‰ç‚¹æ³•åˆ›å»ºåœ†
    var circle2 = CircleEx.CreateCircle(
        new Point3d(200, 0, 0),
        new Point3d(250, 50, 0),
        new Point3d(300, 0, 0));

    if (circle2 != null) // æ£€æŸ¥æ˜¯å¦åˆ›å»ºæˆåŠŸ
    {
        tr.CurrentSpace.AddEntity(circle2);
    }

    tr.Commit();
}
```

**å¤šæ®µçº¿æ“ä½œç¤ºä¾‹ï¼š**
```csharp
using (var tr = new DBTrans())
{
    // ä»ç‚¹é›†åˆ›å»ºå¤šæ®µçº¿
    var points = new List<Point3d>
    {
        new Point3d(0, 0, 0),
        new Point3d(100, 0, 0),
        new Point3d(100, 100, 0),
        new Point3d(0, 100, 0)
    };

    var polyline = PolylineEx.CreatePolyline(points, pl =>
    {
        pl.Closed = true;
        pl.ConstantWidth = 5.0;
    });
    tr.CurrentSpace.AddEntity(polyline);

    // è·å–å¤šæ®µçº¿çš„æ‰€æœ‰ç‚¹
    var extractedPoints = PolylineEx.GetPoints(polyline);
    Console.WriteLine($"å¤šæ®µçº¿åŒ…å« {extractedPoints.Count} ä¸ªç‚¹");

    tr.Commit();
}
```

#### PInvokeUser32 ç³»ç»ŸAPIå°è£…ç±»

å°è£…Windows User32.dllçš„å¸¸ç”¨APIå‡½æ•°ï¼Œæä¾›çª—å£æ“ä½œã€æ¶ˆæ¯å¤„ç†å’Œé”®ç›˜è¾“å…¥ç­‰åŠŸèƒ½ã€‚

**çª—å£æŸ¥æ‰¾å’Œç®¡ç†ï¼š**

**FindWindow æ–¹æ³•ï¼š**
```csharp
public static IntPtr FindWindow(string lpClassName, string lpWindowName)
```
- **å‚æ•°ï¼š**
  - `lpClassName` - çª—å£ç±»å
  - `lpWindowName` - çª—å£æ ‡é¢˜
- **è¿”å›å€¼ï¼š** çª—å£å¥æŸ„
- **ç”¨é€”ï¼š** æŸ¥æ‰¾æŒ‡å®šç±»åå’Œæ ‡é¢˜çš„çª—å£

**GetForegroundWindow æ–¹æ³•ï¼š**
```csharp
public static IntPtr GetForegroundWindow()
```
- **è¿”å›å€¼ï¼š** å½“å‰å‰å°çª—å£å¥æŸ„
- **ç”¨é€”ï¼š** è·å–å½“å‰æ´»åŠ¨çª—å£

**GetActiveWindow æ–¹æ³•ï¼š**
```csharp
public static IntPtr GetActiveWindow()
```
- **è¿”å›å€¼ï¼š** å½“å‰æ¿€æ´»çª—å£å¥æŸ„
- **ç”¨é€”ï¼š** è·å–å½“å‰æ¿€æ´»çš„çª—å£

**GetParent æ–¹æ³•ï¼š**
```csharp
public static IntPtr GetParent(IntPtr hWnd)
```
- **å‚æ•°ï¼š** `hWnd` - å­çª—å£å¥æŸ„
- **è¿”å›å€¼ï¼š** çˆ¶çª—å£å¥æŸ„
- **ç”¨é€”ï¼š** è·å–æŒ‡å®šçª—å£çš„çˆ¶çª—å£

**GetWindow æ–¹æ³•ï¼š**
```csharp
public static IntPtr GetWindow(IntPtr hWnd, uint uCmd)
```
- **å‚æ•°ï¼š**
  - `hWnd` - çª—å£å¥æŸ„
  - `uCmd` - å…³ç³»å‘½ä»¤ï¼ˆGW_CHILD, GW_HWNDFIRSTç­‰ï¼‰
- **è¿”å›å€¼ï¼š** ç›¸å…³çª—å£å¥æŸ„
- **ç”¨é€”ï¼š** æ£€ç´¢æŒ‡å®šçª—å£çš„ç›¸å…³çª—å£

**GetTopWindow æ–¹æ³•ï¼š**
```csharp
public static IntPtr GetTopWindow(IntPtr hWnd)
```
- **å‚æ•°ï¼š** `hWnd` - çˆ¶çª—å£å¥æŸ„
- **è¿”å›å€¼ï¼š** ç¬¬ä¸€ä¸ªå­çª—å£å¥æŸ„
- **ç”¨é€”ï¼š** æ£€ç´¢æŒ‡å®šçª—å£çš„ç¬¬ä¸€ä¸ªå­çª—å£

**çª—å£ä¿¡æ¯è·å–ï¼š**

**GetWindowText æ–¹æ³•ï¼š**
```csharp
public static int GetWindowText(IntPtr hWnd, StringBuilder lpString, int nMaxCount)
```
- **å‚æ•°ï¼š**
  - `hWnd` - çª—å£å¥æŸ„
  - `lpString` - æ¥æ”¶æ–‡æœ¬çš„ç¼“å†²åŒº
  - `nMaxCount` - ç¼“å†²åŒºå¤§å°
- **è¿”å›å€¼ï¼š** å¤åˆ¶çš„å­—ç¬¦æ•°
- **ç”¨é€”ï¼š** è·å–çª—å£æ ‡é¢˜

**GetWindowTextLength æ–¹æ³•ï¼š**
```csharp
public static int GetWindowTextLength(IntPtr hWnd)
```
- **å‚æ•°ï¼š** `hWnd` - çª—å£å¥æŸ„
- **è¿”å›å€¼ï¼š** çª—å£æ ‡é¢˜é•¿åº¦
- **ç”¨é€”ï¼š** è·å–çª—å£æ ‡é¢˜çš„å­—ç¬¦é•¿åº¦

**GetClassName æ–¹æ³•ï¼š**
```csharp
public static int GetClassName(IntPtr hWnd, StringBuilder lpClassName, int nMaxCount)
```
- **å‚æ•°ï¼š**
  - `hWnd` - çª—å£å¥æŸ„
  - `lpClassName` - æ¥æ”¶ç±»åçš„ç¼“å†²åŒº
  - `nMaxCount` - ç¼“å†²åŒºå¤§å°
- **è¿”å›å€¼ï¼š** å¤åˆ¶çš„å­—ç¬¦æ•°
- **ç”¨é€”ï¼š** è·å–çª—å£ç±»å

**GetClientRect æ–¹æ³•ï¼š**
```csharp
public static bool GetClientRect(IntPtr hWnd, out WindowsAPI.IntRect lpRect)
```
- **å‚æ•°ï¼š**
  - `hWnd` - çª—å£å¥æŸ„
  - `lpRect` - è¾“å‡ºçš„å®¢æˆ·åŒºçŸ©å½¢
- **è¿”å›å€¼ï¼š** æ˜¯å¦æˆåŠŸ
- **ç”¨é€”ï¼š** è·å–çª—å£å®¢æˆ·åŒºå¤§å°

**æ¶ˆæ¯å¤„ç†ï¼š**

**SendMessage æ–¹æ³•é‡è½½ï¼š**
```csharp
// åŸºæœ¬ç‰ˆæœ¬
public static IntPtr SendMessage(IntPtr hWnd, uint Msg, IntPtr wParam, IntPtr lParam)

// æ•´æ•°ç‰ˆæœ¬
public static IntPtr SendMessage(IntPtr hWnd, int Msg, IntPtr wParam, IntPtr lParam)
```
- **å‚æ•°ï¼š**
  - `hWnd` - ç›®æ ‡çª—å£å¥æŸ„
  - `Msg` - æ¶ˆæ¯ç±»å‹
  - `wParam` - æ¶ˆæ¯å‚æ•°1
  - `lParam` - æ¶ˆæ¯å‚æ•°2
- **è¿”å›å€¼ï¼š** æ¶ˆæ¯å¤„ç†ç»“æœ
- **ç”¨é€”ï¼š** å‘é€æ¶ˆæ¯åˆ°æŒ‡å®šçª—å£

**PostMessage æ–¹æ³•ï¼š**
```csharp
public static bool PostMessage(IntPtr hWnd, int Msg, IntPtr wParam, IntPtr lParam)
```
- **å‚æ•°ï¼š**
  - `hWnd` - ç›®æ ‡çª—å£å¥æŸ„
  - `Msg` - æ¶ˆæ¯ç±»å‹
  - `wParam` - æ¶ˆæ¯å‚æ•°1
  - `lParam` - æ¶ˆæ¯å‚æ•°2
- **è¿”å›å€¼ï¼š** æ˜¯å¦æˆåŠŸ
- **ç”¨é€”ï¼š** å°†æ¶ˆæ¯æ”¾å…¥ç›®æ ‡çº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—

**ç„¦ç‚¹å’ŒçŠ¶æ€ï¼š**

**SetFocus æ–¹æ³•ï¼š**
```csharp
public static IntPtr SetFocus(IntPtr hWnd)
```
- **å‚æ•°ï¼š** `hWnd` - çª—å£å¥æŸ„
- **è¿”å›å€¼ï¼š** ä¹‹å‰æ‹¥æœ‰ç„¦ç‚¹çš„çª—å£å¥æŸ„
- **ç”¨é€”ï¼š** è®¾ç½®çª—å£ç„¦ç‚¹

**GetFocus æ–¹æ³•ï¼š**
```csharp
public static IntPtr GetFocus()
```
- **è¿”å›å€¼ï¼š** å½“å‰æ‹¥æœ‰ç„¦ç‚¹çš„çª—å£å¥æŸ„
- **ç”¨é€”ï¼š** è·å–å½“å‰ç„¦ç‚¹çª—å£

**IsWindowEnabled æ–¹æ³•ï¼š**
```csharp
public static bool IsWindowEnabled(IntPtr hWnd)
```
- **å‚æ•°ï¼š** `hWnd` - çª—å£å¥æŸ„
- **è¿”å›å€¼ï¼š** çª—å£æ˜¯å¦å¯ç”¨
- **ç”¨é€”ï¼š** æ£€æŸ¥çª—å£æ˜¯å¦å¯ç”¨

**IsIconic æ–¹æ³•ï¼š**
```csharp
public static bool IsIconic(int hWnd)
```
- **å‚æ•°ï¼š** `hWnd` - çª—å£å¥æŸ„
- **è¿”å›å€¼ï¼š** çª—å£æ˜¯å¦æœ€å°åŒ–
- **ç”¨é€”ï¼š** æ£€æŸ¥çª—å£æ˜¯å¦æœ€å°åŒ–

**é”®ç›˜å’Œè¾“å…¥ï¼š**

**KeybdEvent æ–¹æ³•ï¼š**
```csharp
public static void KeybdEvent(byte bVk, byte bScan, int dwFlags, int dwExtraInfo)
```
- **å‚æ•°ï¼š**
  - `bVk` - è™šæ‹Ÿé”®ç 
  - `bScan` - æ‰«æç 
  - `dwFlags` - æ“ä½œæ ‡å¿—
  - `dwExtraInfo` - é¢å¤–ä¿¡æ¯
- **ç”¨é€”ï¼š** æ¨¡æ‹Ÿé”®ç›˜æŒ‰é”®

**GetKeyState æ–¹æ³•ï¼š**
```csharp
public static short GetKeyState(int nVirtKey)
```
- **å‚æ•°ï¼š** `nVirtKey` - è™šæ‹Ÿé”®ç 
- **è¿”å›å€¼ï¼š** æŒ‰é”®çŠ¶æ€
- **ç”¨é€”ï¼š** è·å–æŒ‰é”®çš„å½“å‰çŠ¶æ€

**GetKeyboardLayout æ–¹æ³•ï¼š**
```csharp
public static IntPtr GetKeyboardLayout(int idThread)
```
- **å‚æ•°ï¼š** `idThread` - çº¿ç¨‹ID
- **è¿”å›å€¼ï¼š** é”®ç›˜å¸ƒå±€å¥æŸ„
- **ç”¨é€”ï¼š** è·å–æŒ‡å®šçº¿ç¨‹çš„è¾“å…¥æ³•å¸ƒå±€

**ToAscii æ–¹æ³•ï¼š**
```csharp
public static int ToAscii(int uVirtKey, int uScanCode, byte[] lpKeyState, byte[] lpChar, int uFlags)
```
- **å‚æ•°ï¼š**
  - `uVirtKey` - è™šæ‹Ÿé”®ç 
  - `uScanCode` - æ‰«æç 
  - `lpKeyState` - é”®ç›˜çŠ¶æ€æ•°ç»„
  - `lpChar` - è¾“å‡ºå­—ç¬¦ç¼“å†²åŒº
  - `uFlags` - æ ‡å¿—
- **è¿”å›å€¼ï¼š** è½¬æ¢çš„å­—ç¬¦æ•°
- **ç”¨é€”ï¼š** å°†è™šæ‹Ÿé”®ç è½¬æ¢ä¸ºASCIIå­—ç¬¦

**çº¿ç¨‹å’Œè¿›ç¨‹ï¼š**

**GetWindowThreadProcessId æ–¹æ³•é‡è½½ï¼š**
```csharp
// è¾“å‡ºè¿›ç¨‹IDç‰ˆæœ¬
public static uint GetWindowThreadProcessId(IntPtr hWnd, out uint lpdwProcessId)

// è¾“å‡ºè¿›ç¨‹IDç‰ˆæœ¬ï¼ˆintï¼‰
public static uint GetWindowThreadProcessId(IntPtr hWnd, out int lpdwProcessId)
```
- **å‚æ•°ï¼š**
  - `hWnd` - çª—å£å¥æŸ„
  - `lpdwProcessId` - è¾“å‡ºçš„è¿›ç¨‹ID
- **è¿”å›å€¼ï¼š** çº¿ç¨‹ID
- **ç”¨é€”ï¼š** è·å–çª—å£å¯¹åº”çš„çº¿ç¨‹å’Œè¿›ç¨‹ID

**GetGUIThreadInfo æ–¹æ³•ï¼š**
```csharp
public static bool GetGUIThreadInfo(uint idThread, ref GuiThreadInfo lpgui)
```
- **å‚æ•°ï¼š**
  - `idThread` - çº¿ç¨‹ID
  - `lpgui` - GUIçº¿ç¨‹ä¿¡æ¯ç»“æ„
- **è¿”å›å€¼ï¼š** æ˜¯å¦æˆåŠŸ
- **ç”¨é€”ï¼š** è·å–çº¿ç¨‹å¯¹åº”çš„çª—ä½“ä¿¡æ¯

#### WindowsAPI ç³»ç»Ÿå·¥å…·ç±»

æä¾›æ›´é«˜çº§çš„Windows APIå°è£…ï¼ŒåŒ…æ‹¬å†…å­˜ç®¡ç†ã€æ•°æ®è½¬æ¢å’Œè¾“å…¥æ³•æ§åˆ¶ç­‰åŠŸèƒ½ã€‚

**å†…å­˜ç®¡ç†ï¼š**

**GlobalLock æ–¹æ³•ï¼š**
```csharp
public static IntPtr GlobalLock(IntPtr hMem)
```
- **å‚æ•°ï¼š** `hMem` - å†…å­˜å¥æŸ„
- **è¿”å›å€¼ï¼š** å†…å­˜æŒ‡é’ˆ
- **ç”¨é€”ï¼š** é”å®šå…¨å±€å†…å­˜

**GlobalUnlock æ–¹æ³•ï¼š**
```csharp
public static bool GlobalUnlock(IntPtr hMem)
```
- **å‚æ•°ï¼š** `hMem` - å†…å­˜å¥æŸ„
- **è¿”å›å€¼ï¼š** æ˜¯å¦æˆåŠŸ
- **ç”¨é€”ï¼š** è§£é”å…¨å±€å†…å­˜

**GlobalSize æ–¹æ³•ï¼š**
```csharp
public static uint GlobalSize(IntPtr hMem)
```
- **å‚æ•°ï¼š** `hMem` - å†…å­˜å¥æŸ„
- **è¿”å›å€¼ï¼š** å†…å­˜å—å¤§å°
- **ç”¨é€”ï¼š** è·å–å…¨å±€å†…å­˜å—å¤§å°

**GlobalLockTask æ–¹æ³•ï¼š**
```csharp
public static void GlobalLockTask(IntPtr hMem, Action<IntPtr> action)
```
- **å‚æ•°ï¼š**
  - `hMem` - å†…å­˜å¥æŸ„
  - `action` - åœ¨é”å®šçŠ¶æ€ä¸‹æ‰§è¡Œçš„æ“ä½œ
- **ç”¨é€”ï¼š** å®‰å…¨åœ°é”å®šå’Œé‡Šæ”¾å†…å­˜

**æ•°æ®è½¬æ¢ï¼š**

**BytesToStruct æ–¹æ³•é‡è½½ï¼š**
```csharp
// å¸¦åç§»ç‰ˆæœ¬
public static T BytesToStruct<T>(byte[] bytes, ref int offset) where T : struct

// åŸºæœ¬ç‰ˆæœ¬
public static T BytesToStruct<T>(byte[] bytes) where T : struct
```
- **ç±»å‹å‚æ•°ï¼š** `T` - ç»“æ„ä½“ç±»å‹
- **å‚æ•°ï¼š**
  - `bytes` - å­—èŠ‚æ•°ç»„
  - `offset` - åç§»é‡ï¼ˆå¼•ç”¨å‚æ•°ï¼‰
- **è¿”å›å€¼ï¼š** è½¬æ¢åçš„ç»“æ„ä½“
- **ç”¨é€”ï¼š** å°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºç»“æ„ä½“

**StructToBytes æ–¹æ³•ï¼š**
```csharp
public static byte[] StructToBytes<T>(T structObj) where T : unmanaged
```
- **ç±»å‹å‚æ•°ï¼š** `T` - éæ‰˜ç®¡ç»“æ„ä½“ç±»å‹
- **å‚æ•°ï¼š** `structObj` - ç»“æ„ä½“å¯¹è±¡
- **è¿”å›å€¼ï¼š** å­—èŠ‚æ•°ç»„
- **ç”¨é€”ï¼š** å°†ç»“æ„ä½“è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„

**DLLå‡½æ•°ï¼š**

**GetProcAddress æ–¹æ³•ï¼š**
```csharp
public static IntPtr GetProcAddress(IntPtr hModule, string procName)
```
- **å‚æ•°ï¼š**
  - `hModule` - DLLæ¨¡å—å¥æŸ„
  - `procName` - å‡½æ•°å
- **è¿”å›å€¼ï¼š** å‡½æ•°åœ°å€
- **ç”¨é€”ï¼š** è·å–DLLä¸­å‡½æ•°çš„åœ°å€

**è¾“å…¥æ³•æ§åˆ¶ï¼š**

**ImmGetContext æ–¹æ³•ï¼š**
```csharp
public static IntPtr ImmGetContext(IntPtr hWnd)
```
- **å‚æ•°ï¼š** `hWnd` - çª—å£å¥æŸ„
- **è¿”å›å€¼ï¼š** è¾“å…¥æ³•ä¸Šä¸‹æ–‡å¥æŸ„
- **ç”¨é€”ï¼š** è·å–æŒ‡å®šçª—å£çš„è¾“å…¥æ³•çŠ¶æ€

**ImmSetOpenStatus æ–¹æ³•ï¼š**
```csharp
public static bool ImmSetOpenStatus(IntPtr hIMC, bool fOpen)
```
- **å‚æ•°ï¼š**
  - `hIMC` - è¾“å…¥æ³•ä¸Šä¸‹æ–‡å¥æŸ„
  - `fOpen` - æ˜¯å¦æ‰“å¼€è¾“å…¥æ³•
- **è¿”å›å€¼ï¼š** æ˜¯å¦æˆåŠŸ
- **ç”¨é€”ï¼š** è®¾ç½®è¾“å…¥æ³•çš„å¼€å…³çŠ¶æ€

**ImmGetOpenStatus æ–¹æ³•ï¼š**
```csharp
public static bool ImmGetOpenStatus(IntPtr hIMC)
```
- **å‚æ•°ï¼š** `hIMC` - è¾“å…¥æ³•ä¸Šä¸‹æ–‡å¥æŸ„
- **è¿”å›å€¼ï¼š** è¾“å…¥æ³•æ˜¯å¦æ‰“å¼€
- **ç”¨é€”ï¼š** è·å–è¾“å…¥æ³•çš„å¼€å…³çŠ¶æ€

**ImmGetConversionStatus æ–¹æ³•ï¼š**
```csharp
public static bool ImmGetConversionStatus(IntPtr hIMC, out int lpfdwConversion, out int lpfdwSentence)
```
- **å‚æ•°ï¼š**
  - `hIMC` - è¾“å…¥æ³•ä¸Šä¸‹æ–‡å¥æŸ„
  - `lpfdwConversion` - è¾“å‡ºè½¬æ¢æ¨¡å¼
  - `lpfdwSentence` - è¾“å‡ºå¥å­æ¨¡å¼
- **è¿”å›å€¼ï¼š** æ˜¯å¦æˆåŠŸ
- **ç”¨é€”ï¼š** è·å–è¾“å…¥æ³•çš„è½¬æ¢çŠ¶æ€

**ImmGetVirtualKey æ–¹æ³•ï¼š**
```csharp
public static uint ImmGetVirtualKey(IntPtr hWnd)
```
- **å‚æ•°ï¼š** `hWnd` - çª—å£å¥æŸ„
- **è¿”å›å€¼ï¼š** è™šæ‹Ÿé”®ç 
- **ç”¨é€”ï¼š** è·å–è¾“å…¥æ³•çš„è™šæ‹Ÿé”®ç 

**ç³»ç»Ÿå·¥å…·ï¼š**

**CheckLowLevelHooksTimeout æ–¹æ³•ï¼š**
```csharp
public static void CheckLowLevelHooksTimeout(int timeoutMs)
```
- **å‚æ•°ï¼š** `timeoutMs` - è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
- **ç”¨é€”ï¼š** è®¾ç½®ä½çº§é’©å­è¶…æ—¶å¤„ç†ï¼Œé˜²æ­¢ç³»ç»Ÿé™åˆ¶

**CloseWindow æ–¹æ³•ï¼š**
```csharp
public static bool CloseWindow(IntPtr hWnd)
```
- **å‚æ•°ï¼š** `hWnd` - çª—å£å¥æŸ„
- **è¿”å›å€¼ï¼š** æ˜¯å¦æˆåŠŸ
- **ç”¨é€”ï¼š** å…³é—­æŒ‡å®šçª—å£

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

**çª—å£æ“ä½œç¤ºä¾‹ï¼š**
```csharp
// æŸ¥æ‰¾AutoCADçª—å£
var acadWindow = PInvokeUser32.FindWindow("Afx:400000:b:10011:6:10", null);
if (acadWindow != IntPtr.Zero)
{
    // è·å–çª—å£æ ‡é¢˜
    var titleLength = PInvokeUser32.GetWindowTextLength(acadWindow);
    var title = new StringBuilder(titleLength + 1);
    PInvokeUser32.GetWindowText(acadWindow, title, title.Capacity);

    Console.WriteLine($"æ‰¾åˆ°AutoCADçª—å£: {title}");

    // è®¾ç½®ç„¦ç‚¹
    PInvokeUser32.SetFocus(acadWindow);

    // è·å–å®¢æˆ·åŒºå¤§å°
    if (PInvokeUser32.GetClientRect(acadWindow, out var clientRect))
    {
        Console.WriteLine($"å®¢æˆ·åŒºå¤§å°: {clientRect.Width} x {clientRect.Height}");
    }
}
```

**æ¶ˆæ¯å‘é€ç¤ºä¾‹ï¼š**
```csharp
// å‘é€é”®ç›˜æ¶ˆæ¯
var targetWindow = PInvokeUser32.GetForegroundWindow();
if (targetWindow != IntPtr.Zero)
{
    // å‘é€ESCé”®
    const int WM_KEYDOWN = 0x0100;
    const int VK_ESCAPE = 0x1B;

    PInvokeUser32.SendMessage(targetWindow, WM_KEYDOWN, new IntPtr(VK_ESCAPE), IntPtr.Zero);

    // æˆ–è€…ä½¿ç”¨PostMessageå¼‚æ­¥å‘é€
    PInvokeUser32.PostMessage(targetWindow, WM_KEYDOWN, new IntPtr(VK_ESCAPE), IntPtr.Zero);
}
```

**è¾“å…¥æ³•æ§åˆ¶ç¤ºä¾‹ï¼š**
```csharp
var currentWindow = PInvokeUser32.GetForegroundWindow();
var imeContext = WindowsAPI.ImmGetContext(currentWindow);

if (imeContext != IntPtr.Zero)
{
    // æ£€æŸ¥è¾“å…¥æ³•çŠ¶æ€
    bool isOpen = WindowsAPI.ImmGetOpenStatus(imeContext);
    Console.WriteLine($"è¾“å…¥æ³•çŠ¶æ€: {(isOpen ? "å¼€å¯" : "å…³é—­")}");

    // å…³é—­è¾“å…¥æ³•
    if (isOpen)
    {
        WindowsAPI.ImmSetOpenStatus(imeContext, false);
        Console.WriteLine("è¾“å…¥æ³•å·²å…³é—­");
    }

    // è·å–è½¬æ¢çŠ¶æ€
    if (WindowsAPI.ImmGetConversionStatus(imeContext, out int conversion, out int sentence))
    {
        Console.WriteLine($"è½¬æ¢æ¨¡å¼: {conversion}, å¥å­æ¨¡å¼: {sentence}");
    }
}
```

**å†…å­˜æ“ä½œç¤ºä¾‹ï¼š**
```csharp
// ç»“æ„ä½“ä¸å­—èŠ‚æ•°ç»„è½¬æ¢
public struct Point3D
{
    public double X, Y, Z;
}

var point = new Point3D { X = 1.0, Y = 2.0, Z = 3.0 };

// ç»“æ„ä½“è½¬å­—èŠ‚æ•°ç»„
var bytes = WindowsAPI.StructToBytes(point);
Console.WriteLine($"ç»“æ„ä½“å¤§å°: {bytes.Length} å­—èŠ‚");

// å­—èŠ‚æ•°ç»„è½¬ç»“æ„ä½“
var restoredPoint = WindowsAPI.BytesToStruct<Point3D>(bytes);
Console.WriteLine($"æ¢å¤çš„ç‚¹: ({restoredPoint.X}, {restoredPoint.Y}, {restoredPoint.Z})");

// å®‰å…¨çš„å†…å­˜æ“ä½œ
IntPtr memHandle = /* è·å–å†…å­˜å¥æŸ„ */;
WindowsAPI.GlobalLockTask(memHandle, ptr =>
{
    // åœ¨é”å®šçŠ¶æ€ä¸‹æ“ä½œå†…å­˜
    // è‡ªåŠ¨è§£é”
});
```

**å®é™…åº”ç”¨ç¤ºä¾‹ï¼š**
```csharp
// CADçª—å£ç®¡ç†å·¥å…·
public class CadWindowManager
{
    public static void BringCadToFront()
    {
        var acadWindow = PInvokeUser32.FindWindow("Afx:400000:b:10011:6:10", null);
        if (acadWindow != IntPtr.Zero)
        {
            PInvokeUser32.SetFocus(acadWindow);

            // å¦‚æœçª—å£æœ€å°åŒ–ï¼Œå…ˆæ¢å¤
            if (PInvokeUser32.IsIconic((int)acadWindow))
            {
                const int SW_RESTORE = 9;
                PInvokeUser32.SendMessage(acadWindow, 0x0112, new IntPtr(SW_RESTORE), IntPtr.Zero);
            }
        }
    }

    public static void DisableImeForCad()
    {
        var acadWindow = PInvokeUser32.FindWindow("Afx:400000:b:10011:6:10", null);
        if (acadWindow != IntPtr.Zero)
        {
            var imeContext = WindowsAPI.ImmGetContext(acadWindow);
            if (imeContext != IntPtr.Zero)
            {
                WindowsAPI.ImmSetOpenStatus(imeContext, false);
            }
        }
    }

    public static void SendEscapeToCAD()
    {
        var acadWindow = PInvokeUser32.FindWindow("Afx:400000:b:10011:6:10", null);
        if (acadWindow != IntPtr.Zero)
        {
            const int WM_KEYDOWN = 0x0100;
            const int VK_ESCAPE = 0x1B;
            PInvokeUser32.PostMessage(acadWindow, WM_KEYDOWN, new IntPtr(VK_ESCAPE), IntPtr.Zero);
        }
    }
}
```

#### RandomEx éšæœºæ•°æ‰©å±•ç±»

æä¾›å¢å¼ºçš„éšæœºæ•°ç”ŸæˆåŠŸèƒ½ï¼Œæ”¯æŒå„ç§æ•°æ®ç±»å‹å’ŒèŒƒå›´çš„éšæœºå€¼ç”Ÿæˆã€‚

**ä¸»è¦æ–¹æ³•ï¼š**
- `NextDouble(double min, double max)` - ç”ŸæˆæŒ‡å®šèŒƒå›´çš„éšæœºåŒç²¾åº¦æ•°
- `NextPoint3d(Point3d min, Point3d max)` - ç”Ÿæˆéšæœºä¸‰ç»´ç‚¹
- `NextColor()` - ç”Ÿæˆéšæœºé¢œè‰²
- `NextBool(double probability)` - æŒ‰æ¦‚ç‡ç”Ÿæˆéšæœºå¸ƒå°”å€¼
- `NextString(int length, string chars)` - ç”Ÿæˆéšæœºå­—ç¬¦ä¸²

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
var random = new Random();

// ç”Ÿæˆéšæœºç‚¹
var randomPoint = RandomEx.NextPoint3d(
    new Point3d(0, 0, 0),
    new Point3d(100, 100, 0));

// ç”Ÿæˆéšæœºé¢œè‰²
var randomColor = RandomEx.NextColor();

// æŒ‰70%æ¦‚ç‡ç”Ÿæˆtrue
var randomBool = RandomEx.NextBool(0.7);
```

#### SystemEx ç³»ç»Ÿæ‰©å±•ç±»

æä¾›ç³»ç»Ÿçº§æ“ä½œçš„æ‰©å±•æ–¹æ³•ï¼ŒåŒ…æ‹¬è¿›ç¨‹ç®¡ç†ã€æ–‡ä»¶æ“ä½œå’Œç¯å¢ƒå˜é‡å¤„ç†ã€‚

**ä¸»è¦æ–¹æ³•ï¼š**
- `GetCurrentProcessName()` - è·å–å½“å‰è¿›ç¨‹åç§°
- `IsProcessRunning(string processName)` - æ£€æŸ¥è¿›ç¨‹æ˜¯å¦è¿è¡Œ
- `GetEnvironmentVariable(string name, string defaultValue)` - å®‰å…¨è·å–ç¯å¢ƒå˜é‡
- `ExecuteCommand(string command, string arguments)` - æ‰§è¡Œç³»ç»Ÿå‘½ä»¤
- `GetSystemInfo()` - è·å–ç³»ç»Ÿä¿¡æ¯

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// æ£€æŸ¥AutoCADæ˜¯å¦è¿è¡Œ
bool isAcadRunning = SystemEx.IsProcessRunning("acad");

// è·å–ç¯å¢ƒå˜é‡
string cadPath = SystemEx.GetEnvironmentVariable("ACAD_PATH", @"C:\Program Files\Autodesk\AutoCAD 2024");

// æ‰§è¡Œç³»ç»Ÿå‘½ä»¤
var result = SystemEx.ExecuteCommand("dir", @"C:\");
```

#### DebugEx è°ƒè¯•å·¥å…·ç±»

æä¾›å¢å¼ºçš„è°ƒè¯•åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ€§èƒ½æµ‹é‡ã€å†…å­˜ç›‘æ§å’Œæ—¥å¿—è®°å½•ã€‚

**ä¸»è¦æ–¹æ³•ï¼š**
- `Stopwatch(Action action, string description)` - æµ‹é‡ä»£ç æ‰§è¡Œæ—¶é—´
- `MemoryUsage()` - è·å–å½“å‰å†…å­˜ä½¿ç”¨æƒ…å†µ
- `WriteDebugInfo(string message, params object[] args)` - å†™å…¥è°ƒè¯•ä¿¡æ¯
- `Assert(bool condition, string message)` - æ–­è¨€æ£€æŸ¥
- `DumpObject(object obj)` - è¾“å‡ºå¯¹è±¡è¯¦ç»†ä¿¡æ¯

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// æ€§èƒ½æµ‹é‡
DebugEx.Stopwatch(() =>
{
    // è¦æµ‹é‡çš„ä»£ç 
    using (var tr = new DBTrans())
    {
        var entities = tr.CurrentSpace.GetEntities<Entity>();
        tr.Commit();
    }
}, "è·å–æ‰€æœ‰å®ä½“");

// å†…å­˜ç›‘æ§
var memInfo = DebugEx.MemoryUsage();
Console.WriteLine($"å†…å­˜ä½¿ç”¨: {memInfo.WorkingSet / 1024 / 1024} MB");

// è°ƒè¯•æ–­è¨€
DebugEx.Assert(entities.Count() > 0, "å®ä½“æ•°é‡åº”è¯¥å¤§äº0");
```

#### EnumEx æšä¸¾æ‰©å±•ç±»

æä¾›æšä¸¾ç±»å‹çš„æ‰©å±•æ“ä½œï¼ŒåŒ…æ‹¬æè¿°è·å–ã€å€¼è½¬æ¢å’ŒéªŒè¯åŠŸèƒ½ã€‚

**ä¸»è¦æ–¹æ³•ï¼š**
- `GetDescription<T>(T enumValue)` - è·å–æšä¸¾çš„æè¿°ç‰¹æ€§
- `GetValues<T>()` - è·å–æšä¸¾çš„æ‰€æœ‰å€¼
- `Parse<T>(string value, bool ignoreCase)` - å®‰å…¨è§£ææšä¸¾
- `IsDefined<T>(object value)` - æ£€æŸ¥å€¼æ˜¯å¦ä¸ºæœ‰æ•ˆæšä¸¾
- `GetNames<T>()` - è·å–æšä¸¾çš„æ‰€æœ‰åç§°

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// è·å–æšä¸¾æè¿°
var description = EnumEx.GetDescription(OpenMode.ForRead);

// å®‰å…¨è§£ææšä¸¾
if (EnumEx.TryParse<OpenMode>("ForWrite", out var mode))
{
    Console.WriteLine($"è§£ææˆåŠŸ: {mode}");
}

// è·å–æ‰€æœ‰æšä¸¾å€¼
var allModes = EnumEx.GetValues<OpenMode>();
foreach (var openMode in allModes)
{
    Console.WriteLine($"æ¨¡å¼: {openMode}");
}
```

#### ArgumentNullEx å‚æ•°éªŒè¯ç±»

æä¾›å‚æ•°ç©ºå€¼æ£€æŸ¥å’ŒéªŒè¯åŠŸèƒ½ï¼Œå¢å¼ºä»£ç çš„å¥å£®æ€§ã€‚

**ä¸»è¦æ–¹æ³•ï¼š**
- `ThrowIfNull(object argument, string paramName)` - ç©ºå€¼æ£€æŸ¥
- `ThrowIfNullOrEmpty(string argument, string paramName)` - å­—ç¬¦ä¸²ç©ºå€¼æ£€æŸ¥
- `ThrowIfNullOrWhiteSpace(string argument, string paramName)` - å­—ç¬¦ä¸²ç©ºç™½æ£€æŸ¥
- `ThrowIfOutOfRange<T>(T value, T min, T max, string paramName)` - èŒƒå›´æ£€æŸ¥
- `ThrowIfNegative(int value, string paramName)` - è´Ÿæ•°æ£€æŸ¥

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
public void ProcessEntity(Entity entity, string layerName, double scale)
{
    // å‚æ•°éªŒè¯
    ArgumentNullEx.ThrowIfNull(entity, nameof(entity));
    ArgumentNullEx.ThrowIfNullOrWhiteSpace(layerName, nameof(layerName));
    ArgumentNullEx.ThrowIfOutOfRange(scale, 0.1, 10.0, nameof(scale));

    // å®‰å…¨æ‰§è¡Œæ“ä½œ
    entity.Layer = layerName;
    // ... å…¶ä»–æ“ä½œ
}
```

### ç¼–è¾‘å™¨æ‰©å±•ç±»

#### EditorEx æ‰©å±•
```csharp
public static class EditorEx
```

**é€‰æ‹©æ“ä½œï¼š**
- `SelectAtPoint(Editor editor, Point3d point)`: ç‚¹é€‰å®ä½“
- `SelectByFilter(Editor editor, SelectionFilter filter)`: æŒ‰è¿‡æ»¤å™¨é€‰æ‹©
- `SelectCrossingWindow(Editor editor, Point3d pt1, Point3d pt2)`: äº¤å‰çª—å£é€‰æ‹©
- `SelectWindow(Editor editor, Point3d pt1, Point3d pt2)`: çª—å£é€‰æ‹©

**ç”¨æˆ·è¾“å…¥ï¼š**
- `GetPoint(Editor editor, string message)`: è·å–ç‚¹
- `GetDistance(Editor editor, string message)`: è·å–è·ç¦»
- `GetAngle(Editor editor, string message)`: è·å–è§’åº¦
- `GetKeyword(Editor editor, string message, params string[] keywords)`: è·å–å…³é”®å­—

**Lisp æ‰§è¡Œï¼š**
- `RunLisp(Editor editor, string lispCode)`: æ‰§è¡ŒLispä»£ç 
- `RunLisp(Editor editor, string lispCode, RunLispFlag flag)`: å¸¦æ ‡å¿—æ‰§è¡ŒLisp

### çª—å£å’ŒUIæ‰©å±•

#### WindowEx æ‰©å±•
```csharp
public static class WindowEx
```

**çª—å£æ“ä½œï¼š**
- `AddEscQuit(Window window)`: æ·»åŠ ESCé€€å‡ºåŠŸèƒ½
- `SetWindowScale(Window window, double scale)`: è®¾ç½®çª—å£æ¯”ä¾‹
- `CenterWindow(Window window)`: å±…ä¸­çª—å£

#### PaneEx æ‰©å±•
```csharp
public static class PaneEx
```

**æ‰˜ç›˜æ“ä½œï¼š**
- `SetMargin(Pane pane, PaneMarginType horizontal, PaneMarginType vertical)`: è®¾ç½®è¾¹è·
- `SetDockEnabled(Pane pane, bool enabled)`: è®¾ç½®åœé å¯ç”¨

**è¾¹è·ç±»å‹ï¼š**
- `PaneMarginType.NONE`: æ— è¾¹è·
- `PaneMarginType.LEFT`: å·¦è¾¹è·
- `PaneMarginType.RIGHT`: å³è¾¹è·
- `PaneMarginType.TOP`: ä¸Šè¾¹è·
- `PaneMarginType.BOTTOM`: ä¸‹è¾¹è·

#### DBDictionaryEx æ‰©å±•
```csharp
public static class DBDictionaryEx
```

**å­—å…¸æ“ä½œï¼š**
- `GetAllObjects<T>(DBDictionary dict)`: è·å–ç‰¹å®šç±»å‹çš„æ‰€æœ‰å¯¹è±¡
- `GetData<T>(DBDictionary dict, string key)`: æŒ‰é”®è·å–ç±»å‹åŒ–å¯¹è±¡
- `SetData<T>(DBDictionary dict, string key, T newValue)`: æ·»åŠ /æ›´æ–°å­—å…¸æ¡ç›®

**XRecord æ“ä½œï¼š**
- `GetXRecord(DBDictionary dict, string key)`: è·å–æ‰©å±•è®°å½•
- `SetXRecord(DBDictionary dict, string key, XRecordDataList rb)`: è®¾ç½®æ‰©å±•è®°å½•

**ç¼–ç»„ç®¡ç†ï¼š**
- `AddGroup(DBDictionary dict, string name, ObjectIdCollection ids)`: åˆ›å»ºå®ä½“ç»„
- `GetGroups(DBDictionary dict, Func<Group, bool> func)`: ä½¿ç”¨è¿‡æ»¤å™¨æŸ¥è¯¢ç»„
- `GetGroups(Entity ent)`: è·å–åŒ…å«å®ä½“çš„ç»„
- `RemoveNullGroup(DBDictionary dict)`: åˆ é™¤ç©ºç»„

**å·¥å…·æ–¹æ³•ï¼š**
- `GetXDictionary(DBObject obj, OpenMode openMode)`: è·å–æ‰©å±•å­—å…¸
- `GetSubDictionary(DBDictionary dict, bool createSubDictionary, IEnumerable<string> dictNames)`: å¯¼èˆªåµŒå¥—å­—å…¸

### å®¹å·®å’Œæ¯”è¾ƒç±»

#### TolerancePoint2d ç±»
```csharp
public class TolerancePoint2d : IEqualityComparer<Point2d>
```

**ç”¨é€”ï¼š** ä¸º LINQ Distinct æ“ä½œæä¾›åŸºäºå®¹å·®çš„ç‚¹æ¯”è¾ƒ

**æ„é€ å‡½æ•°ï¼š**
- `TolerancePoint2d(double tolerance)`: ä½¿ç”¨å®¹å·®å€¼åˆå§‹åŒ–

**æ–¹æ³•ï¼š**
- `Equals(Point2d a, Point2d b)`: åœ¨å®¹å·®èŒƒå›´å†…æ¯”è¾ƒç‚¹
- `GetHashCode(Point2d obj)`: ä¸ºç‚¹ç”Ÿæˆå“ˆå¸Œç 

### IFoxCAD.Basal å‘½åç©ºé—´è¯¦ç»†API

#### ArrayEx æ•°ç»„æ‰©å±•ç±»

é«˜æ€§èƒ½æ•°ç»„æ“ä½œæ‰©å±•ï¼Œæä¾›æ•°ç»„åˆå¹¶ã€å»é‡ç­‰åŠŸèƒ½ã€‚

**Combine2 æ–¹æ³•ï¼š**
```csharp
public static T[] Combine2<T>(T[] a, T[] b)
```
- **ç±»å‹å‚æ•°ï¼š** `T` - æ•°ç»„å…ƒç´ ç±»å‹
- **å‚æ•°ï¼š**
  - `a` - ç¬¬ä¸€ä¸ªæ•°ç»„
  - `b` - ç¬¬äºŒä¸ªæ•°ç»„
- **è¿”å›å€¼ï¼š** åˆå¹¶åçš„æ–°æ•°ç»„
- **ç”¨é€”ï¼š** é«˜æ•ˆåˆå¹¶ä¸¤ä¸ªæ•°ç»„

**Deduplication æ–¹æ³•ï¼š**
```csharp
public static List<T> Deduplication<T>(List<T> list, Func<T, T, bool> equalityComparer)
```
- **ç±»å‹å‚æ•°ï¼š** `T` - åˆ—è¡¨å…ƒç´ ç±»å‹
- **å‚æ•°ï¼š**
  - `list` - è¦å»é‡çš„åˆ—è¡¨
  - `equalityComparer` - ç›¸ç­‰æ€§æ¯”è¾ƒå‡½æ•°
- **è¿”å›å€¼ï¼š** å»é‡åçš„åˆ—è¡¨
- **ç”¨é€”ï¼š** æŒ‰è‡ªå®šä¹‰è§„åˆ™å¯¹åˆ—è¡¨è¿›è¡Œå»é‡
- **è¯´æ˜ï¼š** é€‚ç”¨äºæ•°å€¼ç±»å‹æ¯”è¾ƒå’Œç‰¹å®šè§„åˆ™æ¯”è¾ƒï¼Œå¯¹äºå“ˆå¸Œæ¯”è¾ƒå»ºè®®ä½¿ç”¨HashSet

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// æ•°ç»„åˆå¹¶
var array1 = new int[] { 1, 2, 3 };
var array2 = new int[] { 4, 5, 6 };
var combined = ArrayEx.Combine2(array1, array2);
// ç»“æœ: [1, 2, 3, 4, 5, 6]

// è‡ªå®šä¹‰å»é‡
var points = new List<Point3d>
{
    new Point3d(0, 0, 0),
    new Point3d(0.001, 0.001, 0),
    new Point3d(1, 1, 0)
};

var deduped = ArrayEx.Deduplication(points, (p1, p2) =>
    p1.DistanceTo(p2) < 0.01); // è·ç¦»å°äº0.01è®¤ä¸ºæ˜¯é‡å¤ç‚¹
// ç»“æœ: å»é™¤äº†è·ç¦»è¿‡è¿‘çš„é‡å¤ç‚¹
```

#### LinqEx LINQæ‰©å±•ç±»

å¢å¼ºçš„LINQæ“ä½œï¼Œæä¾›é«˜çº§æŸ¥æ‰¾ã€æ’åºå’Œæ¯”è¾ƒåŠŸèƒ½ã€‚

**FindByMax æ–¹æ³•é‡è½½ï¼š**
```csharp
// åŸºæœ¬ç‰ˆæœ¬
public static TValue FindByMax<TValue, TKey>(IEnumerable<TValue> source, Func<TValue, TKey> keySelector)

// å¸¦è¾“å‡ºé”®å€¼ç‰ˆæœ¬
public static TValue FindByMax<TValue, TKey>(IEnumerable<TValue> source, out TKey maxKey, Func<TValue, TKey> keySelector)

// æ¯”è¾ƒå™¨ç‰ˆæœ¬
public static TValue FindByMax<TValue>(IEnumerable<TValue> source, Comparison<TValue> comparison)
```
- **ç±»å‹å‚æ•°ï¼š**
  - `TValue` - å€¼ç±»å‹
  - `TKey` - é”®ç±»å‹
- **å‚æ•°ï¼š**
  - `source` - æºåºåˆ—
  - `keySelector` - é”®é€‰æ‹©å‡½æ•°
  - `maxKey` - è¾“å‡ºçš„æœ€å¤§é”®å€¼
  - `comparison` - æ¯”è¾ƒå™¨
- **è¿”å›å€¼ï¼š** å…·æœ‰æœ€å¤§é”®å€¼çš„å…ƒç´ 
- **ç”¨é€”ï¼š** æŒ‰è½¬æ¢å‡½æ•°æˆ–æ¯”è¾ƒå™¨æ‰¾å‡ºåºåˆ—ä¸­æœ€å¤§é”®å€¼çš„å¯¹åº”å€¼

**FindByMin æ–¹æ³•é‡è½½ï¼š**
```csharp
// åŸºæœ¬ç‰ˆæœ¬
public static TValue FindByMin<TValue, TKey>(IEnumerable<TValue> source, Func<TValue, TKey> keySelector)

// å¸¦è¾“å‡ºé”®å€¼ç‰ˆæœ¬
public static TValue FindByMin<TValue, TKey>(IEnumerable<TValue> source, out TKey minKey, Func<TValue, TKey> keySelector)

// æ¯”è¾ƒå™¨ç‰ˆæœ¬
public static TValue FindByMin<TValue>(IEnumerable<TValue> source, Comparison<TValue> comparison)
```
- **ç±»å‹å‚æ•°ï¼š**
  - `TValue` - å€¼ç±»å‹
  - `TKey` - é”®ç±»å‹
- **å‚æ•°ï¼š**
  - `source` - æºåºåˆ—
  - `keySelector` - é”®é€‰æ‹©å‡½æ•°
  - `minKey` - è¾“å‡ºçš„æœ€å°é”®å€¼
  - `comparison` - æ¯”è¾ƒå™¨
- **è¿”å›å€¼ï¼š** å…·æœ‰æœ€å°é”®å€¼çš„å…ƒç´ 
- **ç”¨é€”ï¼š** æŒ‰è½¬æ¢å‡½æ•°æˆ–æ¯”è¾ƒå™¨æ‰¾å‡ºåºåˆ—ä¸­æœ€å°é”®å€¼çš„å¯¹åº”å€¼

**FindByExt æ–¹æ³•é‡è½½ï¼š**
```csharp
// è½¬æ¢å‡½æ•°ç‰ˆæœ¬
public static (TValue min, TValue max) FindByExt<TValue, TKey>(IEnumerable<TValue> source, Func<TValue, TKey> keySelector)

// æ¯”è¾ƒå™¨ç‰ˆæœ¬
public static (TValue min, TValue max) FindByExt<TValue>(IEnumerable<TValue> source, Comparison<TValue> comparison)
```
- **å‚æ•°ï¼š**
  - `source` - æºåºåˆ—
  - `keySelector` - é”®é€‰æ‹©å‡½æ•°
  - `comparison` - æ¯”è¾ƒå™¨
- **è¿”å›å€¼ï¼š** åŒ…å«æœ€å°å€¼å’Œæœ€å¤§å€¼çš„å…ƒç»„
- **ç”¨é€”ï¼š** ä¸€æ¬¡æ€§æ‰¾å‡ºåºåˆ—ä¸­çš„æœ€å°å€¼å’Œæœ€å¤§å€¼

**FindExt æ–¹æ³•ï¼š**
```csharp
public static (TKey min, TKey max) FindExt<TValue, TKey>(IEnumerable<TValue> source, Func<TValue, TKey> keySelector)
```
- **å‚æ•°ï¼š**
  - `source` - æºåºåˆ—
  - `keySelector` - é”®é€‰æ‹©å‡½æ•°
- **è¿”å›å€¼ï¼š** åŒ…å«æœ€å°é”®å€¼å’Œæœ€å¤§é”®å€¼çš„å…ƒç»„
- **ç”¨é€”ï¼š** æŒ‰è½¬æ¢å‡½æ•°æ‰¾å‡ºåºåˆ—ä¸­æœ€å°å’Œæœ€å¤§é”®å€¼

**OrderBy æ–¹æ³•ï¼š**
```csharp
public static IOrderedEnumerable<T> OrderBy<T, TKey>(IEnumerable<T> source, Func<T, TKey> keySelector, Comparison<TKey> comparison)
```
- **ç±»å‹å‚æ•°ï¼š**
  - `T` - è¾“å…¥ç±»å‹
  - `TKey` - é”®ç±»å‹
- **å‚æ•°ï¼š**
  - `source` - æºåºåˆ—
  - `keySelector` - é”®é€‰æ‹©å‡½æ•°
  - `comparison` - æ¯”è¾ƒå™¨
- **è¿”å›å€¼ï¼š** æ’åºåçš„åºåˆ—
- **ç”¨é€”ï¼š** ä½¿ç”¨æŒ‡å®šçš„æ¯”è¾ƒå™¨å°†åºåˆ—æŒ‰å‡åºæ’åº

**ThenBy æ–¹æ³•ï¼š**
```csharp
public static IOrderedEnumerable<T> ThenBy<T, TKey>(IOrderedEnumerable<T> source, Func<T, TKey> keySelector, Comparison<TKey> comparison)
```
- **ç±»å‹å‚æ•°ï¼š**
  - `T` - è¾“å…¥ç±»å‹
  - `TKey` - é”®ç±»å‹
- **å‚æ•°ï¼š**
  - `source` - å·²æ’åºçš„åºåˆ—
  - `keySelector` - é”®é€‰æ‹©å‡½æ•°
  - `comparison` - æ¯”è¾ƒå™¨
- **è¿”å›å€¼ï¼š** è¿›ä¸€æ­¥æ’åºåçš„åºåˆ—
- **ç”¨é€”ï¼š** ä½¿ç”¨æŒ‡å®šçš„æ¯”è¾ƒå™¨å°†å…¶åçš„åºåˆ—æŒ‰å‡åºæ’åº

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

**æŸ¥æ‰¾æœ€å€¼ç¤ºä¾‹ï¼š**
```csharp
var entities = new List<Entity> { /* å®ä½“åˆ—è¡¨ */ };

// æ‰¾å‡ºé¢ç§¯æœ€å¤§çš„å®ä½“
var largestEntity = entities.FindByMax(e => e.GeometricExtents.Area());

// æ‰¾å‡ºè·ç¦»åŸç‚¹æœ€è¿‘çš„å®ä½“
var nearestEntity = entities.FindByMin(e => e.GeometricExtents.MinPoint.DistanceTo(Point3d.Origin));

// åŒæ—¶æ‰¾å‡ºæœ€å¤§å’Œæœ€å°é¢ç§¯çš„å®ä½“
var (minAreaEntity, maxAreaEntity) = entities.FindByExt(e => e.GeometricExtents.Area());

// æ‰¾å‡ºé¢ç§¯çš„æœ€å°å€¼å’Œæœ€å¤§å€¼
var (minArea, maxArea) = entities.FindExt(e => e.GeometricExtents.Area());

Console.WriteLine($"é¢ç§¯èŒƒå›´: {minArea} - {maxArea}");
```

**è‡ªå®šä¹‰æ’åºç¤ºä¾‹ï¼š**
```csharp
var points = new List<Point3d>
{
    new Point3d(1, 2, 0),
    new Point3d(3, 1, 0),
    new Point3d(2, 3, 0)
};

// æŒ‰è·ç¦»åŸç‚¹çš„è·ç¦»æ’åº
var sortedByDistance = points.OrderBy(
    p => p.DistanceTo(Point3d.Origin),
    (d1, d2) => d1.CompareTo(d2));

// å…ˆæŒ‰Xåæ ‡æ’åºï¼Œå†æŒ‰Yåæ ‡æ’åº
var sortedByXY = points
    .OrderBy(p => p.X, (x1, x2) => x1.CompareTo(x2))
    .ThenBy(p => p.Y, (y1, y2) => y1.CompareTo(y2));

foreach (var point in sortedByXY)
{
    Console.WriteLine($"ç‚¹: ({point.X}, {point.Y})");
}
```

**å®é™…åº”ç”¨ç¤ºä¾‹ï¼š**
```csharp
// CADå®ä½“å¤„ç†ç¤ºä¾‹
using (var tr = new DBTrans())
{
    var allEntities = tr.CurrentSpace.GetEntities<Entity>();

    // æ‰¾å‡ºæœ€å¤§çš„å®ä½“
    var largestEntity = allEntities.FindByMax(e =>
    {
        var ext = e.GeometricExtents;
        return (ext.MaxPoint.X - ext.MinPoint.X) * (ext.MaxPoint.Y - ext.MinPoint.Y);
    });

    // æŒ‰å›¾å±‚åç§°æ’åºå®ä½“
    var entitiesByLayer = allEntities.OrderBy(
        e => e.Layer,
        (layer1, layer2) => string.Compare(layer1, layer2, StringComparison.OrdinalIgnoreCase));

    // å»é™¤é‡å¤çš„åœ†ï¼ˆæŒ‰ä¸­å¿ƒç‚¹å’ŒåŠå¾„ï¼‰
    var circles = tr.CurrentSpace.GetEntities<Circle>();
    var uniqueCircles = ArrayEx.Deduplication(circles.ToList(), (c1, c2) =>
        c1.Center.IsEqualTo(c2.Center, new Tolerance(0.001, 0.001)) &&
        Math.Abs(c1.Radius - c2.Radius) < 0.001);

    Console.WriteLine($"å»é‡å‰: {circles.Count()}, å»é‡å: {uniqueCircles.Count}");

    tr.Commit();
}
```

#### LoopList ç¯é“¾è¡¨ç±»

é«˜æ€§èƒ½çš„ç¯å½¢åŒå‘é“¾è¡¨å®ç°ï¼Œæ”¯æŒå¾ªç¯éå†å’Œé«˜æ•ˆçš„èŠ‚ç‚¹æ“ä½œã€‚

**æ ¸å¿ƒç±»ï¼š**
- `LoopList<T>` - ç¯é“¾è¡¨ä¸»ç±»
- `LoopListNode<T>` - ç¯é“¾è¡¨èŠ‚ç‚¹ç±»

#### LoopList<T> ä¸»è¦æ–¹æ³•

**æ„é€ å‡½æ•°ï¼š**
```csharp
// é»˜è®¤æ„é€ å‡½æ•°
public LoopList()

// ä»é›†åˆæ„é€ 
public LoopList(IEnumerable<T> values)
```
- **å‚æ•°ï¼š** `values` - èŠ‚ç‚¹è¿­ä»£å™¨
- **ç”¨é€”ï¼š** åˆ›å»ºç¯é“¾è¡¨

**èŠ‚ç‚¹ç®¡ç†ï¼š**

**SetFirst æ–¹æ³•ï¼š**
```csharp
public LoopListNode<T> SetFirst(LoopListNode<T> node)
```
- **å‚æ•°ï¼š** `node` - è¦è®¾ç½®ä¸ºé¦–èŠ‚ç‚¹çš„èŠ‚ç‚¹
- **è¿”å›å€¼ï¼š** è®¾ç½®çš„é¦–èŠ‚ç‚¹
- **ç”¨é€”ï¼š** è®¾ç½®é¦–èŠ‚ç‚¹

**Swap æ–¹æ³•ï¼š**
```csharp
public void Swap(LoopListNode<T> node1, LoopListNode<T> node2)
```
- **å‚æ•°ï¼š**
  - `node1` - ç¬¬ä¸€ä¸ªèŠ‚ç‚¹
  - `node2` - ç¬¬äºŒä¸ªèŠ‚ç‚¹
- **ç”¨é€”ï¼š** äº¤æ¢ä¸¤ä¸ªèŠ‚ç‚¹çš„å€¼

**Reverse æ–¹æ³•ï¼š**
```csharp
public void Reverse()
```
- **ç”¨é€”ï¼š** é“¾å†…ç¿»è½¬ï¼Œåè½¬æ•´ä¸ªç¯é“¾è¡¨çš„é¡ºåº

**æ·»åŠ æ“ä½œï¼š**

**AddFirst æ–¹æ³•ï¼š**
```csharp
public LoopListNode<T> AddFirst(T value)
```
- **å‚æ•°ï¼š** `value` - èŠ‚ç‚¹å€¼
- **è¿”å›å€¼ï¼š** æ–°åˆ›å»ºçš„èŠ‚ç‚¹
- **ç”¨é€”ï¼š** åœ¨é¦–èŠ‚ç‚¹ä¹‹å‰æ’å…¥èŠ‚ç‚¹ï¼Œå¹¶è®¾ç½®æ–°èŠ‚ç‚¹ä¸ºé¦–èŠ‚ç‚¹

**Add / AddLast æ–¹æ³•ï¼š**
```csharp
public LoopListNode<T> Add(T value)
public LoopListNode<T> AddLast(T value)
```
- **å‚æ•°ï¼š** `value` - èŠ‚ç‚¹å€¼
- **è¿”å›å€¼ï¼š** æ–°åˆ›å»ºçš„èŠ‚ç‚¹
- **ç”¨é€”ï¼š** åœ¨å°¾èŠ‚ç‚¹ä¹‹åæ’å…¥èŠ‚ç‚¹ï¼Œå¹¶è®¾ç½®æ–°èŠ‚ç‚¹ä¸ºå°¾èŠ‚ç‚¹

**AddRange æ–¹æ³•ï¼š**
```csharp
public void AddRange(IEnumerable<T> list)
```
- **å‚æ•°ï¼š** `list` - è¦æ·»åŠ çš„å€¼é›†åˆ
- **ç”¨é€”ï¼š** å°†å®¹å™¨å†…å®¹å…¨éƒ¨åŠ å…¥åˆ°æœ«å°¾

**AddBefore æ–¹æ³•ï¼š**
```csharp
public LoopListNode<T> AddBefore(LoopListNode<T> node, T value)
```
- **å‚æ•°ï¼š**
  - `node` - å‚è€ƒèŠ‚ç‚¹
  - `value` - æ–°èŠ‚ç‚¹å€¼
- **è¿”å›å€¼ï¼š** æ–°åˆ›å»ºçš„èŠ‚ç‚¹
- **ç”¨é€”ï¼š** åœ¨æŒ‡å®šèŠ‚ç‚¹å‰é¢å¢åŠ èŠ‚ç‚¹

**AddAfter æ–¹æ³•ï¼š**
```csharp
public LoopListNode<T> AddAfter(LoopListNode<T> node, T value)
```
- **å‚æ•°ï¼š**
  - `node` - å‚è€ƒèŠ‚ç‚¹
  - `value` - æ–°èŠ‚ç‚¹å€¼
- **è¿”å›å€¼ï¼š** æ–°åˆ›å»ºçš„èŠ‚ç‚¹
- **ç”¨é€”ï¼š** åœ¨æŒ‡å®šèŠ‚ç‚¹åé¢å¢åŠ èŠ‚ç‚¹

**åˆ é™¤æ“ä½œï¼š**

**RemoveFirst æ–¹æ³•ï¼š**
```csharp
public bool RemoveFirst()
```
- **è¿”å›å€¼ï¼š** æ˜¯å¦æˆåŠŸåˆ é™¤
- **ç”¨é€”ï¼š** åˆ é™¤é¦–èŠ‚ç‚¹

**RemoveLast æ–¹æ³•ï¼š**
```csharp
public bool RemoveLast()
```
- **è¿”å›å€¼ï¼š** æ˜¯å¦æˆåŠŸåˆ é™¤
- **ç”¨é€”ï¼š** åˆ é™¤å°¾èŠ‚ç‚¹

**Remove æ–¹æ³•é‡è½½ï¼š**
```csharp
// åˆ é™¤æŒ‡å®šèŠ‚ç‚¹
public bool Remove(LoopListNode<T> node)

// åˆ é™¤æ‰€æœ‰åŒ…å«æŒ‡å®šå€¼çš„èŠ‚ç‚¹
public bool Remove(T value)
```
- **å‚æ•°ï¼š**
  - `node` - è¦åˆ é™¤çš„èŠ‚ç‚¹
  - `value` - è¦åˆ é™¤çš„å€¼
- **è¿”å›å€¼ï¼š** æ˜¯å¦æˆåŠŸåˆ é™¤
- **ç”¨é€”ï¼š** åˆ é™¤èŠ‚ç‚¹æˆ–å€¼

**æŸ¥æ‰¾æ“ä½œï¼š**

**Contains æ–¹æ³•é‡è½½ï¼š**
```csharp
// æ£€æŸ¥æ˜¯å¦åŒ…å«èŠ‚ç‚¹
public bool Contains(LoopListNode<T> node)

// æ£€æŸ¥æ˜¯å¦åŒ…å«å€¼
public bool Contains(T value)
```
- **å‚æ•°ï¼š**
  - `node` - è¦æŸ¥æ‰¾çš„èŠ‚ç‚¹
  - `value` - è¦æŸ¥æ‰¾çš„å€¼
- **è¿”å›å€¼ï¼š** æ˜¯å¦åŒ…å«
- **ç”¨é€”ï¼š** æ£€æŸ¥ç¯é“¾è¡¨æ˜¯å¦åŒ…å«æŒ‡å®šèŠ‚ç‚¹æˆ–å€¼

**Find æ–¹æ³•ï¼š**
```csharp
public LoopListNode<T> Find(T value)
```
- **å‚æ•°ï¼š** `value` - è¦æŸ¥æ‰¾çš„å€¼
- **è¿”å›å€¼ï¼š** ç¬¬ä¸€ä¸ªåŒ¹é…çš„èŠ‚ç‚¹ï¼Œæœªæ‰¾åˆ°è¿”å›null
- **ç”¨é€”ï¼š** æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå‡ºç°çš„èŠ‚ç‚¹

**Finds æ–¹æ³•ï¼š**
```csharp
public List<LoopListNode<T>> Finds(T value)
```
- **å‚æ•°ï¼š** `value` - è¦æŸ¥æ‰¾çš„å€¼
- **è¿”å›å€¼ï¼š** æ‰€æœ‰åŒ¹é…çš„èŠ‚ç‚¹åˆ—è¡¨
- **ç”¨é€”ï¼š** æŸ¥æ‰¾æ‰€æœ‰å‡ºç°çš„èŠ‚ç‚¹

**GetNode æ–¹æ³•ï¼š**
```csharp
public LoopListNode<T> GetNode(Func<T, bool> func)
```
- **å‚æ•°ï¼š** `func` - æŸ¥æ‰¾æ¡ä»¶å‡½æ•°
- **è¿”å›å€¼ï¼š** ç¬¬ä¸€ä¸ªåŒ¹é…æ¡ä»¶çš„èŠ‚ç‚¹
- **ç”¨é€”ï¼š** æŒ‰æ¡ä»¶è·å–èŠ‚ç‚¹

**éå†æ“ä½œï¼š**

**ForEach æ–¹æ³•ï¼š**
```csharp
public void ForEach(Func<LoopListNode<T>, bool> action)
```
- **å‚æ•°ï¼š** `action` - å¯¹æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œçš„æ“ä½œï¼Œè¿”å›falseåœæ­¢éå†
- **ç”¨é€”ï¼š** ä»å¤´éå†æ‰€æœ‰èŠ‚ç‚¹

**For æ–¹æ³•ï¼š**
```csharp
public void For(Func<int, LoopListNode<T>, bool> action)
```
- **å‚æ•°ï¼š** `action` - å¯¹æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œçš„æ“ä½œï¼ŒåŒ…å«ç´¢å¼•å‚æ•°
- **ç”¨é€”ï¼š** ä»å¤´éå†æ‰€æœ‰èŠ‚ç‚¹ï¼ˆå¸¦è®¡æ•°ï¼‰

**é«˜çº§æ“ä½œï¼š**

**LinkTo æ–¹æ³•é‡è½½ï¼š**
```csharp
// åŸºæœ¬é“¾æ¥
public void LinkTo(LoopListNode<T> from, LoopListNode<T> to)

// å¸¦è®¡æ•°çš„é“¾æ¥
public void LinkTo(LoopListNode<T> from, LoopListNode<T> to, int count)

// å®Œæ•´å‚æ•°çš„é“¾æ¥
public void LinkTo(LoopListNode<T> from, LoopListNode<T> to, int count, bool forward)
```
- **å‚æ•°ï¼š**
  - `from` - èµ·å§‹èŠ‚ç‚¹
  - `to` - ç›®æ ‡èŠ‚ç‚¹
  - `count` - è®¡æ•°
  - `forward` - æ–¹å‘
- **ç”¨é€”ï¼š** é“¾æ¥ä¸¤èŠ‚ç‚¹ï¼Œå¹¶å»é™¤è¿™ä¸¤ä¸ªèŠ‚ç‚¹é—´çš„æ‰€æœ‰èŠ‚ç‚¹

**GetNodes æ–¹æ³•é‡è½½ï¼š**
```csharp
// ä»æŒ‡å®šèŠ‚ç‚¹å¼€å§‹è·å–èŠ‚ç‚¹æŸ¥è¯¢å™¨
public IEnumerable<LoopListNode<T>> GetNodes(LoopListNode<T> from)

// ä»é¦–èŠ‚ç‚¹å¼€å§‹è·å–èŠ‚ç‚¹æŸ¥è¯¢å™¨
public IEnumerable<LoopListNode<T>> GetNodes()
```
- **å‚æ•°ï¼š** `from` - èµ·å§‹èŠ‚ç‚¹
- **è¿”å›å€¼ï¼š** èŠ‚ç‚¹æŸ¥è¯¢å™¨
- **ç”¨é€”ï¼š** è·å–èŠ‚ç‚¹çš„æŸ¥è¯¢å™¨

#### LoopListNode<T> èŠ‚ç‚¹ç±»æ–¹æ³•

**æ„é€ å‡½æ•°ï¼š**
```csharp
public LoopListNode(T value, LoopList<T> ts)
```
- **å‚æ•°ï¼š**
  - `value` - èŠ‚ç‚¹å€¼
  - `ts` - æ‰€å±ç¯é“¾è¡¨
- **ç”¨é€”ï¼š** åˆ›å»ºç¯é“¾è¡¨èŠ‚ç‚¹

**GetNext æ–¹æ³•ï¼š**
```csharp
public LoopListNode<T> GetNext(bool forward)
```
- **å‚æ•°ï¼š** `forward` - æœç´¢æ–¹å‘æ ‡å¿—ï¼Œtrueä¸ºå‘å‰æœç´¢ï¼Œfalseä¸ºå‘åæœç´¢
- **è¿”å›å€¼ï¼š** ä¸´è¿‘èŠ‚ç‚¹
- **ç”¨é€”ï¼š** è·å–å½“å‰èŠ‚ç‚¹çš„ä¸´è¿‘èŠ‚ç‚¹

**Invalidate æ–¹æ³•ï¼š**
```csharp
public void Invalidate()
```
- **ç”¨é€”ï¼š** æ— æ•ˆåŒ–èŠ‚ç‚¹æˆå‘˜

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

**åŸºæœ¬æ“ä½œç¤ºä¾‹ï¼š**
```csharp
// åˆ›å»ºç¯é“¾è¡¨
var loopList = new LoopList<int>();

// æ·»åŠ å…ƒç´ 
var node1 = loopList.Add(1);
var node2 = loopList.Add(2);
var node3 = loopList.Add(3);

Console.WriteLine($"ç¯é“¾è¡¨å¤§å°: {loopList.Count}");

// åœ¨æŒ‡å®šä½ç½®æ’å…¥
var newNode = loopList.AddAfter(node2, 25);

// éå†ç¯é“¾è¡¨
loopList.ForEach(node =>
{
    Console.WriteLine($"èŠ‚ç‚¹å€¼: {node.Value}");
    return true; // ç»§ç»­éå†
});
```

**æŸ¥æ‰¾å’Œåˆ é™¤ç¤ºä¾‹ï¼š**
```csharp
var loopList = new LoopList<string>(new[] { "A", "B", "C", "B", "D" });

// æŸ¥æ‰¾ç¬¬ä¸€ä¸ª"B"
var firstB = loopList.Find("B");
Console.WriteLine($"æ‰¾åˆ°ç¬¬ä¸€ä¸ªBçš„ä½ç½®: {firstB?.Value}");

// æŸ¥æ‰¾æ‰€æœ‰"B"
var allBs = loopList.Finds("B");
Console.WriteLine($"æ‰¾åˆ° {allBs.Count} ä¸ªB");

// æŒ‰æ¡ä»¶æŸ¥æ‰¾
var longString = loopList.GetNode(s => s.Length > 1);

// åˆ é™¤æ‰€æœ‰"B"
loopList.Remove("B");
Console.WriteLine($"åˆ é™¤åå¤§å°: {loopList.Count}");
```

**é«˜çº§æ“ä½œç¤ºä¾‹ï¼š**
```csharp
var loopList = new LoopList<Point3d>();

// æ·»åŠ ç‚¹
var points = new[]
{
    new Point3d(0, 0, 0),
    new Point3d(10, 0, 0),
    new Point3d(10, 10, 0),
    new Point3d(0, 10, 0)
};
loopList.AddRange(points);

// åè½¬ç¯é“¾è¡¨
loopList.Reverse();

// äº¤æ¢ä¸¤ä¸ªèŠ‚ç‚¹çš„å€¼
var first = loopList.First;
var last = loopList.Last;
loopList.Swap(first, last);

// è·å–èŠ‚ç‚¹å¹¶éå†
foreach (var node in loopList.GetNodes())
{
    var next = node.GetNext(true); // è·å–ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
    var prev = node.GetNext(false); // è·å–ä¸Šä¸€ä¸ªèŠ‚ç‚¹

    Console.WriteLine($"å½“å‰: {node.Value}");
    Console.WriteLine($"ä¸‹ä¸€ä¸ª: {next.Value}");
    Console.WriteLine($"ä¸Šä¸€ä¸ª: {prev.Value}");
}
```

**å®é™…åº”ç”¨ç¤ºä¾‹ï¼š**
```csharp
// CADä¸­çš„å¤šæ®µçº¿é¡¶ç‚¹å¤„ç†
public void ProcessPolylineVertices(Polyline polyline)
{
    var vertices = new LoopList<Point2d>();

    // æ·»åŠ æ‰€æœ‰é¡¶ç‚¹
    for (int i = 0; i < polyline.NumberOfVertices; i++)
    {
        vertices.Add(polyline.GetPoint2dAt(i));
    }

    // å¦‚æœæ˜¯é—­åˆå¤šæ®µçº¿ï¼Œå¯ä»¥å¾ªç¯å¤„ç†
    if (polyline.Closed)
    {
        vertices.ForEach(node =>
        {
            var current = node.Value;
            var next = node.GetNext(true).Value;

            // è®¡ç®—è¾¹é•¿
            var length = current.GetDistanceTo(next);
            Console.WriteLine($"è¾¹é•¿: {length}");

            return true; // ç»§ç»­éå†
        });
    }

    // ç®€åŒ–é¡¶ç‚¹ï¼ˆç§»é™¤å…±çº¿ç‚¹ï¼‰
    vertices.ForEach(node =>
    {
        var prev = node.GetNext(false).Value;
        var current = node.Value;
        var next = node.GetNext(true).Value;

        // æ£€æŸ¥æ˜¯å¦å…±çº¿
        var vec1 = current - prev;
        var vec2 = next - current;

        if (Math.Abs(vec1.GetAngleTo(vec2)) < 0.01) // è§’åº¦å°äº0.01å¼§åº¦
        {
            vertices.Remove(node);
        }

        return true;
    });

    Console.WriteLine($"ç®€åŒ–åé¡¶ç‚¹æ•°: {vertices.Count}");
}
```

#### LinqEx LINQæ‰©å±•
```csharp
public static class LinqEx
```

**æŸ¥æ‰¾æ–¹æ³•ï¼š**
- `FindByMax<T, TKey>(IEnumerable<T> source, Func<T, TKey> selector)`: æŸ¥æ‰¾æœ€å¤§å€¼å¯¹åº”çš„å…ƒç´ 
- `FindByMin<T, TKey>(IEnumerable<T> source, Func<T, TKey> selector)`: æŸ¥æ‰¾æœ€å°å€¼å¯¹åº”çš„å…ƒç´ 
- `MaxBy<T, TKey>(IEnumerable<T> source, Func<T, TKey> selector)`: è·å–æœ€å¤§é”®å€¼
- `MinBy<T, TKey>(IEnumerable<T> source, Func<T, TKey> selector)`: è·å–æœ€å°é”®å€¼

**è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼š**
- `SpecComparer<T>`: è‡ªå®šä¹‰çš„æ¯”è¾ƒæ³›å‹ç±»

#### LoopList<T> ç¯é“¾è¡¨
```csharp
public class LoopList<T> : IEnumerable<T>
```

**ä¸»è¦å±æ€§ï¼š**
- `Count`: èŠ‚ç‚¹æ•°é‡
- `Current`: å½“å‰èŠ‚ç‚¹
- `IsEmpty`: æ˜¯å¦ä¸ºç©º

**ä¸»è¦æ–¹æ³•ï¼š**
- `Add(T item)`: æ·»åŠ èŠ‚ç‚¹
- `Remove(T item)`: åˆ é™¤èŠ‚ç‚¹
- `MoveNext()`: ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
- `MovePrevious()`: ç§»åŠ¨åˆ°ä¸Šä¸€ä¸ªèŠ‚ç‚¹
- `Clear()`: æ¸…ç©ºé“¾è¡¨

#### SystemEx ç³»ç»Ÿæ‰©å±•
```csharp
public static class SystemEx
```

**è¿›ç¨‹æ“ä½œï¼š**
- `CloseProc(string processName)`: å…³é—­æŒ‡å®šè¿›ç¨‹

#### RandomEx éšæœºæ‰©å±•
```csharp
public static class RandomEx
```

**éšæœºæ–¹æ³•ï¼š**
- `NextDouble(Random random, double min, double max)`: ç”ŸæˆæŒ‡å®šèŒƒå›´çš„éšæœºåŒç²¾åº¦æ•°
- `NextBool(Random random)`: ç”Ÿæˆéšæœºå¸ƒå°”å€¼
- `NextColor(Random random)`: ç”Ÿæˆéšæœºé¢œè‰²

#### WindowsAPI ç³»ç»ŸAPI
```csharp
public static class WindowsAPI
```

**APIæ–¹æ³•ï¼š**
- `GetProcAddress(IntPtr hModule, string procName)`: è·å–è¿‡ç¨‹åœ°å€
- `LoadLibrary(string lpFileName)`: åŠ è½½åº“
- `FreeLibrary(IntPtr hModule)`: é‡Šæ”¾åº“
- `GetModuleHandle(string lpModuleName)`: è·å–æ¨¡å—å¥æŸ„

**é”®ç›˜é’©å­ï¼š**
- `KeyboardHookStruct`: Hooké”®ç›˜æ•°æ®ç»“æ„
- `CheckLowLevelHooksTimeout(int timeout)`: æ£€æŸ¥ä½çº§é’©å­è¶…æ—¶

#### PInvokeUser32 User32å°è£…
```csharp
public static class PInvokeUser32
```

**çª—å£æ“ä½œï¼š**
- `FindWindow(string lpClassName, string lpWindowName)`: æŸ¥æ‰¾çª—å£
- `SetWindowPos(IntPtr hWnd, IntPtr hWndInsertAfter, int x, int y, int cx, int cy, uint uFlags)`: è®¾ç½®çª—å£ä½ç½®
- `ShowWindow(IntPtr hWnd, int nCmdShow)`: æ˜¾ç¤ºçª—å£
- `GetWindowText(IntPtr hWnd, StringBuilder lpString, int nMaxCount)`: è·å–çª—å£æ–‡æœ¬

**çº¿ç¨‹ä¿¡æ¯ï¼š**
- `GuiThreadInfo`: è·å–çº¿ç¨‹å¯¹åº”çš„çª—ä½“ä¿¡æ¯ç»“æ„

#### DebugEx è°ƒè¯•å·¥å…·
```csharp
public static class DebugEx
```

**è°ƒè¯•æ–¹æ³•ï¼š**
- `Printl(object obj, bool time = false)`: æ‰“å°è°ƒè¯•ä¿¡æ¯

#### EnumEx æšä¸¾æ‰©å±•
```csharp
public static class EnumEx
```

**æšä¸¾æ“ä½œï¼š**
- `CleanCache()`: æ¸…ç†æšä¸¾ç¼“å­˜
- `GetValues<T>()`: è·å–æšä¸¾å€¼
- `GetNames<T>()`: è·å–æšä¸¾åç§°

#### ArgumentNullEx å‚æ•°æ£€æŸ¥
```csharp
public static class ArgumentNullEx
```

**å‚æ•°éªŒè¯ï¼š**
- `ThrowIfNull(object argument, string parameterName)`: å‚æ•°ä¸ºç©ºæ—¶æŠ›å‡ºå¼‚å¸¸
- `ThrowIfNullOrEmpty(string argument, string parameterName)`: å­—ç¬¦ä¸²ä¸ºç©ºæˆ–nullæ—¶æŠ›å‡ºå¼‚å¸¸

## å®ç”¨ç¤ºä¾‹

### æ‰©å±•æ•°æ®ç®¡ç†
```csharp
// æ·»åŠ æ‰©å±•æ•°æ®åˆ°å®ä½“
var xdataList = new XRecordDataList
{
    { DxfCode.ExtendedDataApplicationName, "MyApp" },
    { DxfCode.ExtendedDataAsciiString, "CustomData" },
    { DxfCode.ExtendedDataReal, 123.45 }
};

entity.XData = xdataList.ToResultBuffer();

// æ£€ç´¢å’Œä¿®æ”¹æ‰©å±•æ•°æ®
var appName = "MyApp";
entity.ChangeXData(appName, DxfCode.ExtendedDataReal, 678.90);

// åˆ é™¤æ‰©å±•æ•°æ®
entity.RemoveXData(appName);
```

### ç¼–ç»„ç®¡ç†
```csharp
// åˆ›å»ºå’Œç®¡ç†å®ä½“ç»„
var groupDict = tr.GetObject(db.GroupDictionaryId, OpenMode.ForWrite) as DBDictionary;
var entityIds = selectedEntities.GetObjectIds().ToCollection();

// åˆ›å»ºç»„
var groupId = groupDict.AddGroup("MyGroup", entityIds);

// æŸ¥æ‰¾åŒ…å«ç‰¹å®šå®ä½“çš„ç»„
var groups = entity.GetGroups();

// åˆ é™¤ç©ºç»„
var removedGroups = groupDict.RemoveNullGroup();
```

### å®‰å…¨å±æ€§ä¿®æ”¹
```csharp
// å®‰å…¨ä¿®æ”¹å®ä½“å±æ€§
entity.ForWrite(ent =>
{
    ent.Color = Color.FromColorIndex(ColorMethod.ByAci, 1); // çº¢è‰²
    ent.Layer = "NewLayer";
});

// æˆ–ä½¿ç”¨å‡çº§ç®¡ç†å™¨
using (var upgrader = entity.ForWrite())
{
    entity.Color = Color.FromColorIndex(ColorMethod.ByAci, 2); // é»„è‰²
    entity.Linetype = "DASHED";
}
```

## é”™è¯¯å¤„ç†

### CAD é”™è¯¯ä¿¡æ¯å¤„ç† (ErrorInfoEx)

ä¸“é—¨ç”¨äºå¤„ç†å’Œæ˜¾ç¤ºAutoCADç›¸å…³é”™è¯¯ä¿¡æ¯çš„å·¥å…·ç±»ã€‚

**æ ¸å¿ƒç±»ï¼š**
- `ErrorInfoEx` - CADé”™è¯¯ä¿¡æ¯å¤„ç†ç±»
- `GetPeMethodException` - PEæ–¹æ³•ä¸“ç”¨å¼‚å¸¸ç±»

#### ErrorInfoEx ç±»

**ä¸»è¦æ–¹æ³•ï¼š**

**AcErrorInfo æ–¹æ³•ï¼š**
```csharp
public static void AcErrorInfo(AcException acex)
```
- **å‚æ•°ï¼š** `acex` - AutoCADå¼‚å¸¸å¯¹è±¡
- **åŠŸèƒ½ï¼š** å°†CADé”™è¯¯ä¿¡æ¯æ ¼å¼åŒ–è¾“å‡ºåˆ°å‘½ä»¤è¡Œ
- **ç”¨é€”ï¼š** ç»Ÿä¸€çš„é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºå’Œè°ƒè¯•

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
try
{
    // AutoCAD æ“ä½œä»£ç 
    using (var tr = new DBTrans())
    {
        // å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„æ“ä½œ
        var entity = tr.GetObject<Entity>(objectId);
        tr.Commit();
    }
}
catch (AcException acex)
{
    // ä½¿ç”¨IFoxCADçš„é”™è¯¯å¤„ç†
    ErrorInfoEx.AcErrorInfo(acex);
}
catch (Exception ex)
{
    // å¤„ç†å…¶ä»–ç±»å‹å¼‚å¸¸
    Console.WriteLine($"ä¸€èˆ¬é”™è¯¯: {ex.Message}");
}
```

#### GetPeMethodException ç±»

ä¸“é—¨ç”¨äºPEï¼ˆProtocol Extensionï¼‰æ–¹æ³•è°ƒç”¨æ—¶çš„å¼‚å¸¸å¤„ç†ã€‚

**ä¸»è¦å±æ€§ï¼š**
- `ErrorNum` - é”™è¯¯ç¼–å·
- `ErrorMsg` - é”™è¯¯æ¶ˆæ¯
- `InnerException1` - å†…éƒ¨å¼‚å¸¸

**æ„é€ å‡½æ•°ï¼š**
```csharp
// åŸºæœ¬æ„é€ å‡½æ•°
public GetPeMethodException(string msg)

// å¸¦é”™è¯¯ç¼–å·çš„æ„é€ å‡½æ•°
public GetPeMethodException(int errorNum, string msg)

// å¸¦å†…éƒ¨å¼‚å¸¸çš„æ„é€ å‡½æ•°
public GetPeMethodException(string msg, Exception innerException)
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// PEæ–¹æ³•è°ƒç”¨å¼‚å¸¸å¤„ç†
public void CallPeMethod()
{
    try
    {
        // PEæ–¹æ³•è°ƒç”¨
        var result = SomePeMethod();
        if (result != ErrorStatus.OK)
        {
            throw new GetPeMethodException((int)result, "PEæ–¹æ³•è°ƒç”¨å¤±è´¥");
        }
    }
    catch (GetPeMethodException peEx)
    {
        Console.WriteLine($"PEé”™è¯¯ [{peEx.ErrorNum}]: {peEx.ErrorMsg}");
        if (peEx.InnerException1 != null)
        {
            Console.WriteLine($"å†…éƒ¨å¼‚å¸¸: {peEx.InnerException1.Message}");
        }
    }
}
```

### ç»Ÿä¸€é”™è¯¯å¤„ç†æ¨¡å¼

**æ¨èçš„é”™è¯¯å¤„ç†æ¨¡å¼ï¼š**
```csharp
public class CadOperationHelper
{
    public static void SafeExecute(Action operation, string operationName = "CADæ“ä½œ")
    {
        try
        {
            operation();
        }
        catch (AcException acex)
        {
            ErrorInfoEx.AcErrorInfo(acex);
            throw new InvalidOperationException($"{operationName}å¤±è´¥: {acex.Message}", acex);
        }
        catch (GetPeMethodException peEx)
        {
            Console.WriteLine($"PEæ–¹æ³•é”™è¯¯ [{peEx.ErrorNum}]: {peEx.ErrorMsg}");
            throw;
        }
        catch (Exception ex)
        {
            Console.WriteLine($"{operationName}å‘ç”ŸæœªçŸ¥é”™è¯¯: {ex.Message}");
            throw;
        }
    }
}

// ä½¿ç”¨ç¤ºä¾‹
CadOperationHelper.SafeExecute(() =>
{
    using (var tr = new DBTrans())
    {
        // æ‰§è¡ŒCADæ“ä½œ
        tr.Commit();
    }
}, "æ•°æ®åº“äº‹åŠ¡æ“ä½œ");
```

### äº‹åŠ¡ç®¡ç†æœ€ä½³å®è·µ

```csharp
// å§‹ç»ˆä¸ºæ•°æ®åº“æ“ä½œä½¿ç”¨äº‹åŠ¡
using (var tr = db.TransactionManager.StartTransaction())
{
    try
    {
        // æ‰§è¡Œæ“ä½œ
        var entity = tr.GetObject(objectId, OpenMode.ForWrite) as Entity;
        // ä¿®æ”¹å®ä½“...

        tr.Commit(); // åªæœ‰åœ¨æ‰€æœ‰æ“ä½œæˆåŠŸæ—¶æ‰æäº¤
    }
    catch (Exception ex)
    {
        // äº‹åŠ¡åœ¨å¼‚å¸¸æ—¶è‡ªåŠ¨ä¸­æ­¢
        // è®°å½•é”™è¯¯æˆ–æ ¹æ®éœ€è¦å¤„ç†
        throw; // å¦‚æœéœ€è¦ï¼Œé‡æ–°æŠ›å‡º
    }
}
```

## é«˜çº§ä½¿ç”¨æ¨¡å¼

### ç©ºé—´æŸ¥è¯¢ä¼˜åŒ–
```csharp
// ä¸ºå¤§å‹å®ä½“é›†åˆ›å»ºå››å‰æ ‘
var bounds = new Rect(drawingExtents);
var spatialIndex = new QuadTree<QuadEntity>(bounds);

// æ‰¹é‡æ’å…¥å®ä½“
entities.ForEach(ent => spatialIndex.Insert(new QuadEntity(ent.GeometricExtents)));

// å¿«é€Ÿç©ºé—´æŸ¥è¯¢
var nearbyEntities = spatialIndex.Query(selectionRect, QuadTreeSelectMode.IntersectsWith);
```

### é«˜æ•ˆé›†åˆå¤„ç†
```csharp
// è½¬æ¢ AutoCAD é›†åˆä»¥è¿›è¡Œ LINQ æ“ä½œ
var entityIds = selection.GetObjectIds().ToList();
var entities = entityIds.Select(id => tr.GetObject(id, OpenMode.ForRead)).Cast<Entity>();

// ä½¿ç”¨åŸºäºå®¹å·®çš„å»é‡å¤„ç†
var uniquePoints = points.Distinct(new TolerancePoint2d(0.001)).ToList();
```

### å®‰å…¨æ•°æ®åº“æ“ä½œ
```csharp
// è‡ªåŠ¨æ•°æ®åº“åˆ‡æ¢å’Œæ¢å¤
using (var dbSwitch = targetDatabase.SwitchDatabase())
using (var tr = targetDatabase.TransactionManager.StartTransaction())
{
    // åœ¨ç›®æ ‡æ•°æ®åº“ä¸Šæ‰§è¡Œæ“ä½œ
    tr.Commit();
} // æ•°æ®åº“è‡ªåŠ¨æ¢å¤
```

## æ‰©å±•å’Œå®šåˆ¶

### è‡ªå®šä¹‰è¿‡æ»¤å™¨

```csharp
public class CustomFilter : OpFilter
{
    public override string Name => "CUSTOM";

    public override IEnumerable<TypedValue> ToTypedValues()
    {
        // å®ç°è‡ªå®šä¹‰è¿‡æ»¤é€»è¾‘
    }
}
```

### è‡ªå®šä¹‰å®ä½“æ‰©å±•

```csharp
public static class MyEntityEx
{
    public static void MyCustomMethod(this Entity entity)
    {
        // è‡ªå®šä¹‰æ‰©å±•æ–¹æ³•
    }
}
```

## å¸¸è§å¼€å‘æ¨¡å¼

### 1. å®ä½“åˆ›å»ºå’Œç®¡ç†
```csharp
// åˆ›å»ºå®ä½“å¹¶æ·»åŠ åˆ°æ¨¡å‹ç©ºé—´
using (var tr = db.TransactionManager.StartTransaction())
{
    var modelSpace = tr.GetObject(db.CurrentSpaceId, OpenMode.ForWrite) as BlockTableRecord;

    // åˆ›å»ºå®ä½“ï¼ˆç¤ºä¾‹ï¼šç›´çº¿ï¼‰
    var line = new Line(startPoint, endPoint);

    // æ·»åŠ åˆ°æ¨¡å‹ç©ºé—´
    modelSpace.AppendEntity(line);
    tr.AddNewlyCreatedDBObject(line, true);

    tr.Commit();
}
```

### 2. ä½¿ç”¨å››å‰æ ‘æ‰¹é‡å¤„ç†å®ä½“
```csharp
// é«˜æ•ˆå¤„ç†å¤§é‡å®ä½“
var allEntities = GetAllEntities(); // æ‚¨è·å–å®ä½“çš„æ–¹æ³•
var bounds = Rect.GetMinMax(allEntities.Select(e => e.GeometricExtents));
var quadTree = new QuadTree<EntityWrapper>(bounds);

// ç´¢å¼•æ‰€æœ‰å®ä½“
allEntities.ForEach(entity =>
{
    var wrapper = new EntityWrapper(entity);
    quadTree.Insert(wrapper);
});

// æŸ¥æ‰¾ç‰¹å®šåŒºåŸŸå†…çš„å®ä½“
var queryRect = new Rect(x1, y1, x2, y2);
var entitiesInRegion = quadTree.Query(queryRect, QuadTreeSelectMode.IntersectsWith);
```

### 3. ä¸ AutoCAD å‘½ä»¤é›†æˆ
```csharp
[CommandMethod("MYCOMMAND")]
public void MyCommand()
{
    var doc = Application.DocumentManager.MdiActiveDocument;
    var db = doc.Database;
    var ed = doc.Editor;

    using (var lockDoc = doc.SecurelyLock())
    using (var tr = db.TransactionManager.StartTransaction())
    {
        // ä½¿ç”¨ IFoxCAD æ‰©å±•
        var selection = ed.SelectAll();
        var entities = selection.Value.GetObjectIds()
            .Select(id => tr.GetObject(id, OpenMode.ForRead))
            .Cast<Entity>()
            .ToList();

        // ä½¿ç”¨å››å‰æ ‘å¤„ç†
        var bounds = Rect.GetMinMax(entities.Select(e => e.GeometricExtents));
        var quadTree = new QuadTree<QuadEntity>(bounds);

        tr.Commit();
    }
}
```

### 4. è‡ªå®šä¹‰å®ä½“ç±»
```csharp
public class MyQuadEntity : QuadEntity
{
    public Entity SourceEntity { get; }
    public string CustomProperty { get; set; }

    public MyQuadEntity(Entity entity) : base(entity.GeometricExtents)
    {
        SourceEntity = entity;
        CustomProperty = entity.Layer;
    }
}

// ä½¿ç”¨æ–¹æ³•
var customQuadTree = new QuadTree<MyQuadEntity>(bounds);
entities.ForEach(e => customQuadTree.Insert(new MyQuadEntity(e)));
```

### 5. å¡«å……æ“ä½œç¤ºä¾‹
```csharp
// åˆ›å»ºå®ä½“å¡«å……
var hatchInfo = new HatchInfo
{
    PatternName = "ANSI31",
    PatternScale = 1.0,
    PatternAngle = 0.0,
    BoundaryIds = boundaryIds
};

using var tr = new DBTrans();
var hatch = hatchInfo.CreateHatch();
tr.CurrentSpace.AddEntity(hatch);

// åˆ›å»ºæ¸å˜å¡«å……
var gradientInfo = new HatchInfo
{
    IsGradient = true,
    GradientName = GradientName.Linear,
    GradientColors = new[] { Color.Red, Color.Blue },
    BoundaryIds = boundaryIds
};

var gradientHatch = gradientInfo.CreateHatch();
tr.CurrentSpace.AddEntity(gradientHatch);
tr.Commit();
```

### 6. Jig äº¤äº’ç»˜å›¾
```csharp
public class LineJig : JigEx
{
    private Line _line;
    private Point3d _startPoint;

    public LineJig(Point3d startPoint)
    {
        _startPoint = startPoint;
        _line = new Line(startPoint, startPoint);
    }

    protected override SamplerStatus Sampler(JigPrompts prompts)
    {
        var options = new JigPromptPointOptions("\næŒ‡å®šç»ˆç‚¹: ");
        var result = prompts.AcquirePoint(options);

        if (result.Status == PromptStatus.OK)
        {
            _line.EndPoint = result.Value;
            return SamplerStatus.OK;
        }

        return SamplerStatus.Cancel;
    }

    protected override bool Update()
    {
        return true;
    }

    public Entity GetEntity() => _line;
}

// ä½¿ç”¨Jig
[CommandMethod("LINEJIG")]
public void LineJigCommand()
{
    var ed = Application.DocumentManager.MdiActiveDocument.Editor;

    var startResult = ed.GetPoint("\næŒ‡å®šèµ·ç‚¹: ");
    if (startResult.Status != PromptStatus.OK) return;

    var jig = new LineJig(startResult.Value);
    var jigResult = ed.Drag(jig);

    if (jigResult.Status == PromptStatus.OK)
    {
        using var tr = new DBTrans();
        tr.CurrentSpace.AddEntity(jig.GetEntity());
        tr.Commit();
    }
}
```

### 7. ç³»ç»Ÿå˜é‡ç®¡ç†
```csharp
// ä½¿ç”¨ç³»ç»Ÿå˜é‡ç®¡ç†å™¨
var sysVar = new SystemVariableManager();

// ä¸´æ—¶å…³é—­å‘½ä»¤å›æ˜¾
var oldCmdecho = sysVar.Cmdecho;
sysVar.Cmdecho = false;

try
{
    // æ‰§è¡Œéœ€è¦é™é»˜çš„æ“ä½œ
    ed.Command("LINE", "0,0", "100,100", "");
}
finally
{
    // æ¢å¤åŸå§‹è®¾ç½®
    sysVar.Cmdecho = oldCmdecho;
}
```

### 8. ç¯é“¾è¡¨ä½¿ç”¨
```csharp
// åˆ›å»ºç¯é“¾è¡¨ç®¡ç†é¡¶ç‚¹
var loopList = new LoopList<Point3d>();
loopList.Add(new Point3d(0, 0, 0));
loopList.Add(new Point3d(100, 0, 0));
loopList.Add(new Point3d(100, 100, 0));
loopList.Add(new Point3d(0, 100, 0));

// éå†ç¯é“¾è¡¨
for (int i = 0; i < loopList.Count * 2; i++) // éå†ä¸¤åœˆ
{
    var current = loopList.Current.Value;
    Console.WriteLine($"å½“å‰ç‚¹: {current}");
    loopList.MoveNext();
}
```

## èµ„æºç®¡ç†å’Œæœ€ä½³å®è·µ

### 1. èµ„æºç®¡ç†
```csharp
// æ­£ç¡®é‡Šæ”¾ AutoCAD é›†åˆ
var point2dCollection = points.ToCollection();
try
{
    // ä½¿ç”¨é›†åˆ
    polyline.SetPointAt(0, point2dCollection[0]);
}
finally
{
    point2dCollection?.Dispose(); // å§‹ç»ˆé‡Šæ”¾é›†åˆ
}

// æˆ–åœ¨å¯èƒ½æ—¶ä½¿ç”¨ using è¯­å¥
using (var collection = points.ToCollection())
{
    // å®‰å…¨ä½¿ç”¨é›†åˆ
}
```

### 2. å®¹å·®å¤„ç†
```csharp
// å¯¹å‡ ä½•æ“ä½œä½¿ç”¨é€‚å½“çš„å®¹å·®
var tolerance = Tolerance.Global.EqualPoint;
var comparer = new TolerancePoint2d(tolerance);

// åˆ é™¤é‡å¤ç‚¹
var uniquePoints = allPoints.Distinct(comparer).ToList();

// å¸¦å®¹å·®çš„çŸ©å½¢æ“ä½œ
var rect1 = new Rect(0, 0, 10, 10);
var rect2 = new Rect(0.0001, 0.0001, 10.0001, 10.0001);
bool areEqual = rect1.Equals(rect2, tolerance);
```

### 3. æ€§èƒ½ä¼˜åŒ–
```csharp
// å¯¹å¤§å‹æ•°æ®é›†çš„ç©ºé—´æ“ä½œä½¿ç”¨å››å‰æ ‘
if (entityCount > 1000) // ç©ºé—´ç´¢å¼•çš„é˜ˆå€¼
{
    var quadTree = new QuadTree<QuadEntity>(bounds);
    entities.ForEach(e => quadTree.Insert(new QuadEntity(e.GeometricExtents)));

    // å¿«é€Ÿç©ºé—´æŸ¥è¯¢
    var results = quadTree.Query(searchRect, QuadTreeSelectMode.IntersectsWith);
}
else
{
    // å¯¹å°æ•°æ®é›†ä½¿ç”¨çº¿æ€§æœç´¢
    var results = entities.Where(e => e.GeometricExtents.IntersectsWith(searchRect));
}
```

## å¸¸è§é—®é¢˜æ’æŸ¥

### 1. å››å‰æ ‘æ€§èƒ½é—®é¢˜
**é—®é¢˜**: å››å‰æ ‘æ“ä½œç¼“æ…¢
**è§£å†³æ–¹æ¡ˆ**:
- è°ƒæ•´ `QuadTreeEvn.QuadTreeMaximumDepth`ï¼ˆé»˜è®¤å€¼å¯¹å¤§å¤šæ•°æƒ…å†µåˆç†ï¼‰
- ä¿®æ”¹ `QuadTreeEvn.QuadTreeContentsCountSplit` é˜ˆå€¼
- ç¡®ä¿ `QuadTreeEvn.MinArea` é€‚åˆæ‚¨çš„æ•°æ®è§„æ¨¡

### 2. å†…å­˜æ³„æ¼
**é—®é¢˜**: å†…å­˜ä½¿ç”¨é‡éšæ—¶é—´å¢åŠ 
**è§£å†³æ–¹æ¡ˆ**:
- å§‹ç»ˆé‡Šæ”¾ AutoCAD é›†åˆï¼ˆ`Point2dCollection`ã€`ObjectIdCollection` ç­‰ï¼‰
- å¯¹ `DBTrans` å’Œå…¶ä»–å¯é‡Šæ”¾å¯¹è±¡ä½¿ç”¨ `using` è¯­å¥
- æ­£ç¡®ç®¡ç†å››å‰æ ‘ä¸­çš„å®ä½“å¼•ç”¨

### 3. äº‹åŠ¡å†²çª
**é—®é¢˜**: "å¯¹è±¡å·²ä¸ºå†™å…¥æ‰“å¼€"é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨ `ForWrite()` æ‰©å±•æ–¹æ³•è¿›è¡Œè‡ªåŠ¨å‡çº§ç®¡ç†
- åœ¨æ“ä½œå‰æ£€æŸ¥å®ä½“æ‰“å¼€æ¨¡å¼
- é¿å…å¯¹åŒä¸€å®ä½“è¿›è¡ŒåµŒå¥—å†™æ“ä½œ

### 4. åæ ‡ç³»é—®é¢˜
**é—®é¢˜**: å‡ ä½•è®¡ç®—äº§ç”Ÿæ„å¤–ç»“æœ
**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿åæ ‡ç³»ä¸€è‡´ï¼ˆWCS vs UCSï¼‰
- å¯¹æ¯”è¾ƒä½¿ç”¨é€‚å½“çš„å®¹å·®å€¼
- éªŒè¯çŸ©å½¢è¾¹ç•Œæ­£ç¡®æ’åºï¼ˆmin < maxï¼‰

## ç‰ˆæœ¬å…¼å®¹æ€§è¯´æ˜

### .NET Framework vs .NET 8.0
- **.NET Framework 4.8**: éœ€è¦ `IndexRange` åŒ…è¿›è¡ŒèŒƒå›´æ“ä½œ
- **.NET 8.0**: åŸç”ŸèŒƒå›´æ”¯æŒï¼Œæ€§èƒ½æ›´å¥½
- **AutoCAD ç‰ˆæœ¬**: éœ€è¦ä¸åŒçš„ AutoCAD.NET åŒ…ç‰ˆæœ¬

### ä» NFox è¿ç§»
å¦‚æœä»åŸå§‹ NFox åº“è¿ç§»ï¼š
1. å°†å‘½åç©ºé—´å¼•ç”¨ä» `NFox` æ›´æ–°ä¸º `IFoxCAD.Cad`
2. æ£€æŸ¥æ–¹æ³•ç­¾å - ä¸€äº›å·²è¢«ç®€åŒ–
3. æ›´æ–°å››å‰æ ‘ä½¿ç”¨ - API å·²å¢å¼º
4. æ£€æŸ¥æ‰©å±•æ–¹æ³•å¯ç”¨æ€§ - æ·»åŠ äº†è®¸å¤šæ–°æ–¹æ³•

## ç‰ˆæœ¬ä¿¡æ¯

- **å½“å‰ç‰ˆæœ¬ï¼š** 0.9.6
- **å‘å¸ƒæ—¥æœŸï¼š** 2025å¹´5æœˆ24æ—¥
- **æ€»ä¸‹è½½é‡ï¼š** 6.5K+
- **è®¸å¯è¯ï¼š** å¼€æº

## é¡¹ç›®æ¨¡æ¿

IFoxCAD æä¾›äº†é¡¹ç›®æ¨¡æ¿æ¥å¿«é€Ÿå¼€å§‹å¼€å‘ï¼š

### VS æ¨¡æ¿æ’ä»¶
- ä¼ ç»Ÿçš„ Visual Studio é¡¹ç›®æ¨¡æ¿
- é€‚ç”¨äºç†Ÿæ‚‰ VS æ¨¡æ¿çš„å¼€å‘è€…

### .NET é¡¹ç›®æ¨¡æ¿
- æ¨èä½¿ç”¨çš„ç°ä»£é¡¹ç›®æ¨¡æ¿
- æ”¯æŒ .NET CLI å’Œç°ä»£å¼€å‘å·¥ä½œæµ

å»ºè®®ä½¿ç”¨ .NET é¡¹ç›®æ¨¡æ¿æ¥åˆ›å»ºæ–°é¡¹ç›®ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚

## ä½¿ç”¨ IFoxCAD çš„å‡ ç§æ–¹å¼

1. **NuGet åŒ…å¼•ç”¨** - æœ€å¸¸ç”¨çš„æ–¹å¼
2. **æºç ç¼–è¯‘** - ç”¨äºå®šåˆ¶å’Œè´¡çŒ®
3. **é¡¹ç›®æ¨¡æ¿** - å¿«é€Ÿå¼€å§‹æ–°é¡¹ç›®
4. **ç¤ºä¾‹é¡¹ç›®** - å­¦ä¹ å’Œå‚è€ƒ

è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ä¸­çš„"ä½¿ç”¨IFoxCADçš„å‡ ç§æ–¹å¼"ç« èŠ‚ã€‚

## åº“åŠŸèƒ½å®Œæ•´æ€§ç»Ÿè®¡

åŸºäºå¯¹ XML æ–‡æ¡£çš„å®Œæ•´åˆ†æï¼ŒIFoxCAD.AutoCAD åº“åŒ…å«ä»¥ä¸‹ä¸»è¦ç»„ä»¶ï¼š

### æ ¸å¿ƒå‘½åç©ºé—´ç»Ÿè®¡
- **IFoxCAD.Cad**: ä¸»è¦CADåŠŸèƒ½ï¼ŒåŒ…å«100+ä¸ªç±»å’Œæ‰©å±•
- **IFoxCAD.Cad.Assoc**: å…³è”å¯¹è±¡åŠŸèƒ½ï¼ŒåŒ…å«å…³è”æ€§API
- **IFoxCAD.Basal**: åŸºç¡€å·¥å…·ç±»ï¼ŒåŒ…å«20+ä¸ªå®ç”¨å·¥å…·ç±»

### ä¸»è¦åŠŸèƒ½æ¨¡å—ï¼ˆ15ä¸ªï¼‰
1. **ç©ºé—´æ•°æ®ç»“æ„** - å››å‰æ ‘ã€çŸ©å½¢æ“ä½œ
2. **æ•°æ®åº“æ“ä½œ** - äº‹åŠ¡ç®¡ç†ã€å­—å…¸æ“ä½œ
3. **å›¾å½¢å®ä½“æ‰©å±•** - æ‰€æœ‰ä¸»è¦CADå®ä½“çš„æ‰©å±•æ–¹æ³•
4. **å‡ ä½•è®¡ç®—** - ç‚¹ã€å‘é‡ã€å¹³é¢æ“ä½œ
5. **ç”¨æˆ·äº¤äº’** - ç¼–è¾‘å™¨æ‰©å±•ã€é€‰æ‹©é›†æ“ä½œ
6. **ç³»ç»Ÿç®¡ç†** - ç¯å¢ƒå˜é‡ã€è‡ªåŠ¨åŠ è½½
7. **è¿‡æ»¤å™¨ç³»ç»Ÿ** - å¼ºå¤§çš„é€‰æ‹©é›†è¿‡æ»¤
8. **æ•°æ®å°è£…** - å„ç§æ•°æ®åˆ—è¡¨ç±»
9. **å¡«å……ç³»ç»Ÿ** - å›¾æ¡ˆå¡«å……ã€æ¸å˜å¡«å……
10. **ç¬¦å·è¡¨ç®¡ç†** - å›¾å±‚ã€æ–‡å­—æ ·å¼ã€çº¿å‹ç®¡ç†
11. **Jigäº¤äº’** - åŠ¨æ€ç»˜å›¾ã€ç”¨æˆ·äº¤äº’
12. **å¤–éƒ¨å‚ç…§ç®¡ç†** - å®Œæ•´çš„å¤–éƒ¨å‚ç…§æ“ä½œ
13. **ç³»ç»Ÿå˜é‡ç®¡ç†** - ç»Ÿä¸€çš„ç³»ç»Ÿå˜é‡æ¥å£
14. **çª—å£å’ŒUIæ‰©å±•** - çª—ä½“ã€æ‰˜ç›˜æ“ä½œ
15. **å¤©æ­£æ¥å£** - å¤©æ­£CADå…¼å®¹æ€§

### æ‰©å±•ç±»ç»Ÿè®¡ï¼ˆ50+ä¸ªä¸»è¦æ‰©å±•ç±»ï¼‰
- **å®ä½“æ‰©å±•**: ArcEx, CircleEx, CurveEx, PolylineEx, DBTextEx, MTextEx, BlockReferenceEx, RegionEx, HatchEx
- **æ•°æ®åº“æ‰©å±•**: DatabaseEx, DBDictionaryEx, DBObjectEx, DBTransEx, TransactionEx
- **ç¼–è¾‘å™¨æ‰©å±•**: EditorEx, SelectionSetEx, JigEx
- **å‡ ä½•æ‰©å±•**: GeometryEx, Point2dEx, Point3dEx, Vector2dEx, Vector3dEx
- **é›†åˆæ‰©å±•**: CollectionEx, ArrayEx, LinqEx
- **ç¬¦å·è¡¨æ‰©å±•**: SymbolTableEx, LayerTableEx, TextStyleTableEx
- **çª—å£æ‰©å±•**: WindowEx, PaneEx
- **å¤–éƒ¨å‚ç…§æ‰©å±•**: XrefEx, XrefFactory

### å·¥å…·ç±»ç»Ÿè®¡ï¼ˆ30+ä¸ªå·¥å…·ç±»ï¼‰
- **æ•°æ®ç»“æ„**: QuadTree, LoopList, Rect, BulgeVertexWidth
- **è¿‡æ»¤å™¨**: OpFilter, OpEqual, OpAnd, OpOr, OpNot, OpXor
- **æ•°æ®åˆ—è¡¨**: TypedValueList, XDataList, XRecordDataList, LispList
- **ç³»ç»Ÿå·¥å…·**: SystemVariableManager, Env, AutoRegAssem
- **åŸºç¡€å·¥å…·**: RandomEx, SystemEx, WindowsAPI, PInvokeUser32

## æ€»ç»“

IFoxCAD.AutoCAD æ˜¯ä¸€ä¸ªåŠŸèƒ½æå…¶å¼ºå¤§ä¸”å…¨é¢çš„ AutoCAD äºŒæ¬¡å¼€å‘åº“ï¼Œå®ƒï¼š

- **åŠŸèƒ½å…¨é¢**: æ¶µç›–AutoCADå¼€å‘çš„æ‰€æœ‰ä¸»è¦æ–¹é¢ï¼Œä»åŸºç¡€å®ä½“æ“ä½œåˆ°é«˜çº§ç³»ç»Ÿç®¡ç†
- **æ¶æ„æ¸…æ™°**: 15ä¸ªä¸»è¦åŠŸèƒ½æ¨¡å—ï¼Œ50+æ‰©å±•ç±»ï¼Œ30+å·¥å…·ç±»ï¼Œç»“æ„å±‚æ¬¡åˆ†æ˜
- **æ€§èƒ½ä¼˜åŒ–**: å››å‰æ ‘ç©ºé—´ç´¢å¼•ã€åˆ—æ‰«ç¢°æ’æ£€æµ‹ç­‰é«˜æ•ˆç®—æ³•
- **æ˜“äºä½¿ç”¨**: ä¸°å¯Œçš„æ‰©å±•æ–¹æ³•ï¼Œç®€åŒ–çš„APIè®¾è®¡ï¼Œå‡å°‘æ ·æ¿ä»£ç 
- **åŠŸèƒ½å¼ºå¤§**: æ”¯æŒå¡«å……ã€Jigäº¤äº’ã€å¤–éƒ¨å‚ç…§ã€ç³»ç»Ÿå˜é‡ç®¡ç†ç­‰é«˜çº§åŠŸèƒ½
- **å…¼å®¹æ€§å¥½**: æ”¯æŒå¤šä¸ª.NETç‰ˆæœ¬å’ŒAutoCADç‰ˆæœ¬ï¼Œå…¼å®¹å¤©æ­£CAD
- **ç¤¾åŒºæ´»è·ƒ**: å®Œå–„çš„ä¸­æ–‡æ–‡æ¡£ï¼Œæ´»è·ƒçš„QQç¾¤æ”¯æŒ

è¯¥åº“ä¸ä»…ç®€åŒ–äº† AutoCAD .NET å¼€å‘ï¼Œæ›´æä¾›äº†ä¼ä¸šçº§çš„åŠŸèƒ½å®Œæ•´æ€§å’Œæ€§èƒ½ä¿éšœï¼Œæ˜¯ AutoCAD äºŒæ¬¡å¼€å‘çš„é¦–é€‰è§£å†³æ–¹æ¡ˆã€‚æ— è®ºæ˜¯ç®€å•çš„å®ä½“æ“ä½œè¿˜æ˜¯å¤æ‚çš„ç³»ç»Ÿé›†æˆï¼ŒIFoxCADéƒ½èƒ½æä¾›ç›¸åº”çš„å·¥å…·å’ŒæŠ½è±¡ï¼Œå¤§å¤§æé«˜å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡ã€‚

## æšä¸¾å’Œå¸¸é‡å®šä¹‰

### æ“ä½œæ¨¡å¼æšä¸¾

#### QuadTreeSelectMode å››å‰æ ‘é€‰æ‹©æ¨¡å¼

ç”¨äºå››å‰æ ‘æŸ¥è¯¢æ—¶æŒ‡å®šé€‰æ‹©æ¡ä»¶çš„æšä¸¾ã€‚

```csharp
public enum QuadTreeSelectMode
{
    /// <summary>
    /// ç¢°æ’åˆ°å°±é€‰ä¸­ - åªè¦æŸ¥è¯¢åŒºåŸŸä¸å®ä½“æœ‰ä»»ä½•äº¤é›†å°±é€‰ä¸­
    /// </summary>
    IntersectsWith,

    /// <summary>
    /// å…¨åŒ…å«æ‰é€‰ä¸­ - åªæœ‰æŸ¥è¯¢åŒºåŸŸå®Œå…¨åŒ…å«å®ä½“æ—¶æ‰é€‰ä¸­
    /// </summary>
    Contains
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
var quadTree = new QuadTree<Entity>(boundary);
var queryRect = new Rect(100, 100, 200, 200);

// æŸ¥è¯¢ä¸åŒºåŸŸç›¸äº¤çš„æ‰€æœ‰å®ä½“
var intersectingEntities = quadTree.Query(queryRect, QuadTreeSelectMode.IntersectsWith);

// æŸ¥è¯¢å®Œå…¨åŒ…å«åœ¨åŒºåŸŸå†…çš„å®ä½“
var containedEntities = quadTree.Query(queryRect, QuadTreeSelectMode.Contains);
```

#### QuadTreeFindMode å››å‰æ ‘æŸ¥æ‰¾æ–¹å‘

ç”¨äºå››å‰æ ‘é‚»è¿‘æŸ¥æ‰¾æ—¶æŒ‡å®šæœç´¢æ–¹å‘çš„æšä¸¾ã€‚

```csharp
public enum QuadTreeFindMode
{
    /// <summary>
    /// ä¸Šæ–¹å‘æŸ¥æ‰¾
    /// </summary>
    Top,

    /// <summary>
    /// ä¸‹æ–¹å‘æŸ¥æ‰¾
    /// </summary>
    Bottom,

    /// <summary>
    /// å·¦æ–¹å‘æŸ¥æ‰¾
    /// </summary>
    Left,

    /// <summary>
    /// å³æ–¹å‘æŸ¥æ‰¾
    /// </summary>
    Right
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
var quadTree = new QuadTree<Entity>(boundary);
var searchRect = new Rect(500, 500, 50, 50);

// æŸ¥æ‰¾ä¸Šæ–¹çš„é‚»å±…å®ä½“
var topNeighbors = quadTree.FindNeibor(searchRect, QuadTreeFindMode.Top);

// æŸ¥æ‰¾å·¦ä¾§çš„é‚»å±…å®ä½“
var leftNeighbors = quadTree.FindNeibor(searchRect, QuadTreeFindMode.Left);
```

#### RunLispFlag Lispæ‰§è¡Œæ–¹å¼

ç”¨äºæŒ‡å®šLispä»£ç æ‰§è¡Œæ–¹å¼çš„æšä¸¾ã€‚

```csharp
public enum RunLispFlag
{
    /// <summary>
    /// ä½¿ç”¨AdsQueueexpræ–¹å¼æ‰§è¡Œ
    /// é€‚ç”¨äºéœ€è¦é˜Ÿåˆ—æ‰§è¡Œçš„åœºæ™¯
    /// </summary>
    AdsQueueexpr,

    /// <summary>
    /// ä½¿ç”¨AcedEvaluateLispæ–¹å¼æ‰§è¡Œ
    /// é€‚ç”¨äºç«‹å³æ‰§è¡Œå¹¶è·å–è¿”å›å€¼çš„åœºæ™¯
    /// </summary>
    AcedEvaluateLisp,

    /// <summary>
    /// ä½¿ç”¨SendStringToExecuteæ–¹å¼æ‰§è¡Œ
    /// é€‚ç”¨äºå‘é€å‘½ä»¤å­—ç¬¦ä¸²çš„åœºæ™¯
    /// </summary>
    SendStringToExecute
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
var editor = Application.DocumentManager.MdiActiveDocument.Editor;

// ä½¿ç”¨ä¸åŒæ–¹å¼æ‰§è¡ŒLispä»£ç 
EditorEx.RunLisp(editor, "(command \"line\" \"0,0\" \"100,100\" \"\")", RunLispFlag.SendStringToExecute);
EditorEx.RunLisp(editor, "(+ 1 2 3)", RunLispFlag.AcedEvaluateLisp);
EditorEx.RunLisp(editor, "(setq pt (getpoint \"é€‰æ‹©ç‚¹:\"))", RunLispFlag.AdsQueueexpr);
```

#### XrefModes å¤–éƒ¨å‚ç…§æ¨¡å¼

ç”¨äºå¤–éƒ¨å‚ç…§æ“ä½œçš„æ¨¡å¼æšä¸¾ã€‚

```csharp
public enum XrefModes
{
    /// <summary>
    /// å¸è½½å¤–éƒ¨å‚ç…§
    /// ä»å½“å‰å›¾å½¢ä¸­ç§»é™¤å‚ç…§ï¼Œä½†ä¿æŒå‚ç…§å®šä¹‰
    /// </summary>
    Unload,

    /// <summary>
    /// é‡è½½å¤–éƒ¨å‚ç…§
    /// é‡æ–°åŠ è½½å‚ç…§æ–‡ä»¶çš„æœ€æ–°ç‰ˆæœ¬
    /// </summary>
    Reload,

    /// <summary>
    /// æ‹†ç¦»å¤–éƒ¨å‚ç…§
    /// å®Œå…¨ç§»é™¤å‚ç…§å®šä¹‰å’Œæ‰€æœ‰ç›¸å…³æ•°æ®
    /// </summary>
    Detach,

    /// <summary>
    /// ç»‘å®šå¤–éƒ¨å‚ç…§
    /// å°†å‚ç…§å†…å®¹æ°¸ä¹…åˆå¹¶åˆ°å½“å‰å›¾å½¢ä¸­
    /// </summary>
    Bind
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// å¤–éƒ¨å‚ç…§ç®¡ç†ç¤ºä¾‹
using (var tr = new DBTrans())
{
    var xrefTable = tr.XrefTable;

    foreach (var xrefId in xrefTable)
    {
        var xrefRecord = tr.GetObject<XrefGraph>(xrefId);

        // æ ¹æ®éœ€è¦æ‰§è¡Œä¸åŒçš„å‚ç…§æ“ä½œ
        switch (operationMode)
        {
            case XrefModes.Reload:
                // é‡è½½å‚ç…§
                xrefRecord.Reload();
                break;

            case XrefModes.Unload:
                // å¸è½½å‚ç…§
                xrefRecord.Unload();
                break;

            case XrefModes.Bind:
                // ç»‘å®šå‚ç…§
                xrefRecord.Bind();
                break;

            case XrefModes.Detach:
                // æ‹†ç¦»å‚ç…§
                xrefRecord.Detach();
                break;
        }
    }

    tr.Commit();
}
```

### ç³»ç»Ÿé…ç½®æšä¸¾

#### SymModes ç¬¦å·è¡¨æ¨¡å¼

ç”¨äºæŒ‡å®šè¦æ“ä½œçš„ç¬¦å·è¡¨ç±»å‹çš„æšä¸¾ã€‚

```csharp
public enum SymModes
{
    /// <summary>
    /// å—è¡¨ - ç®¡ç†å—å®šä¹‰
    /// </summary>
    BlockTable,

    /// <summary>
    /// å›¾å±‚è¡¨ - ç®¡ç†å›¾å±‚å®šä¹‰
    /// </summary>
    LayerTable,

    /// <summary>
    /// æ–‡å­—æ ·å¼è¡¨ - ç®¡ç†æ–‡å­—æ ·å¼å®šä¹‰
    /// </summary>
    TextStyleTable,

    /// <summary>
    /// æ³¨å†Œåº”ç”¨ç¨‹åºè¡¨ - ç®¡ç†æ‰©å±•æ•°æ®åº”ç”¨ç¨‹åº
    /// </summary>
    RegAppTable,

    /// <summary>
    /// æ ‡æ³¨æ ·å¼è¡¨ - ç®¡ç†æ ‡æ³¨æ ·å¼å®šä¹‰
    /// </summary>
    DimStyleTable,

    /// <summary>
    /// çº¿å‹è¡¨ - ç®¡ç†çº¿å‹å®šä¹‰
    /// </summary>
    LinetypeTable,

    /// <summary>
    /// ç”¨æˆ·åæ ‡ç³»è¡¨ - ç®¡ç†UCSå®šä¹‰
    /// </summary>
    UcsTable,

    /// <summary>
    /// è§†å›¾è¡¨ - ç®¡ç†å‘½åè§†å›¾
    /// </summary>
    ViewTable,

    /// <summary>
    /// è§†å£è¡¨ - ç®¡ç†è§†å£é…ç½®
    /// </summary>
    ViewportTable,

    /// <summary>
    /// é€‰é¡¹1 - å›¾å±‚|å­—ä½“|æ ‡æ³¨|çº¿å‹|åº”ç”¨
    /// </summary>
    Option1,

    /// <summary>
    /// é€‰é¡¹2 - åæ ‡|è§†å£|è§†å›¾
    /// </summary>
    Option2,

    /// <summary>
    /// å…¨éƒ¨ç¬¦å·è¡¨
    /// </summary>
    All
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// æ¸…ç†æœªä½¿ç”¨çš„ç¬¦å·è¡¨é¡¹
using (var tr = new DBTrans())
{
    // æ¸…ç†æœªä½¿ç”¨çš„å›¾å±‚
    tr.Database.PurgeSymbolTable(SymModes.LayerTable);

    // æ¸…ç†æœªä½¿ç”¨çš„å—
    tr.Database.PurgeSymbolTable(SymModes.BlockTable);

    // æ¸…ç†æœªä½¿ç”¨çš„æ–‡å­—æ ·å¼
    tr.Database.PurgeSymbolTable(SymModes.TextStyleTable);

    tr.Commit();
}
```

#### CoordinateSystemCode åæ ‡ç³»ç±»å‹

ç”¨äºæŒ‡å®šåæ ‡ç³»è½¬æ¢çš„æºå’Œç›®æ ‡åæ ‡ç³»ç±»å‹ã€‚

```csharp
public enum CoordinateSystemCode
{
    /// <summary>
    /// ä¸–ç•Œåæ ‡ç³» (World Coordinate System)
    /// å›ºå®šçš„å…¨å±€åæ ‡ç³»
    /// </summary>
    Wcs,

    /// <summary>
    /// ç”¨æˆ·åæ ‡ç³» (User Coordinate System)
    /// ç”¨æˆ·å®šä¹‰çš„åæ ‡ç³»
    /// </summary>
    Ucs,

    /// <summary>
    /// æ¨¡å‹ç©ºé—´åæ ‡ç³» (Model Space Display Coordinate System)
    /// æ¨¡å‹ç©ºé—´çš„æ˜¾ç¤ºåæ ‡ç³»
    /// </summary>
    MDcs,

    /// <summary>
    /// å›¾çº¸ç©ºé—´åæ ‡ç³» (Paper Space Display Coordinate System)
    /// å›¾çº¸ç©ºé—´çš„æ˜¾ç¤ºåæ ‡ç³»
    /// </summary>
    PDcs
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
var editor = Application.DocumentManager.MdiActiveDocument.Editor;

// è·å–ä¸åŒåæ ‡ç³»ä¹‹é—´çš„å˜æ¢çŸ©é˜µ
var ucsToWcs = EditorEx.GetMatrix(editor, CoordinateSystemCode.Ucs, CoordinateSystemCode.Wcs);
var wcsToUcs = EditorEx.GetMatrix(editor, CoordinateSystemCode.Wcs, CoordinateSystemCode.Ucs);
var mdcsToPdcs = EditorEx.GetMatrix(editor, CoordinateSystemCode.MDcs, CoordinateSystemCode.PDcs);

// åæ ‡ç‚¹è½¬æ¢
var ucsPoint = new Point3d(100, 100, 0);
var wcsPoint = ucsPoint.TransformBy(ucsToWcs);

Console.WriteLine($"UCSç‚¹: {ucsPoint}");
Console.WriteLine($"WCSç‚¹: {wcsPoint}");
```

#### AssemLoadType ç¨‹åºé›†åŠ è½½ç±»å‹

ç”¨äºæŒ‡å®šAutoCADæ’ä»¶ç¨‹åºé›†çš„åŠ è½½æ–¹å¼ã€‚

```csharp
public enum AssemLoadType
{
    /// <summary>
    /// å¯åŠ¨æ—¶åŠ è½½
    /// AutoCADå¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½ç¨‹åºé›†
    /// </summary>
    Starting,

    /// <summary>
    /// éšå‘½ä»¤åŠ è½½
    /// å½“è°ƒç”¨ç¨‹åºé›†ä¸­çš„å‘½ä»¤æ—¶æ‰åŠ è½½
    /// </summary>
    ByCommand,

    /// <summary>
    /// ç¦ç”¨åŠ è½½
    /// ä¸è‡ªåŠ¨åŠ è½½ç¨‹åºé›†
    /// </summary>
    Disabled
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// åœ¨æ’ä»¶æ³¨å†Œæ—¶æŒ‡å®šåŠ è½½ç±»å‹
[assembly: ExtensionApplication(typeof(MyApplication))]
[assembly: CommandClass(typeof(MyCommands))]

public class MyApplication : IExtensionApplication
{
    public void Initialize()
    {
        // æ ¹æ®åŠ è½½ç±»å‹æ‰§è¡Œä¸åŒçš„åˆå§‹åŒ–é€»è¾‘
        var loadType = GetCurrentLoadType();

        switch (loadType)
        {
            case AssemLoadType.Starting:
                // å¯åŠ¨æ—¶åŠ è½½ï¼Œæ‰§è¡Œå®Œæ•´åˆå§‹åŒ–
                InitializeFullFeatures();
                break;

            case AssemLoadType.ByCommand:
                // æŒ‰éœ€åŠ è½½ï¼Œå»¶è¿Ÿåˆå§‹åŒ–
                InitializeLazyFeatures();
                break;

            case AssemLoadType.Disabled:
                // ç¦ç”¨çŠ¶æ€ï¼Œä¸æ‰§è¡Œåˆå§‹åŒ–
                break;
        }
    }

    private AssemLoadType GetCurrentLoadType()
    {
        // ä»æ³¨å†Œè¡¨æˆ–é…ç½®æ–‡ä»¶è¯»å–åŠ è½½ç±»å‹
        // è¿™é‡Œç®€åŒ–ä¸ºè¿”å›é»˜è®¤å€¼
        return AssemLoadType.ByCommand;
    }
}
```

**å®é™…åº”ç”¨åœºæ™¯ï¼š**

**ç¬¦å·è¡¨ç®¡ç†åº”ç”¨ï¼š**
```csharp
// ç¬¦å·è¡¨æ¸…ç†å·¥å…·
public class SymbolTableCleaner
{
    public static void CleanUnusedSymbols(Database db, SymModes mode)
    {
        using (var tr = new DBTrans(db))
        {
            switch (mode)
            {
                case SymModes.LayerTable:
                    CleanUnusedLayers(tr);
                    break;

                case SymModes.BlockTable:
                    CleanUnusedBlocks(tr);
                    break;

                case SymModes.TextStyleTable:
                    CleanUnusedTextStyles(tr);
                    break;

                case SymModes.All:
                    CleanAllUnusedSymbols(tr);
                    break;
            }

            tr.Commit();
        }
    }

    private static void CleanUnusedLayers(DBTrans tr)
    {
        var layerTable = tr.LayerTable;
        var layersToDelete = new List<ObjectId>();

        foreach (var layerId in layerTable)
        {
            var layer = tr.GetObject<LayerTableRecord>(layerId);
            if (!layer.IsUsed && layer.Name != "0")
            {
                layersToDelete.Add(layerId);
            }
        }

        foreach (var layerId in layersToDelete)
        {
            var layer = tr.GetObject<LayerTableRecord>(layerId, OpenMode.ForWrite);
            layer.Erase();
        }
    }
}
```

**åæ ‡ç³»è½¬æ¢åº”ç”¨ï¼š**
```csharp
// åæ ‡ç³»è½¬æ¢å·¥å…·
public class CoordinateConverter
{
    public static Point3d ConvertPoint(Point3d point, CoordinateSystemCode from, CoordinateSystemCode to)
    {
        var editor = Application.DocumentManager.MdiActiveDocument.Editor;
        var matrix = EditorEx.GetMatrix(editor, from, to);
        return point.TransformBy(matrix);
    }

    public static List<Point3d> ConvertPoints(IEnumerable<Point3d> points, CoordinateSystemCode from, CoordinateSystemCode to)
    {
        var editor = Application.DocumentManager.MdiActiveDocument.Editor;
        var matrix = EditorEx.GetMatrix(editor, from, to);

        return points.Select(p => p.TransformBy(matrix)).ToList();
    }

    // å®ä½“åæ ‡ç³»è½¬æ¢
    public static void TransformEntity(Entity entity, CoordinateSystemCode from, CoordinateSystemCode to)
    {
        var matrix = EditorEx.GetMatrix(
            Application.DocumentManager.MdiActiveDocument.Editor,
            from, to);

        entity.TransformBy(matrix);
    }
}
```

**ç¨‹åºé›†åŠ è½½ç®¡ç†ï¼š**
```csharp
// æ’ä»¶åŠ è½½ç®¡ç†å™¨
public class PluginLoadManager
{
    private static readonly Dictionary<string, AssemLoadType> PluginLoadTypes =
        new Dictionary<string, AssemLoadType>();

    public static void RegisterPlugin(string pluginName, AssemLoadType loadType)
    {
        PluginLoadTypes[pluginName] = loadType;

        switch (loadType)
        {
            case AssemLoadType.Starting:
                // æ³¨å†Œä¸ºå¯åŠ¨æ—¶åŠ è½½
                RegisterForStartupLoad(pluginName);
                break;

            case AssemLoadType.ByCommand:
                // æ³¨å†Œä¸ºæŒ‰éœ€åŠ è½½
                RegisterForDemandLoad(pluginName);
                break;

            case AssemLoadType.Disabled:
                // ç¦ç”¨æ’ä»¶
                DisablePlugin(pluginName);
                break;
        }
    }

    private static void RegisterForStartupLoad(string pluginName)
    {
        // å°†æ’ä»¶æ·»åŠ åˆ°AutoCADå¯åŠ¨åŠ è½½åˆ—è¡¨
        // å®ç°çœç•¥
    }

    private static void RegisterForDemandLoad(string pluginName)
    {
        // å°†æ’ä»¶æ³¨å†Œä¸ºæŒ‰éœ€åŠ è½½
        // å®ç°çœç•¥
    }

    private static void DisablePlugin(string pluginName)
    {
        // ç¦ç”¨æ’ä»¶åŠ è½½
        // å®ç°çœç•¥
    }
}
```

### é”™è¯¯å’ŒçŠ¶æ€æšä¸¾

#### GetMethodErrorNum PEæ–¹æ³•é”™è¯¯ç¼–å·

ç”¨äºPEæ–¹æ³•è°ƒç”¨æ—¶çš„é”™è¯¯çŠ¶æ€æšä¸¾ï¼Œå¯¹åº”GetPeMethodExceptionçš„é”™è¯¯å€¼ã€‚

```csharp
public enum GetMethodErrorNum
{
    /// <summary>
    /// æ“ä½œæˆåŠŸï¼Œæ— é”™è¯¯
    /// </summary>
    Ok,

    /// <summary>
    /// æœªæ‰¾åˆ°æ¨¡å—
    /// æŒ‡å®šçš„DLLæ¨¡å—ä¸å­˜åœ¨æˆ–æ— æ³•åŠ è½½
    /// </summary>
    NoModule,

    /// <summary>
    /// æœªæ‰¾åˆ°å‡½æ•°å
    /// æŒ‡å®šçš„å‡½æ•°åœ¨æ¨¡å—ä¸­ä¸å­˜åœ¨
    /// </summary>
    NoFuncName
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
try
{
    // å°è¯•è·å–PEæ–¹æ³•
    var result = AcadPeInfo.GetDelegate<SomeDelegate>("functionName", AcadPeEnum.AcadExe);
    if (result == null)
    {
        throw new GetPeMethodException((int)GetMethodErrorNum.NoFuncName, "æœªæ‰¾åˆ°æŒ‡å®šå‡½æ•°");
    }
}
catch (GetPeMethodException ex)
{
    switch ((GetMethodErrorNum)ex.ErrorNum)
    {
        case GetMethodErrorNum.NoModule:
            Console.WriteLine("æ¨¡å—åŠ è½½å¤±è´¥");
            break;

        case GetMethodErrorNum.NoFuncName:
            Console.WriteLine("å‡½æ•°ä¸å­˜åœ¨");
            break;

        case GetMethodErrorNum.Ok:
            Console.WriteLine("æ“ä½œæˆåŠŸ");
            break;
    }
}
```

#### DBmod æ•°æ®åº“ä¿®æ”¹çŠ¶æ€

ç”¨äºè·å–å’Œè®¾ç½®AutoCADæ•°æ®åº“çš„ä¿®æ”¹çŠ¶æ€æ ‡å¿—ã€‚

```csharp
public enum DBmod
{
    /// <summary>
    /// æ•°æ®åº“æœªä¿®æ”¹
    /// å›¾å½¢æ–‡ä»¶æ²¡æœ‰ä»»ä½•æ›´æ”¹
    /// </summary>
    DatabaseNoModifies,

    /// <summary>
    /// æ•°æ®åº“æœ‰ä¿®æ”¹
    /// å›¾å½¢æ–‡ä»¶çš„å®ä½“æˆ–å¯¹è±¡æœ‰æ›´æ”¹
    /// </summary>
    Database,

    /// <summary>
    /// å˜é‡æœ‰ä¿®æ”¹
    /// ç³»ç»Ÿå˜é‡æˆ–ç”¨æˆ·å˜é‡æœ‰æ›´æ”¹
    /// </summary>
    Value,

    /// <summary>
    /// çª—å£æœ‰ä¿®æ”¹
    /// çª—å£å¸ƒå±€æˆ–æ˜¾ç¤ºè®¾ç½®æœ‰æ›´æ”¹
    /// </summary>
    Window,

    /// <summary>
    /// è§†å›¾æœ‰ä¿®æ”¹
    /// è§†å›¾è®¾ç½®æˆ–è§†å£é…ç½®æœ‰æ›´æ”¹
    /// </summary>
    View,

    /// <summary>
    /// å­—æ®µæœ‰ä¿®æ”¹
    /// å­—æ®µå€¼æˆ–å­—æ®µå®šä¹‰æœ‰æ›´æ”¹
    /// </summary>
    Field
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// æ£€æŸ¥æ•°æ®åº“ä¿®æ”¹çŠ¶æ€
var currentStatus = DBmodEx.DBmod;
Console.WriteLine($"å½“å‰ä¿®æ”¹çŠ¶æ€: {currentStatus}");

// æ ¹æ®ä¿®æ”¹çŠ¶æ€å†³å®šæ˜¯å¦ä¿å­˜
switch (currentStatus)
{
    case DBmod.DatabaseNoModifies:
        Console.WriteLine("å›¾å½¢æ— ä¿®æ”¹ï¼Œæ— éœ€ä¿å­˜");
        break;

    case DBmod.Database:
        Console.WriteLine("å›¾å½¢æœ‰ä¿®æ”¹ï¼Œå»ºè®®ä¿å­˜");
        // æ‰§è¡Œä¿å­˜æ“ä½œ
        break;

    case DBmod.Value:
        Console.WriteLine("å˜é‡æœ‰ä¿®æ”¹");
        break;

    case DBmod.Window:
        Console.WriteLine("çª—å£è®¾ç½®æœ‰ä¿®æ”¹");
        break;

    case DBmod.View:
        Console.WriteLine("è§†å›¾æœ‰ä¿®æ”¹");
        break;

    case DBmod.Field:
        Console.WriteLine("å­—æ®µæœ‰ä¿®æ”¹");
        break;
}

// æ‰‹åŠ¨è®¾ç½®ä¿®æ”¹çŠ¶æ€
using (var tr = new DBTrans())
{
    var database = tr.Database;

    // æ ‡è®°æ•°æ®åº“ä¸ºå·²ä¿®æ”¹
    DBmodEx.AcdbSetDbmod(database.UnmanagedObject, DBmod.Database);

    // æˆ–è€…æ ‡è®°ä¸ºæœªä¿®æ”¹
    DBmodEx.AcdbSetDbmod(database.UnmanagedObject, DBmod.DatabaseNoModifies);

    tr.Commit();
}
```

#### AcadPeEnum PEæ–‡ä»¶é€‰æ‹©æ¨¡å¼

ç”¨äºæŒ‡å®šè¦è¯»å–çš„AutoCAD PEæ–‡ä»¶ç±»å‹ã€‚

```csharp
public enum AcadPeEnum
{
    /// <summary>
    /// AutoCADä¸»ç¨‹åº (acad.exe)
    /// åŒ…å«AutoCADæ ¸å¿ƒåŠŸèƒ½çš„ä¸»æ‰§è¡Œæ–‡ä»¶
    /// </summary>
    AcadExe,

    /// <summary>
    /// AutoCADæ ¸å¿ƒåº“ (accore.dll)
    /// åŒ…å«AutoCADæ ¸å¿ƒAPIçš„åŠ¨æ€é“¾æ¥åº“
    /// </summary>
    AccoreDll,

    /// <summary>
    /// AutoCADæ•°æ®åº“åº“ (acdb.dll)
    /// åŒ…å«æ•°æ®åº“æ“ä½œç›¸å…³APIçš„åŠ¨æ€é“¾æ¥åº“
    /// </summary>
    Acdb,

    /// <summary>
    /// ä¸»ç¨‹åºå’Œæ ¸å¿ƒåº“ç»„åˆ
    /// åŒæ—¶ä»acad.exeå’Œaccore.dllä¸­æŸ¥æ‰¾å‡½æ•°
    /// </summary>
    ExeAndCore
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// ä»ä¸åŒçš„PEæ–‡ä»¶è·å–å‡½æ•°æŒ‡é’ˆ
try
{
    // ä»AutoCADä¸»ç¨‹åºè·å–å‡½æ•°
    var acadFunction = AcadPeInfo.GetDelegate<SomeDelegate>("functionName", AcadPeEnum.AcadExe);

    // ä»æ ¸å¿ƒåº“è·å–å‡½æ•°
    var coreFunction = AcadPeInfo.GetDelegate<SomeDelegate>("functionName", AcadPeEnum.AccoreDll);

    // ä»æ•°æ®åº“åº“è·å–å‡½æ•°
    var dbFunction = AcadPeInfo.GetDelegate<SomeDelegate>("functionName", AcadPeEnum.Acdb);

    // ä»ä¸»ç¨‹åºå’Œæ ¸å¿ƒåº“ç»„åˆä¸­æŸ¥æ‰¾
    var combinedFunction = AcadPeInfo.GetDelegate<SomeDelegate>("functionName", AcadPeEnum.ExeAndCore);

    if (combinedFunction != null)
    {
        Console.WriteLine("æˆåŠŸè·å–å‡½æ•°æŒ‡é’ˆ");
        // è°ƒç”¨å‡½æ•°
        var result = combinedFunction.Invoke(/* å‚æ•° */);
    }
}
catch (GetPeMethodException ex)
{
    Console.WriteLine($"è·å–å‡½æ•°å¤±è´¥: {ex.ErrorMsg}");
}
```

**å®é™…åº”ç”¨åœºæ™¯ï¼š**

**é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç›‘æ§ï¼š**
```csharp
// ç»¼åˆé”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç›‘æ§ç±»
public class CadStatusMonitor
{
    public static void MonitorDatabaseChanges()
    {
        var initialStatus = DBmodEx.DBmod;
        Console.WriteLine($"åˆå§‹çŠ¶æ€: {initialStatus}");

        // æ‰§è¡Œä¸€äº›æ“ä½œ
        using (var tr = new DBTrans())
        {
            // åˆ›å»ºä¸€äº›å®ä½“
            var line = new Line(Point3d.Origin, new Point3d(100, 100, 0));
            tr.CurrentSpace.AddEntity(line);
            tr.Commit();
        }

        var finalStatus = DBmodEx.DBmod;
        Console.WriteLine($"æ“ä½œåçŠ¶æ€: {finalStatus}");

        // æ£€æŸ¥çŠ¶æ€å˜åŒ–
        if (finalStatus != initialStatus)
        {
            Console.WriteLine("æ£€æµ‹åˆ°æ•°æ®åº“ä¿®æ”¹");

            // æ ¹æ®ä¿®æ”¹ç±»å‹æ‰§è¡Œç›¸åº”æ“ä½œ
            HandleDatabaseModification(finalStatus);
        }
    }

    private static void HandleDatabaseModification(DBmod status)
    {
        switch (status)
        {
            case DBmod.Database:
                // æ•°æ®åº“æœ‰ä¿®æ”¹ï¼Œæç¤ºç”¨æˆ·ä¿å­˜
                var result = MessageBox.Show("å›¾å½¢å·²ä¿®æ”¹ï¼Œæ˜¯å¦ä¿å­˜ï¼Ÿ", "æç¤º",
                    MessageBoxButtons.YesNo, MessageBoxIcon.Question);
                if (result == DialogResult.Yes)
                {
                    // æ‰§è¡Œä¿å­˜æ“ä½œ
                    SaveCurrentDrawing();
                }
                break;

            case DBmod.Value:
                Console.WriteLine("ç³»ç»Ÿå˜é‡å·²ä¿®æ”¹");
                break;

            case DBmod.View:
                Console.WriteLine("è§†å›¾è®¾ç½®å·²ä¿®æ”¹");
                break;
        }
    }

    private static void SaveCurrentDrawing()
    {
        try
        {
            var doc = Application.DocumentManager.MdiActiveDocument;
            doc.Database.SaveAs(doc.Name, DwgVersion.Current);

            // é‡ç½®ä¿®æ”¹çŠ¶æ€
            DBmodEx.AcdbSetDbmod(doc.Database.UnmanagedObject, DBmod.DatabaseNoModifies);

            Console.WriteLine("å›¾å½¢ä¿å­˜æˆåŠŸ");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"ä¿å­˜å¤±è´¥: {ex.Message}");
        }
    }
}
```

**PEå‡½æ•°åŠ¨æ€è°ƒç”¨ç®¡ç†ï¼š**
```csharp
// PEå‡½æ•°ç®¡ç†å™¨
public class PeFunctionManager
{
    private static readonly Dictionary<string, Delegate> FunctionCache =
        new Dictionary<string, Delegate>();

    public static T GetCachedFunction<T>(string functionName, AcadPeEnum peType) where T : Delegate
    {
        var key = $"{functionName}_{peType}";

        if (FunctionCache.TryGetValue(key, out var cachedFunction))
        {
            return (T)cachedFunction;
        }

        try
        {
            var function = AcadPeInfo.GetDelegate<T>(functionName, peType);
            if (function != null)
            {
                FunctionCache[key] = function;
                return function;
            }
        }
        catch (GetPeMethodException ex)
        {
            LogError(functionName, peType, ex);
        }

        return null;
    }

    private static void LogError(string functionName, AcadPeEnum peType, GetPeMethodException ex)
    {
        var errorType = (GetMethodErrorNum)ex.ErrorNum;
        var peTypeName = peType.ToString();

        switch (errorType)
        {
            case GetMethodErrorNum.NoModule:
                Console.WriteLine($"æ¨¡å— {peTypeName} æœªæ‰¾åˆ°ï¼Œæ— æ³•è·å–å‡½æ•° {functionName}");
                break;

            case GetMethodErrorNum.NoFuncName:
                Console.WriteLine($"åœ¨æ¨¡å— {peTypeName} ä¸­æœªæ‰¾åˆ°å‡½æ•° {functionName}");
                break;

            default:
                Console.WriteLine($"è·å–å‡½æ•° {functionName} æ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯: {ex.ErrorMsg}");
                break;
        }
    }

    // æ¸…ç†ç¼“å­˜
    public static void ClearCache()
    {
        FunctionCache.Clear();
    }

    // é¢„åŠ è½½å¸¸ç”¨å‡½æ•°
    public static void PreloadCommonFunctions()
    {
        var commonFunctions = new[]
        {
            ("acedCommand", AcadPeEnum.AcadExe),
            ("acedGetPoint", AcadPeEnum.AcadExe),
            ("acdbOpenObject", AcadPeEnum.Acdb)
        };

        foreach (var (funcName, peType) in commonFunctions)
        {
            try
            {
                // å°è¯•é¢„åŠ è½½ï¼ˆè¿™é‡Œéœ€è¦å…·ä½“çš„å§”æ‰˜ç±»å‹ï¼‰
                Console.WriteLine($"é¢„åŠ è½½å‡½æ•°: {funcName} from {peType}");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"é¢„åŠ è½½å‡½æ•° {funcName} å¤±è´¥: {ex.Message}");
            }
        }
    }
}
```

### UIå’Œäº¤äº’æšä¸¾

#### PaneMarginType æ‰˜ç›˜è¾¹è·ç±»å‹

ç”¨äºè®¾ç½®AutoCADæ‰˜ç›˜é¢æ¿çš„è¾¹è·æ ·å¼ã€‚

```csharp
public enum PaneMarginType
{
    /// <summary>
    /// æ— è¾¹è·
    /// æ‰˜ç›˜é¢æ¿ç´§è´´è¾¹ç¼˜ï¼Œæ— é¢å¤–ç©ºç™½
    /// </summary>
    NONE,

    /// <summary>
    /// å°è¾¹è·
    /// æ‰˜ç›˜é¢æ¿æœ‰è¾ƒå°çš„è¾¹è·ç©ºç™½
    /// </summary>
    SMALL,

    /// <summary>
    /// å¤§è¾¹è·
    /// æ‰˜ç›˜é¢æ¿æœ‰è¾ƒå¤§çš„è¾¹è·ç©ºç™½
    /// </summary>
    LARGE
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// åˆ›å»ºè‡ªå®šä¹‰æ‰˜ç›˜é¢æ¿
public class CustomPaletteSet : PaletteSet
{
    public CustomPaletteSet() : base("è‡ªå®šä¹‰å·¥å…·é¢æ¿")
    {
        // è®¾ç½®æ‰˜ç›˜è¾¹è·
        SetMarginType(PaneMarginType.SMALL);

        // æ·»åŠ é¢æ¿å†…å®¹
        var userControl = new MyCustomControl();
        Add("å·¥å…·é¢æ¿", userControl);

        // æ˜¾ç¤ºé¢æ¿
        Visible = true;
    }

    private void SetMarginType(PaneMarginType marginType)
    {
        switch (marginType)
        {
            case PaneMarginType.NONE:
                // è®¾ç½®æ— è¾¹è·æ ·å¼
                this.Dock = DockSides.None;
                break;

            case PaneMarginType.SMALL:
                // è®¾ç½®å°è¾¹è·æ ·å¼
                this.MinimumSize = new Size(200, 300);
                break;

            case PaneMarginType.LARGE:
                // è®¾ç½®å¤§è¾¹è·æ ·å¼
                this.MinimumSize = new Size(250, 350);
                break;
        }
    }
}
```

#### SingleKeyWordWorkType å•å…³é”®å­—å·¥ä½œæ¨¡å¼

ç”¨äºæŒ‡å®šå•å…³é”®å­—è¾“å…¥çš„å·¥ä½œæ¨¡å¼å’Œå“åº”æ–¹å¼ã€‚

```csharp
public enum SingleKeyWordWorkType
{
    /// <summary>
    /// ESCæ¨¡å¼
    /// æŒ‰ESCé”®é€€å‡ºæˆ–å–æ¶ˆå½“å‰æ“ä½œ
    /// </summary>
    ESCAPE,

    /// <summary>
    /// Enteræ¨¡å¼
    /// æŒ‰Enteré”®ç¡®è®¤æˆ–ç»§ç»­å½“å‰æ“ä½œ
    /// </summary>
    ENTER,

    /// <summary>
    /// Write Lineæ¨¡å¼
    /// è¾“å‡ºä¿¡æ¯åˆ°å‘½ä»¤è¡Œ
    /// </summary>
    WRITE_LINE
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// å•å…³é”®å­—è¾“å…¥å¤„ç†å™¨
public class SingleKeywordHandler
{
    public static void HandleKeywordInput(string keyword, SingleKeyWordWorkType workType)
    {
        switch (workType)
        {
            case SingleKeyWordWorkType.ESCAPE:
                HandleEscapeMode(keyword);
                break;

            case SingleKeyWordWorkType.ENTER:
                HandleEnterMode(keyword);
                break;

            case SingleKeyWordWorkType.WRITE_LINE:
                HandleWriteLineMode(keyword);
                break;
        }
    }

    private static void HandleEscapeMode(string keyword)
    {
        if (keyword.ToUpper() == "ESC" || keyword == "\x1B")
        {
            // å–æ¶ˆå½“å‰æ“ä½œ
            var editor = Application.DocumentManager.MdiActiveDocument.Editor;
            editor.WriteMessage("\næ“ä½œå·²å–æ¶ˆã€‚");

            // å‘é€ESCå‘½ä»¤
            Application.DocumentManager.MdiActiveDocument.SendStringToExecute("\x1B", true, false, false);
        }
    }

    private static void HandleEnterMode(string keyword)
    {
        if (keyword == "\r" || keyword == "\n" || string.IsNullOrEmpty(keyword))
        {
            // ç¡®è®¤å½“å‰æ“ä½œ
            var editor = Application.DocumentManager.MdiActiveDocument.Editor;
            editor.WriteMessage("\næ“ä½œå·²ç¡®è®¤ã€‚");
        }
    }

    private static void HandleWriteLineMode(string keyword)
    {
        // è¾“å‡ºå…³é”®å­—åˆ°å‘½ä»¤è¡Œ
        var editor = Application.DocumentManager.MdiActiveDocument.Editor;
        editor.WriteMessage($"\næ¥æ”¶åˆ°å…³é”®å­—: {keyword}");
    }
}

// åœ¨å‘½ä»¤ä¸­ä½¿ç”¨å•å…³é”®å­—å¤„ç†
[CommandMethod("TESTKEYWORD")]
public void TestKeywordCommand()
{
    var editor = Application.DocumentManager.MdiActiveDocument.Editor;

    var options = new PromptKeywordOptions("\né€‰æ‹©æ“ä½œæ¨¡å¼ [ESCé€€å‡º(E)/ç¡®è®¤(C)/è¾“å‡º(W)]:")
    {
        AllowNone = false
    };
    options.Keywords.Add("E");
    options.Keywords.Add("C");
    options.Keywords.Add("W");

    var result = editor.GetKeywords(options);
    if (result.Status == PromptStatus.OK)
    {
        switch (result.StringResult.ToUpper())
        {
            case "E":
                SingleKeywordHandler.HandleKeywordInput("ESC", SingleKeyWordWorkType.ESCAPE);
                break;
            case "C":
                SingleKeywordHandler.HandleKeywordInput("", SingleKeyWordWorkType.ENTER);
                break;
            case "W":
                SingleKeywordHandler.HandleKeywordInput("æµ‹è¯•è¾“å‡º", SingleKeyWordWorkType.WRITE_LINE);
                break;
        }
    }
}
```

#### FontTTF å­—ä½“ç±»å‹æšä¸¾

ç”¨äºæŒ‡å®šAutoCADä¸­å¸¸ç”¨çš„TTFå­—ä½“ç±»å‹ã€‚

```csharp
public enum FontTTF
{
    /// <summary>
    /// å®‹ä½“ - ä¸­æ–‡æ ‡å‡†å­—ä½“
    /// </summary>
    å®‹ä½“,

    /// <summary>
    /// ä»¿å®‹ - ä¸­æ–‡ä»¿å®‹å­—ä½“
    /// </summary>
    ä»¿å®‹,

    /// <summary>
    /// ä»¿å®‹GB2312 - GB2312ç¼–ç çš„ä»¿å®‹å­—ä½“
    /// </summary>
    ä»¿å®‹GB2312,

    /// <summary>
    /// Arial - è‹±æ–‡æ— è¡¬çº¿å­—ä½“
    /// </summary>
    Arial,

    /// <summary>
    /// Romans - AutoCADæ ‡å‡†è‹±æ–‡å­—ä½“
    /// </summary>
    Romans
}
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```csharp
// å­—ä½“ç®¡ç†å·¥å…·
public class FontManager
{
    public static string GetFontName(FontTTF fontType)
    {
        switch (fontType)
        {
            case FontTTF.å®‹ä½“:
                return "SimSun";
            case FontTTF.ä»¿å®‹:
                return "FangSong";
            case FontTTF.ä»¿å®‹GB2312:
                return "FangSong_GB2312";
            case FontTTF.Arial:
                return "Arial";
            case FontTTF.Romans:
                return "romans.shx";
            default:
                return "Arial";
        }
    }

    public static void CreateTextWithFont(Point3d position, string text, FontTTF fontType, double height = 2.5)
    {
        using (var tr = new DBTrans())
        {
            // è·å–æˆ–åˆ›å»ºæ–‡å­—æ ·å¼
            var textStyleName = $"Style_{fontType}";
            var textStyleId = GetOrCreateTextStyle(tr, textStyleName, fontType);

            // åˆ›å»ºæ–‡å­—å¯¹è±¡
            var dbText = new DBText
            {
                Position = position,
                TextString = text,
                Height = height,
                TextStyleId = textStyleId
            };

            tr.CurrentSpace.AddEntity(dbText);
            tr.Commit();
        }
    }

    private static ObjectId GetOrCreateTextStyle(DBTrans tr, string styleName, FontTTF fontType)
    {
        var textStyleTable = tr.TextStyleTable;

        // æ£€æŸ¥æ ·å¼æ˜¯å¦å·²å­˜åœ¨
        if (textStyleTable.Has(styleName))
        {
            return textStyleTable[styleName];
        }

        // åˆ›å»ºæ–°çš„æ–‡å­—æ ·å¼
        var textStyleRecord = new TextStyleTableRecord
        {
            Name = styleName,
            FileName = GetFontName(fontType),
            TextSize = 0.0, // 0è¡¨ç¤ºå¯å˜é«˜åº¦
            XScale = 1.0,
            ObliquingAngle = 0.0
        };

        // è®¾ç½®å­—ä½“æ–‡ä»¶
        if (fontType == FontTTF.Romans)
        {
            textStyleRecord.FileName = "romans.shx";
            textStyleRecord.BigFontFileName = "";
        }
        else
        {
            textStyleRecord.FileName = "txt.shx";
            textStyleRecord.BigFontFileName = GetFontName(fontType) + ".ttf";
        }

        textStyleTable.UpgradeOpen();
        var styleId = textStyleTable.Add(textStyleRecord);
        tr.AddNewlyCreatedDBObject(textStyleRecord, true);

        return styleId;
    }
}

// ä½¿ç”¨ç¤ºä¾‹
[CommandMethod("CREATETEXT")]
public void CreateTextCommand()
{
    var editor = Application.DocumentManager.MdiActiveDocument.Editor;

    // è·å–æ’å…¥ç‚¹
    var pointResult = editor.GetPoint("\næŒ‡å®šæ–‡å­—æ’å…¥ç‚¹:");
    if (pointResult.Status != PromptStatus.OK) return;

    // è·å–æ–‡å­—å†…å®¹
    var textResult = editor.GetString("\nè¾“å…¥æ–‡å­—å†…å®¹:");
    if (textResult.Status != PromptStatus.OK) return;

    // åˆ›å»ºä¸åŒå­—ä½“çš„æ–‡å­—
    var fonts = new[] { FontTTF.å®‹ä½“, FontTTF.Arial, FontTTF.Romans };
    var basePoint = pointResult.Value;

    for (int i = 0; i < fonts.Length; i++)
    {
        var position = new Point3d(basePoint.X, basePoint.Y - i * 5, basePoint.Z);
        FontManager.CreateTextWithFont(position, $"{textResult.StringResult} ({fonts[i]})", fonts[i]);
    }

    editor.WriteMessage($"\nå·²åˆ›å»º {fonts.Length} ç§å­—ä½“çš„æ–‡å­—ã€‚");
}
```

**å®é™…åº”ç”¨åœºæ™¯ï¼š**

**UIç•Œé¢å®šåˆ¶ï¼š**
```csharp
// AutoCADç•Œé¢å®šåˆ¶ç®¡ç†å™¨
public class UICustomizationManager
{
    public static void CreateCustomPalette(PaneMarginType marginType)
    {
        var paletteSet = new PaletteSet("å·¥ç¨‹å·¥å…·ç®±")
        {
            Style = PaletteSetStyles.ShowAutoHideButton |
                   PaletteSetStyles.ShowCloseButton |
                   PaletteSetStyles.Snappable,
            MinimumSize = GetMinimumSize(marginType),
            DockEnabled = DockSides.Left | DockSides.Right
        };

        // æ ¹æ®è¾¹è·ç±»å‹è°ƒæ•´å¸ƒå±€
        var userControl = CreateToolboxControl(marginType);
        paletteSet.Add("å·¥å…·", userControl);

        paletteSet.Visible = true;
    }

    private static Size GetMinimumSize(PaneMarginType marginType)
    {
        switch (marginType)
        {
            case PaneMarginType.NONE:
                return new Size(180, 250);
            case PaneMarginType.SMALL:
                return new Size(200, 280);
            case PaneMarginType.LARGE:
                return new Size(250, 320);
            default:
                return new Size(200, 280);
        }
    }

    private static UserControl CreateToolboxControl(PaneMarginType marginType)
    {
        var control = new UserControl();

        // æ ¹æ®è¾¹è·ç±»å‹è®¾ç½®æ§ä»¶é—´è·
        var margin = GetControlMargin(marginType);
        control.Padding = new Padding(margin);

        // æ·»åŠ å·¥å…·æŒ‰é’®
        AddToolButtons(control, margin);

        return control;
    }

    private static int GetControlMargin(PaneMarginType marginType)
    {
        switch (marginType)
        {
            case PaneMarginType.NONE: return 2;
            case PaneMarginType.SMALL: return 5;
            case PaneMarginType.LARGE: return 10;
            default: return 5;
        }
    }
}
```

**äº¤äº’å¼å‘½ä»¤å¤„ç†ï¼š**
```csharp
// äº¤äº’å¼å‘½ä»¤å¤„ç†å™¨
public class InteractiveCommandProcessor
{
    public static void ProcessInteractiveCommand(SingleKeyWordWorkType workType)
    {
        var editor = Application.DocumentManager.MdiActiveDocument.Editor;

        while (true)
        {
            var options = new PromptKeywordOptions("\né€‰æ‹©æ“ä½œ [ç»˜åˆ¶(D)/ç¼–è¾‘(E)/é€€å‡º(X)]:")
            {
                AllowNone = true
            };
            options.Keywords.Add("D");
            options.Keywords.Add("E");
            options.Keywords.Add("X");

            var result = editor.GetKeywords(options);

            if (result.Status == PromptStatus.Cancel ||
                (result.Status == PromptStatus.OK && result.StringResult.ToUpper() == "X"))
            {
                SingleKeywordHandler.HandleKeywordInput("ESC", SingleKeyWordWorkType.ESCAPE);
                break;
            }

            if (result.Status == PromptStatus.OK)
            {
                switch (result.StringResult.ToUpper())
                {
                    case "D":
                        ProcessDrawCommand(workType);
                        break;
                    case "E":
                        ProcessEditCommand(workType);
                        break;
                }
            }
            else if (result.Status == PromptStatus.None)
            {
                // å¤„ç†ç©ºè¾“å…¥ï¼ˆEnteré”®ï¼‰
                SingleKeywordHandler.HandleKeywordInput("", SingleKeyWordWorkType.ENTER);
                continue;
            }
        }
    }

    private static void ProcessDrawCommand(SingleKeyWordWorkType workType)
    {
        SingleKeywordHandler.HandleKeywordInput("å¼€å§‹ç»˜åˆ¶æ“ä½œ", SingleKeyWordWorkType.WRITE_LINE);
        // æ‰§è¡Œç»˜åˆ¶é€»è¾‘
    }

    private static void ProcessEditCommand(SingleKeyWordWorkType workType)
    {
        SingleKeywordHandler.HandleKeywordInput("å¼€å§‹ç¼–è¾‘æ“ä½œ", SingleKeyWordWorkType.WRITE_LINE);
        // æ‰§è¡Œç¼–è¾‘é€»è¾‘
    }
}
```

### å¸¸é‡å’Œé…ç½®é¡¹

#### QuadTreeEvn å››å‰æ ‘ç¯å¢ƒå˜é‡

å››å‰æ ‘çš„å…¨å±€é…ç½®å‚æ•°ï¼Œç”¨äºæ§åˆ¶å››å‰æ ‘çš„æ€§èƒ½å’Œè¡Œä¸ºã€‚

```csharp
public static class QuadTreeEvn
{
    /// <summary>
    /// æœ€å°çš„èŠ‚ç‚¹é¢ç§¯ï¼ˆä¸€å®šè¦å¤§äº0ï¼‰
    /// å½“èŠ‚ç‚¹é¢ç§¯å°äºæ­¤å€¼æ—¶ï¼Œä¸å†è¿›è¡Œåˆ†è£‚
    /// é»˜è®¤å€¼ï¼š1.0
    /// </summary>
    public static double MinArea { get; set; } = 1.0;

    /// <summary>
    /// é€‰æ‹©æ¨¡å¼
    /// é»˜è®¤çš„å››å‰æ ‘æŸ¥è¯¢é€‰æ‹©æ¨¡å¼
    /// é»˜è®¤å€¼ï¼šQuadTreeSelectMode.IntersectsWith
    /// </summary>
    public static QuadTreeSelectMode SelectMode { get; set; } = QuadTreeSelectMode.IntersectsWith;

    /// <summary>
    /// å››å‰æ ‘æœ€å¤§æ·±åº¦
    /// é™åˆ¶å››å‰æ ‘çš„æœ€å¤§å±‚çº§ï¼Œé˜²æ­¢è¿‡åº¦åˆ†è£‚
    /// é»˜è®¤å€¼ï¼š10
    /// </summary>
    public static int QuadTreeMaximumDepth { get; set; } = 10;

    /// <summary>
    /// èŠ‚ç‚¹å†…å®¹è¶…è¿‡æ­¤æ•°é‡å°±åˆ†è£‚
    /// å½“èŠ‚ç‚¹åŒ…å«çš„å¯¹è±¡æ•°é‡è¶…è¿‡æ­¤å€¼æ—¶ï¼Œè§¦å‘èŠ‚ç‚¹åˆ†è£‚
    /// é»˜è®¤å€¼ï¼š10
    /// </summary>
    public static int QuadTreeContentsCountSplit { get; set; } = 10;
}
```

**é…ç½®è¯´æ˜ï¼š**

**MinAreaï¼ˆæœ€å°èŠ‚ç‚¹é¢ç§¯ï¼‰ï¼š**
- **ä½œç”¨**ï¼šæ§åˆ¶å››å‰æ ‘èŠ‚ç‚¹çš„æœ€å°å°ºå¯¸
- **å½±å“**ï¼šå€¼è¶Šå°ï¼Œå››å‰æ ‘åˆ†è£‚è¶Šç»†è‡´ï¼ŒæŸ¥è¯¢ç²¾åº¦è¶Šé«˜ï¼Œä½†å†…å­˜æ¶ˆè€—å¢åŠ 
- **å»ºè®®**ï¼šæ ¹æ®å®ä½“çš„å¹³å‡å°ºå¯¸è®¾ç½®ï¼Œé€šå¸¸ä¸ºå®ä½“æœ€å°å°ºå¯¸çš„1/4

**SelectModeï¼ˆé€‰æ‹©æ¨¡å¼ï¼‰ï¼š**
- **ä½œç”¨**ï¼šè®¾ç½®é»˜è®¤çš„æŸ¥è¯¢æ¨¡å¼
- **é€‰é¡¹**ï¼š
  - `IntersectsWith`ï¼šç›¸äº¤å³é€‰ä¸­ï¼ˆé€‚åˆå¿«é€ŸæŸ¥è¯¢ï¼‰
  - `Contains`ï¼šå®Œå…¨åŒ…å«æ‰é€‰ä¸­ï¼ˆé€‚åˆç²¾ç¡®æŸ¥è¯¢ï¼‰

**QuadTreeMaximumDepthï¼ˆæœ€å¤§æ·±åº¦ï¼‰ï¼š**
- **ä½œç”¨**ï¼šé™åˆ¶å››å‰æ ‘çš„å±‚çº§æ·±åº¦
- **å½±å“**ï¼šæ·±åº¦è¶Šå¤§ï¼Œåˆ†è£‚è¶Šç»†è‡´ï¼Œä½†æ„å»ºæ—¶é—´å¢åŠ 
- **å»ºè®®**ï¼šä¸€èˆ¬è®¾ç½®ä¸º8-15å±‚ï¼Œæ ¹æ®æ•°æ®å¯†åº¦è°ƒæ•´

**QuadTreeContentsCountSplitï¼ˆåˆ†è£‚é˜ˆå€¼ï¼‰ï¼š**
- **ä½œç”¨**ï¼šæ§åˆ¶èŠ‚ç‚¹åˆ†è£‚çš„è§¦å‘æ¡ä»¶
- **å½±å“**ï¼šå€¼è¶Šå°ï¼Œåˆ†è£‚è¶Šé¢‘ç¹ï¼ŒæŸ¥è¯¢é€Ÿåº¦è¶Šå¿«ï¼Œä½†å†…å­˜æ¶ˆè€—å¢åŠ 
- **å»ºè®®**ï¼šæ ¹æ®å®ä½“æ•°é‡å’ŒæŸ¥è¯¢é¢‘ç‡è®¾ç½®ï¼Œé€šå¸¸ä¸º5-20

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

**åŸºæœ¬é…ç½®ï¼š**
```csharp
// é…ç½®å››å‰æ ‘ç¯å¢ƒå˜é‡
public static void ConfigureQuadTree()
{
    // è®¾ç½®æœ€å°èŠ‚ç‚¹é¢ç§¯ï¼ˆé€‚åˆå°å°ºå¯¸å®ä½“ï¼‰
    QuadTreeEvn.MinArea = 0.5;

    // è®¾ç½®é»˜è®¤é€‰æ‹©æ¨¡å¼ä¸ºç›¸äº¤é€‰æ‹©
    QuadTreeEvn.SelectMode = QuadTreeSelectMode.IntersectsWith;

    // è®¾ç½®æœ€å¤§æ·±åº¦ä¸º12å±‚
    QuadTreeEvn.QuadTreeMaximumDepth = 12;

    // è®¾ç½®åˆ†è£‚é˜ˆå€¼ä¸º15ä¸ªå¯¹è±¡
    QuadTreeEvn.QuadTreeContentsCountSplit = 15;

    Console.WriteLine("å››å‰æ ‘ç¯å¢ƒå˜é‡é…ç½®å®Œæˆ");
    Console.WriteLine($"æœ€å°é¢ç§¯: {QuadTreeEvn.MinArea}");
    Console.WriteLine($"é€‰æ‹©æ¨¡å¼: {QuadTreeEvn.SelectMode}");
    Console.WriteLine($"æœ€å¤§æ·±åº¦: {QuadTreeEvn.QuadTreeMaximumDepth}");
    Console.WriteLine($"åˆ†è£‚é˜ˆå€¼: {QuadTreeEvn.QuadTreeContentsCountSplit}");
}
```

**æ€§èƒ½ä¼˜åŒ–é…ç½®ï¼š**
```csharp
// æ ¹æ®ä¸åŒåœºæ™¯ä¼˜åŒ–å››å‰æ ‘é…ç½®
public class QuadTreeOptimizer
{
    // é«˜ç²¾åº¦é…ç½®ï¼ˆé€‚åˆç²¾å¯†ç»˜å›¾ï¼‰
    public static void ConfigureForHighPrecision()
    {
        QuadTreeEvn.MinArea = 0.1;              // æ›´å°çš„æœ€å°é¢ç§¯
        QuadTreeEvn.QuadTreeMaximumDepth = 15;   // æ›´æ·±çš„å±‚çº§
        QuadTreeEvn.QuadTreeContentsCountSplit = 5; // æ›´å°çš„åˆ†è£‚é˜ˆå€¼
        QuadTreeEvn.SelectMode = QuadTreeSelectMode.Contains; // ç²¾ç¡®é€‰æ‹©

        Console.WriteLine("å·²é…ç½®ä¸ºé«˜ç²¾åº¦æ¨¡å¼");
    }

    // é«˜æ€§èƒ½é…ç½®ï¼ˆé€‚åˆå¤§é‡å®ä½“ï¼‰
    public static void ConfigureForHighPerformance()
    {
        QuadTreeEvn.MinArea = 2.0;              // è¾ƒå¤§çš„æœ€å°é¢ç§¯
        QuadTreeEvn.QuadTreeMaximumDepth = 8;    // è¾ƒæµ…çš„å±‚çº§
        QuadTreeEvn.QuadTreeContentsCountSplit = 20; // è¾ƒå¤§çš„åˆ†è£‚é˜ˆå€¼
        QuadTreeEvn.SelectMode = QuadTreeSelectMode.IntersectsWith; // å¿«é€Ÿé€‰æ‹©

        Console.WriteLine("å·²é…ç½®ä¸ºé«˜æ€§èƒ½æ¨¡å¼");
    }

    // å¹³è¡¡é…ç½®ï¼ˆé»˜è®¤æ¨èï¼‰
    public static void ConfigureForBalance()
    {
        QuadTreeEvn.MinArea = 1.0;              // å¹³è¡¡çš„æœ€å°é¢ç§¯
        QuadTreeEvn.QuadTreeMaximumDepth = 10;   // å¹³è¡¡çš„å±‚çº§
        QuadTreeEvn.QuadTreeContentsCountSplit = 10; // å¹³è¡¡çš„åˆ†è£‚é˜ˆå€¼
        QuadTreeEvn.SelectMode = QuadTreeSelectMode.IntersectsWith; // é€šç”¨é€‰æ‹©

        Console.WriteLine("å·²é…ç½®ä¸ºå¹³è¡¡æ¨¡å¼");
    }

    // æ ¹æ®å®ä½“æ•°é‡è‡ªåŠ¨é…ç½®
    public static void AutoConfigure(int entityCount)
    {
        if (entityCount < 1000)
        {
            ConfigureForHighPrecision();
        }
        else if (entityCount > 10000)
        {
            ConfigureForHighPerformance();
        }
        else
        {
            ConfigureForBalance();
        }

        Console.WriteLine($"æ ¹æ®å®ä½“æ•°é‡ {entityCount} è‡ªåŠ¨é…ç½®å®Œæˆ");
    }
}
```

**åŠ¨æ€é…ç½®ç®¡ç†ï¼š**
```csharp
// å››å‰æ ‘é…ç½®ç®¡ç†å™¨
public class QuadTreeConfigManager
{
    private static readonly Dictionary<string, QuadTreeConfig> Profiles =
        new Dictionary<string, QuadTreeConfig>();

    public struct QuadTreeConfig
    {
        public double MinArea;
        public QuadTreeSelectMode SelectMode;
        public int MaxDepth;
        public int SplitCount;

        public QuadTreeConfig(double minArea, QuadTreeSelectMode selectMode,
                             int maxDepth, int splitCount)
        {
            MinArea = minArea;
            SelectMode = selectMode;
            MaxDepth = maxDepth;
            SplitCount = splitCount;
        }
    }

    static QuadTreeConfigManager()
    {
        // é¢„å®šä¹‰é…ç½®æ–‡ä»¶
        Profiles["Default"] = new QuadTreeConfig(1.0, QuadTreeSelectMode.IntersectsWith, 10, 10);
        Profiles["HighPrecision"] = new QuadTreeConfig(0.1, QuadTreeSelectMode.Contains, 15, 5);
        Profiles["HighPerformance"] = new QuadTreeConfig(2.0, QuadTreeSelectMode.IntersectsWith, 8, 20);
        Profiles["LargeScale"] = new QuadTreeConfig(5.0, QuadTreeSelectMode.IntersectsWith, 6, 50);
        Profiles["SmallScale"] = new QuadTreeConfig(0.05, QuadTreeSelectMode.Contains, 20, 3);
    }

    public static void ApplyProfile(string profileName)
    {
        if (Profiles.TryGetValue(profileName, out var config))
        {
            QuadTreeEvn.MinArea = config.MinArea;
            QuadTreeEvn.SelectMode = config.SelectMode;
            QuadTreeEvn.QuadTreeMaximumDepth = config.MaxDepth;
            QuadTreeEvn.QuadTreeContentsCountSplit = config.SplitCount;

            Console.WriteLine($"å·²åº”ç”¨é…ç½®æ–‡ä»¶: {profileName}");
            LogCurrentConfig();
        }
        else
        {
            Console.WriteLine($"é…ç½®æ–‡ä»¶ {profileName} ä¸å­˜åœ¨");
        }
    }

    public static void SaveCurrentAsProfile(string profileName)
    {
        var config = new QuadTreeConfig(
            QuadTreeEvn.MinArea,
            QuadTreeEvn.SelectMode,
            QuadTreeEvn.QuadTreeMaximumDepth,
            QuadTreeEvn.QuadTreeContentsCountSplit
        );

        Profiles[profileName] = config;
        Console.WriteLine($"å½“å‰é…ç½®å·²ä¿å­˜ä¸º: {profileName}");
    }

    public static void ListProfiles()
    {
        Console.WriteLine("å¯ç”¨çš„é…ç½®æ–‡ä»¶:");
        foreach (var profile in Profiles)
        {
            var config = profile.Value;
            Console.WriteLine($"  {profile.Key}: MinArea={config.MinArea}, " +
                            $"Mode={config.SelectMode}, Depth={config.MaxDepth}, " +
                            $"Split={config.SplitCount}");
        }
    }

    private static void LogCurrentConfig()
    {
        Console.WriteLine("å½“å‰å››å‰æ ‘é…ç½®:");
        Console.WriteLine($"  æœ€å°é¢ç§¯: {QuadTreeEvn.MinArea}");
        Console.WriteLine($"  é€‰æ‹©æ¨¡å¼: {QuadTreeEvn.SelectMode}");
        Console.WriteLine($"  æœ€å¤§æ·±åº¦: {QuadTreeEvn.QuadTreeMaximumDepth}");
        Console.WriteLine($"  åˆ†è£‚é˜ˆå€¼: {QuadTreeEvn.QuadTreeContentsCountSplit}");
    }
}

// ä½¿ç”¨ç¤ºä¾‹
[CommandMethod("QTCONFIG")]
public void QuadTreeConfigCommand()
{
    var editor = Application.DocumentManager.MdiActiveDocument.Editor;

    // åˆ—å‡ºå¯ç”¨é…ç½®
    QuadTreeConfigManager.ListProfiles();

    // è·å–ç”¨æˆ·é€‰æ‹©
    var options = new PromptKeywordOptions("\né€‰æ‹©é…ç½®æ–‡ä»¶ [é»˜è®¤(D)/é«˜ç²¾åº¦(H)/é«˜æ€§èƒ½(P)/å¤§æ¯”ä¾‹(L)/å°æ¯”ä¾‹(S)]:")
    {
        AllowNone = false
    };
    options.Keywords.Add("D");
    options.Keywords.Add("H");
    options.Keywords.Add("P");
    options.Keywords.Add("L");
    options.Keywords.Add("S");

    var result = editor.GetKeywords(options);
    if (result.Status == PromptStatus.OK)
    {
        switch (result.StringResult.ToUpper())
        {
            case "D":
                QuadTreeConfigManager.ApplyProfile("Default");
                break;
            case "H":
                QuadTreeConfigManager.ApplyProfile("HighPrecision");
                break;
            case "P":
                QuadTreeConfigManager.ApplyProfile("HighPerformance");
                break;
            case "L":
                QuadTreeConfigManager.ApplyProfile("LargeScale");
                break;
            case "S":
                QuadTreeConfigManager.ApplyProfile("SmallScale");
                break;
        }
    }
}
```

**é…ç½®æœ€ä½³å®è·µï¼š**

1. **æ ¹æ®å›¾å½¢è§„æ¨¡é€‰æ‹©é…ç½®**ï¼š
   - å°å›¾å½¢ï¼ˆ<1000å®ä½“ï¼‰ï¼šä½¿ç”¨é«˜ç²¾åº¦é…ç½®
   - ä¸­ç­‰å›¾å½¢ï¼ˆ1000-10000å®ä½“ï¼‰ï¼šä½¿ç”¨å¹³è¡¡é…ç½®
   - å¤§å›¾å½¢ï¼ˆ>10000å®ä½“ï¼‰ï¼šä½¿ç”¨é«˜æ€§èƒ½é…ç½®

2. **æ ¹æ®æ“ä½œç±»å‹è°ƒæ•´**ï¼š
   - ç²¾ç¡®é€‰æ‹©æ“ä½œï¼šä½¿ç”¨Containsæ¨¡å¼
   - å¿«é€ŸæŸ¥è¯¢æ“ä½œï¼šä½¿ç”¨IntersectsWithæ¨¡å¼

3. **å†…å­˜å’Œæ€§èƒ½æƒè¡¡**ï¼š
   - å†…å­˜å……è¶³ï¼šå¯ä»¥é™ä½MinAreaå’ŒSplitCount
   - å†…å­˜ç´§å¼ ï¼šé€‚å½“å¢åŠ MinAreaå’ŒSplitCount

4. **åŠ¨æ€è°ƒæ•´**ï¼š
   - åœ¨ç¨‹åºå¯åŠ¨æ—¶æ ¹æ®ç¡¬ä»¶é…ç½®è‡ªåŠ¨é€‰æ‹©
   - åœ¨å¤„ç†ä¸åŒç±»å‹å›¾å½¢æ—¶åŠ¨æ€åˆ‡æ¢é…ç½®

## API å‚è€ƒæ‰‹å†Œ

### IFoxCAD.Cad å‘½åç©ºé—´

#### æ ¸å¿ƒç±» (Core Classes)

**äº‹åŠ¡å’Œæ•°æ®åº“ç®¡ç†**
- [`DBTrans`](#äº‹åŠ¡ç®¡ç†-dbtrans) - äº‹åŠ¡æ ˆç®¡ç†ï¼Œç®€åŒ–æ•°æ®åº“æ“ä½œ
- [`DatabaseEx`](#æ•°æ®åº“æ‰©å±•-databaseex) - æ•°æ®åº“æ‰©å±•æ–¹æ³•
- [`SwitchDatabase`](#æ•°æ®åº“åˆ‡æ¢-switchdatabase) - è‡ªåŠ¨åˆ‡æ¢æ´»åŠ¨æ•°æ®åº“
- [`DocumentLockManager`](#æ–‡æ¡£é”ç®¡ç†å™¨-documentlockmanager) - æ–‡æ¡£é”ç®¡ç†å™¨
- [`DocumentLockManagerExtension`](#æ–‡æ¡£é”ç®¡ç†å™¨-documentlockmanager) - æ–‡æ¡£é”ç®¡ç†æ‰©å±•

**å®ä½“æ“ä½œç±»**
- [`EntityEx`](#å®ä½“æ“ä½œ-entityex) - å®ä½“æ‰©å±•æ–¹æ³•ï¼ˆç§»åŠ¨ã€æ—‹è½¬ã€ç¼©æ”¾ã€é•œåƒï¼‰
- [`ArcEx`](#å®ä½“æ“ä½œ-entityex) - åœ†å¼§æ‰©å±•æ–¹æ³•
- [`CircleEx`](#å®ä½“æ“ä½œ-entityex) - åœ†æ‰©å±•æ–¹æ³•
- [`PolylineEx`](#å®ä½“æ“ä½œ-entityex) - å¤šæ®µçº¿æ‰©å±•æ–¹æ³•
- [`HatchEx`](#å¡«å……æ‰©å±•-hatchex) - å¡«å……æ‰©å±•æ–¹æ³•
- [`RegionEx`](#å®ä½“æ“ä½œ-entityex) - é¢åŸŸæ‰©å±•æ–¹æ³•

**ç¼–è¾‘å™¨å’Œç”¨æˆ·äº¤äº’**
- [`EditorEx`](#ç¼–è¾‘å™¨æ‰©å±•-editorex) - ç¼–è¾‘å™¨æ‰©å±•æ–¹æ³•ï¼ˆé€‰æ‹©ã€è¾“å…¥ã€è§†å›¾æ§åˆ¶ï¼‰
- [`SelectionSetEx`](#é€‰æ‹©é›†æ‰©å±•-selectionsetex) - é€‰æ‹©é›†æ‰©å±•æ–¹æ³•
- [`JigEx`](#å¤¹ç‚¹æ“ä½œ-jigex) - å¤¹ç‚¹æ“ä½œæ‰©å±•

**ç©ºé—´æ•°æ®ç»“æ„**
- [`QuadTree<T>`](#å››å‰æ ‘-quadtree) - å››å‰æ ‘ç©ºé—´ç´¢å¼•
- [`QuadTreeNode<T>`](#å››å‰æ ‘-quadtree) - å››å‰æ ‘èŠ‚ç‚¹
- [`QuadEntity`](#å››å‰æ ‘-quadtree) - å››å‰æ ‘å›¾å…ƒ

**æ–‡ä»¶å’Œæ ‡è®°ç®¡ç†**
- [`DwgMark`](#dwgæ–‡ä»¶æ ‡è®°ç®¡ç†-dwgmark) - DWGæ–‡ä»¶æ ‡è®°ç®¡ç†
- [`PeInfo`](#peæ–‡ä»¶ä¿¡æ¯åˆ†æç³»ç»Ÿ) - PEæ–‡ä»¶ä¿¡æ¯åˆ†æ
- [`AcadPeInfo`](#peæ–‡ä»¶ä¿¡æ¯åˆ†æç³»ç»Ÿ) - AutoCADä¸“ç”¨PEä¿¡æ¯

**å…³è”åŠŸèƒ½**
- [`AssocPersSubentityIdPEEx`](#å…³è”å­å®ä½“æ‰©å±•-assocperssubentityidpeex) - å…³è”å­å®ä½“æ‰©å±•
- [`AssocUtils`](#å…³è”åŠ¨ä½œå·¥å…·-assocutils) - å…³è”åŠ¨ä½œå·¥å…·

**é”™è¯¯å¤„ç†**
- [`ErrorInfoEx`](#cadé”™è¯¯ä¿¡æ¯å¤„ç†-errorinfoex) - CADé”™è¯¯ä¿¡æ¯å¤„ç†
- [`GetPeMethodException`](#peæ–¹æ³•ä¸“ç”¨å¼‚å¸¸ç±») - PEæ–¹æ³•ä¸“ç”¨å¼‚å¸¸

#### æšä¸¾ç±»å‹ (Enumerations)

**æ“ä½œæ¨¡å¼æšä¸¾**
- [`QuadTreeSelectMode`](#quadtreeselectmode-å››å‰æ ‘é€‰æ‹©æ¨¡å¼) - å››å‰æ ‘é€‰æ‹©æ¨¡å¼
- [`QuadTreeFindMode`](#quadtreefindmode-å››å‰æ ‘æŸ¥æ‰¾æ–¹å‘) - å››å‰æ ‘æŸ¥æ‰¾æ–¹å‘
- [`RunLispFlag`](#runlispflag-lispæ‰§è¡Œæ–¹å¼) - Lispæ‰§è¡Œæ–¹å¼
- [`XrefModes`](#xrefmodes-å¤–éƒ¨å‚ç…§æ¨¡å¼) - å¤–éƒ¨å‚ç…§æ¨¡å¼

**ç³»ç»Ÿé…ç½®æšä¸¾**
- [`SymModes`](#symmodes-ç¬¦å·è¡¨æ¨¡å¼) - ç¬¦å·è¡¨æ¨¡å¼
- [`CoordinateSystemCode`](#coordinatesystemcode-åæ ‡ç³»ç±»å‹) - åæ ‡ç³»ç±»å‹
- [`AssemLoadType`](#assemloadtype-ç¨‹åºé›†åŠ è½½ç±»å‹) - ç¨‹åºé›†åŠ è½½ç±»å‹

**é”™è¯¯å’ŒçŠ¶æ€æšä¸¾**
- [`GetMethodErrorNum`](#getmethoderrornum-peæ–¹æ³•é”™è¯¯ç¼–å·) - PEæ–¹æ³•é”™è¯¯ç¼–å·
- [`DBmod`](#dbmod-æ•°æ®åº“ä¿®æ”¹çŠ¶æ€) - æ•°æ®åº“ä¿®æ”¹çŠ¶æ€
- [`AcadPeEnum`](#acadpeenum-peæ–‡ä»¶é€‰æ‹©æ¨¡å¼) - PEæ–‡ä»¶é€‰æ‹©æ¨¡å¼

**UIå’Œäº¤äº’æšä¸¾**
- [`PaneMarginType`](#panemargintype-æ‰˜ç›˜è¾¹è·ç±»å‹) - æ‰˜ç›˜è¾¹è·ç±»å‹
- [`SingleKeyWordWorkType`](#singlekeywordworktype-å•å…³é”®å­—å·¥ä½œæ¨¡å¼) - å•å…³é”®å­—å·¥ä½œæ¨¡å¼
- [`FontTTF`](#fontttf-å­—ä½“ç±»å‹æšä¸¾) - å­—ä½“ç±»å‹æšä¸¾

#### é…ç½®ç±» (Configuration)

- [`QuadTreeEvn`](#quadtreeevn-å››å‰æ ‘ç¯å¢ƒå˜é‡) - å››å‰æ ‘ç¯å¢ƒå˜é‡é…ç½®

### IFoxCAD.Basal å‘½åç©ºé—´

#### é›†åˆå’Œæ•°æ®ç»“æ„æ‰©å±•

**æ•°ç»„å’ŒLINQæ‰©å±•**
- [`ArrayEx`](#arrayex-æ•°ç»„æ‰©å±•ç±») - æ•°ç»„æ“ä½œæ‰©å±•ï¼ˆåˆå¹¶ã€å»é‡ï¼‰
- [`LinqEx`](#linqex-linqæ‰©å±•ç±») - LINQæ‰©å±•ï¼ˆæŸ¥æ‰¾æœ€å€¼ã€æ’åºï¼‰

**ç¯å½¢æ•°æ®ç»“æ„**
- [`LoopList<T>`](#looplist-ç¯é“¾è¡¨ç±») - ç¯å½¢åŒå‘é“¾è¡¨
- [`LoopListNode<T>`](#looplist-ç¯é“¾è¡¨ç±») - ç¯é“¾è¡¨èŠ‚ç‚¹

#### ç³»ç»ŸAPIå°è£…

**Windows APIå°è£…**
- [`PInvokeUser32`](#pinvokeuser32-ç³»ç»Ÿapiå°è£…ç±») - User32.dll APIå°è£…
- [`WindowsAPI`](#windowsapi-ç³»ç»Ÿå·¥å…·ç±») - ç³»ç»Ÿå·¥å…·ç±»ï¼ˆå†…å­˜ç®¡ç†ã€æ•°æ®è½¬æ¢ï¼‰

#### å·¥å…·ç±»

**éšæœºæ•°å’Œç³»ç»Ÿæ‰©å±•**
- [`RandomEx`](#randomex-éšæœºæ•°æ‰©å±•ç±») - éšæœºæ•°ç”Ÿæˆæ‰©å±•
- [`SystemEx`](#systemex-ç³»ç»Ÿæ‰©å±•ç±») - ç³»ç»Ÿæ“ä½œæ‰©å±•

**è°ƒè¯•å’ŒéªŒè¯å·¥å…·**
- [`DebugEx`](#debugex-è°ƒè¯•å·¥å…·ç±») - è°ƒè¯•å·¥å…·ï¼ˆæ€§èƒ½æµ‹é‡ã€å†…å­˜ç›‘æ§ï¼‰
- [`EnumEx`](#enumex-æšä¸¾æ‰©å±•ç±») - æšä¸¾æ“ä½œæ‰©å±•
- [`ArgumentNullEx`](#argumentnullex-å‚æ•°éªŒè¯ç±») - å‚æ•°éªŒè¯å·¥å…·

### å¿«é€ŸæŸ¥æ‰¾ç´¢å¼•

#### æŒ‰åŠŸèƒ½åˆ†ç±»

**ğŸ—ï¸ åŸºç¡€è®¾æ–½**
- äº‹åŠ¡ç®¡ç†ï¼š[DBTrans](#äº‹åŠ¡ç®¡ç†-dbtrans)
- æ•°æ®åº“æ“ä½œï¼š[DatabaseEx](#æ•°æ®åº“æ‰©å±•-databaseex)
- æ–‡æ¡£é”å®šï¼š[DocumentLockManager](#æ–‡æ¡£é”ç®¡ç†å™¨-documentlockmanager)

**ğŸ“ å®ä½“æ“ä½œ**
- é€šç”¨å®ä½“ï¼š[EntityEx](#å®ä½“æ“ä½œ-entityex)
- åœ†å¼§æ“ä½œï¼š[ArcEx](#å®ä½“æ“ä½œ-entityex)
- åœ†å½¢æ“ä½œï¼š[CircleEx](#å®ä½“æ“ä½œ-entityex)
- å¤šæ®µçº¿ï¼š[PolylineEx](#å®ä½“æ“ä½œ-entityex)
- å¡«å……æ“ä½œï¼š[HatchEx](#å¡«å……æ‰©å±•-hatchex)

**ğŸ–±ï¸ ç”¨æˆ·äº¤äº’**
- ç¼–è¾‘å™¨æ‰©å±•ï¼š[EditorEx](#ç¼–è¾‘å™¨æ‰©å±•-editorex)
- é€‰æ‹©æ“ä½œï¼š[SelectionSetEx](#é€‰æ‹©é›†æ‰©å±•-selectionsetex)
- å¤¹ç‚¹æ“ä½œï¼š[JigEx](#å¤¹ç‚¹æ“ä½œ-jigex)

**ğŸ” ç©ºé—´æŸ¥è¯¢**
- å››å‰æ ‘ï¼š[QuadTree](#å››å‰æ ‘-quadtree)
- ç©ºé—´ç´¢å¼•ï¼š[QuadEntity](#å››å‰æ ‘-quadtree)

**ğŸ“ æ–‡ä»¶å¤„ç†**
- DWGæ ‡è®°ï¼š[DwgMark](#dwgæ–‡ä»¶æ ‡è®°ç®¡ç†-dwgmark)
- PEåˆ†æï¼š[PeInfo](#peæ–‡ä»¶ä¿¡æ¯åˆ†æç³»ç»Ÿ)

**ğŸ”— å…³è”åŠŸèƒ½**
- å­å®ä½“ï¼š[AssocPersSubentityIdPEEx](#å…³è”å­å®ä½“æ‰©å±•-assocperssubentityidpeex)
- å…³è”åŠ¨ä½œï¼š[AssocUtils](#å…³è”åŠ¨ä½œå·¥å…·-assocutils)

**âš ï¸ é”™è¯¯å¤„ç†**
- é”™è¯¯ä¿¡æ¯ï¼š[ErrorInfoEx](#cadé”™è¯¯ä¿¡æ¯å¤„ç†-errorinfoex)
- PEå¼‚å¸¸ï¼š[GetPeMethodException](#peæ–¹æ³•ä¸“ç”¨å¼‚å¸¸ç±»)

**ğŸ› ï¸ å·¥å…·ç±»**
- æ•°ç»„æ“ä½œï¼š[ArrayEx](#arrayex-æ•°ç»„æ‰©å±•ç±»)
- LINQæ‰©å±•ï¼š[LinqEx](#linqex-linqæ‰©å±•ç±»)
- ç¯é“¾è¡¨ï¼š[LoopList](#looplist-ç¯é“¾è¡¨ç±»)
- ç³»ç»ŸAPIï¼š[PInvokeUser32](#pinvokeuser32-ç³»ç»Ÿapiå°è£…ç±»)
- è°ƒè¯•å·¥å…·ï¼š[DebugEx](#debugex-è°ƒè¯•å·¥å…·ç±»)

#### æŒ‰å­—æ¯é¡ºåº

**A-C**
- [AcadPeInfo](#peæ–‡ä»¶ä¿¡æ¯åˆ†æç³»ç»Ÿ)
- [AcadPeEnum](#acadpeenum-peæ–‡ä»¶é€‰æ‹©æ¨¡å¼)
- [ArcEx](#å®ä½“æ“ä½œ-entityex)
- [ArgumentNullEx](#argumentnullex-å‚æ•°éªŒè¯ç±»)
- [ArrayEx](#arrayex-æ•°ç»„æ‰©å±•ç±»)
- [AssemLoadType](#assemloadtype-ç¨‹åºé›†åŠ è½½ç±»å‹)
- [AssocPersSubentityIdPEEx](#å…³è”å­å®ä½“æ‰©å±•-assocperssubentityidpeex)
- [AssocUtils](#å…³è”åŠ¨ä½œå·¥å…·-assocutils)
- [CircleEx](#å®ä½“æ“ä½œ-entityex)
- [CoordinateSystemCode](#coordinatesystemcode-åæ ‡ç³»ç±»å‹)

**D-H**
- [DatabaseEx](#æ•°æ®åº“æ‰©å±•-databaseex)
- [DBmod](#dbmod-æ•°æ®åº“ä¿®æ”¹çŠ¶æ€)
- [DBTrans](#äº‹åŠ¡ç®¡ç†-dbtrans)
- [DebugEx](#debugex-è°ƒè¯•å·¥å…·ç±»)
- [DocumentLockManager](#æ–‡æ¡£é”ç®¡ç†å™¨-documentlockmanager)
- [DwgMark](#dwgæ–‡ä»¶æ ‡è®°ç®¡ç†-dwgmark)
- [EditorEx](#ç¼–è¾‘å™¨æ‰©å±•-editorex)
- [EntityEx](#å®ä½“æ“ä½œ-entityex)
- [EnumEx](#enumex-æšä¸¾æ‰©å±•ç±»)
- [ErrorInfoEx](#cadé”™è¯¯ä¿¡æ¯å¤„ç†-errorinfoex)
- [FontTTF](#fontttf-å­—ä½“ç±»å‹æšä¸¾)
- [GetMethodErrorNum](#getmethoderrornum-peæ–¹æ³•é”™è¯¯ç¼–å·)
- [GetPeMethodException](#peæ–¹æ³•ä¸“ç”¨å¼‚å¸¸ç±»)
- [HatchEx](#å¡«å……æ‰©å±•-hatchex)

**J-P**
- [JigEx](#å¤¹ç‚¹æ“ä½œ-jigex)
- [LinqEx](#linqex-linqæ‰©å±•ç±»)
- [LoopList](#looplist-ç¯é“¾è¡¨ç±»)
- [PaneMarginType](#panemargintype-æ‰˜ç›˜è¾¹è·ç±»å‹)
- [PeInfo](#peæ–‡ä»¶ä¿¡æ¯åˆ†æç³»ç»Ÿ)
- [PInvokeUser32](#pinvokeuser32-ç³»ç»Ÿapiå°è£…ç±»)
- [PolylineEx](#å®ä½“æ“ä½œ-entityex)

**Q-Z**
- [QuadEntity](#å››å‰æ ‘-quadtree)
- [QuadTree](#å››å‰æ ‘-quadtree)
- [QuadTreeEvn](#quadtreeevn-å››å‰æ ‘ç¯å¢ƒå˜é‡)
- [QuadTreeFindMode](#quadtreefindmode-å››å‰æ ‘æŸ¥æ‰¾æ–¹å‘)
- [QuadTreeSelectMode](#quadtreeselectmode-å››å‰æ ‘é€‰æ‹©æ¨¡å¼)
- [RandomEx](#randomex-éšæœºæ•°æ‰©å±•ç±»)
- [RegionEx](#å®ä½“æ“ä½œ-entityex)
- [RunLispFlag](#runlispflag-lispæ‰§è¡Œæ–¹å¼)
- [SelectionSetEx](#é€‰æ‹©é›†æ‰©å±•-selectionsetex)
- [SingleKeyWordWorkType](#singlekeywordworktype-å•å…³é”®å­—å·¥ä½œæ¨¡å¼)
- [SwitchDatabase](#æ•°æ®åº“åˆ‡æ¢-switchdatabase)
- [SymModes](#symmodes-ç¬¦å·è¡¨æ¨¡å¼)
- [SystemEx](#systemex-ç³»ç»Ÿæ‰©å±•ç±»)
- [WindowsAPI](#windowsapi-ç³»ç»Ÿå·¥å…·ç±»)
- [XrefModes](#xrefmodes-å¤–éƒ¨å‚ç…§æ¨¡å¼)

## æœ€ä½³å®è·µ

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 1. äº‹åŠ¡ç®¡ç†ä¼˜åŒ–

**æ¨èåšæ³•ï¼š**
```csharp
// âœ… æ¨èï¼šä½¿ç”¨DBTransè¿›è¡Œæ‰¹é‡æ“ä½œ
using (var tr = new DBTrans())
{
    // æ‰¹é‡åˆ›å»ºå®ä½“
    for (int i = 0; i < 1000; i++)
    {
        var line = new Line(new Point3d(i, 0, 0), new Point3d(i, 100, 0));
        tr.CurrentSpace.AddEntity(line);
    }
    tr.Commit(); // ä¸€æ¬¡æ€§æäº¤æ‰€æœ‰æ“ä½œ
}
```

**é¿å…åšæ³•ï¼š**
```csharp
// âŒ é¿å…ï¼šé¢‘ç¹çš„äº‹åŠ¡å¼€å¯å’Œæäº¤
for (int i = 0; i < 1000; i++)
{
    using (var tr = new DBTrans()) // æ¯æ¬¡å¾ªç¯éƒ½åˆ›å»ºæ–°äº‹åŠ¡
    {
        var line = new Line(new Point3d(i, 0, 0), new Point3d(i, 100, 0));
        tr.CurrentSpace.AddEntity(line);
        tr.Commit(); // é¢‘ç¹æäº¤å½±å“æ€§èƒ½
    }
}
```

#### 2. å››å‰æ ‘é…ç½®ä¼˜åŒ–

**æ ¹æ®æ•°æ®è§„æ¨¡è°ƒæ•´é…ç½®ï¼š**
```csharp
// å¤§é‡å®ä½“åœºæ™¯ï¼ˆ>10000ä¸ªï¼‰
public static void ConfigureForLargeDataset()
{
    QuadTreeEvn.MinArea = 5.0;                    // è¾ƒå¤§çš„æœ€å°é¢ç§¯
    QuadTreeEvn.QuadTreeMaximumDepth = 8;         // è¾ƒæµ…çš„æ·±åº¦
    QuadTreeEvn.QuadTreeContentsCountSplit = 50;  // è¾ƒå¤§çš„åˆ†è£‚é˜ˆå€¼
}

// ç²¾å¯†æ“ä½œåœºæ™¯ï¼ˆ<1000ä¸ªï¼‰
public static void ConfigureForPrecision()
{
    QuadTreeEvn.MinArea = 0.1;                    // è¾ƒå°çš„æœ€å°é¢ç§¯
    QuadTreeEvn.QuadTreeMaximumDepth = 15;        // è¾ƒæ·±çš„æ·±åº¦
    QuadTreeEvn.QuadTreeContentsCountSplit = 5;   // è¾ƒå°çš„åˆ†è£‚é˜ˆå€¼
}
```

#### 3. å†…å­˜ç®¡ç†

**åŠæ—¶é‡Šæ”¾èµ„æºï¼š**
```csharp
// âœ… æ¨èï¼šä½¿ç”¨usingè¯­å¥è‡ªåŠ¨é‡Šæ”¾
using (var tr = new DBTrans())
{
    // æ“ä½œä»£ç 
    tr.Commit();
} // è‡ªåŠ¨é‡Šæ”¾èµ„æº

// âœ… æ¨èï¼šå¤§é‡æ•°æ®å¤„ç†æ—¶åˆ†æ‰¹å¤„ç†
public void ProcessLargeDataset(IEnumerable<ObjectId> entityIds)
{
    const int batchSize = 1000;
    var batches = entityIds.Batch(batchSize);

    foreach (var batch in batches)
    {
        using (var tr = new DBTrans())
        {
            foreach (var id in batch)
            {
                var entity = tr.GetObject<Entity>(id, OpenMode.ForWrite);
                // å¤„ç†å®ä½“
            }
            tr.Commit();
        }

        // å¼ºåˆ¶åƒåœ¾å›æ”¶ï¼ˆä»…åœ¨å¿…è¦æ—¶ï¼‰
        if (batches.Count() > 10)
        {
            GC.Collect();
            GC.WaitForPendingFinalizers();
        }
    }
}
```

### é”™è¯¯å¤„ç†ç­–ç•¥

#### 1. åˆ†å±‚é”™è¯¯å¤„ç†

```csharp
public class CadOperationService
{
    // ä¸šåŠ¡å±‚ï¼šå¤„ç†ä¸šåŠ¡é€»è¾‘é”™è¯¯
    public Result<List<Entity>> GetEntitiesInRegion(Rect region)
    {
        try
        {
            return ExecuteWithErrorHandling(() =>
            {
                using (var tr = new DBTrans())
                {
                    var entities = tr.CurrentSpace.GetEntities<Entity>();
                    var quadTree = new QuadTree<Entity>(region);

                    foreach (var entity in entities)
                    {
                        quadTree.Insert(entity);
                    }

                    var result = quadTree.Query(region, QuadTreeSelectMode.IntersectsWith);
                    tr.Commit();

                    return Result<List<Entity>>.Success(result);
                }
            });
        }
        catch (Exception ex)
        {
            return Result<List<Entity>>.Failure($"è·å–åŒºåŸŸå®ä½“å¤±è´¥: {ex.Message}");
        }
    }

    // åŸºç¡€è®¾æ–½å±‚ï¼šå¤„ç†æŠ€æœ¯é”™è¯¯
    private T ExecuteWithErrorHandling<T>(Func<T> operation)
    {
        try
        {
            return operation();
        }
        catch (AcException acEx)
        {
            ErrorInfoEx.AcErrorInfo(acEx);
            throw new CadOperationException("CADæ“ä½œå¤±è´¥", acEx);
        }
        catch (GetPeMethodException peEx)
        {
            LogPeError(peEx);
            throw new CadOperationException("PEæ–¹æ³•è°ƒç”¨å¤±è´¥", peEx);
        }
    }

    private void LogPeError(GetPeMethodException peEx)
    {
        var errorType = (GetMethodErrorNum)peEx.ErrorNum;
        switch (errorType)
        {
            case GetMethodErrorNum.NoModule:
                Console.WriteLine("æ¨¡å—æœªæ‰¾åˆ°");
                break;
            case GetMethodErrorNum.NoFuncName:
                Console.WriteLine("å‡½æ•°æœªæ‰¾åˆ°");
                break;
        }
    }
}

// ç»“æœåŒ…è£…ç±»
public class Result<T>
{
    public bool IsSuccess { get; private set; }
    public T Data { get; private set; }
    public string ErrorMessage { get; private set; }

    public static Result<T> Success(T data) => new Result<T> { IsSuccess = true, Data = data };
    public static Result<T> Failure(string error) => new Result<T> { IsSuccess = false, ErrorMessage = error };
}
```

#### 2. ç»Ÿä¸€å¼‚å¸¸å¤„ç†

```csharp
public class CadOperationException : Exception
{
    public CadOperationException(string message) : base(message) { }
    public CadOperationException(string message, Exception innerException) : base(message, innerException) { }
}

// å…¨å±€å¼‚å¸¸å¤„ç†å™¨
public static class GlobalExceptionHandler
{
    public static void HandleException(Exception ex, string context = "")
    {
        var message = $"[{context}] {ex.Message}";

        switch (ex)
        {
            case AcException acEx:
                ErrorInfoEx.AcErrorInfo(acEx);
                break;

            case GetPeMethodException peEx:
                EditorEx.WriteMessage($"PEé”™è¯¯ [{peEx.ErrorNum}]: {peEx.ErrorMsg}");
                break;

            case CadOperationException cadEx:
                EditorEx.WriteMessage($"CADæ“ä½œé”™è¯¯: {cadEx.Message}");
                break;

            default:
                EditorEx.WriteMessage($"æœªçŸ¥é”™è¯¯: {message}");
                break;
        }

        // è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶
        LogToFile(ex, context);
    }

    private static void LogToFile(Exception ex, string context)
    {
        var logPath = Path.Combine(Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
                                  "IFoxCAD", "Logs", $"error_{DateTime.Now:yyyyMMdd}.log");

        Directory.CreateDirectory(Path.GetDirectoryName(logPath));

        var logEntry = $"[{DateTime.Now:yyyy-MM-dd HH:mm:ss}] [{context}] {ex}\n";
        File.AppendAllText(logPath, logEntry);
    }
}
```

### ä»£ç ç»„ç»‡

#### 1. å‘½ä»¤ç±»ç»„ç»‡

```csharp
// æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡å‘½ä»¤
[CommandClass]
public class EntityCommands
{
    [CommandMethod("CREATELINE")]
    public void CreateLine()
    {
        try
        {
            var service = new EntityCreationService();
            service.CreateLine();
        }
        catch (Exception ex)
        {
            GlobalExceptionHandler.HandleException(ex, "CreateLine");
        }
    }

    [CommandMethod("MOVELINE")]
    public void MoveLine()
    {
        try
        {
            var service = new EntityModificationService();
            service.MoveSelectedEntities();
        }
        catch (Exception ex)
        {
            GlobalExceptionHandler.HandleException(ex, "MoveLine");
        }
    }
}

[CommandClass]
public class QueryCommands
{
    [CommandMethod("QUERYREGION")]
    public void QueryRegion()
    {
        try
        {
            var service = new SpatialQueryService();
            service.QueryEntitiesInRegion();
        }
        catch (Exception ex)
        {
            GlobalExceptionHandler.HandleException(ex, "QueryRegion");
        }
    }
}
```

#### 2. æœåŠ¡å±‚è®¾è®¡

```csharp
// å®ä½“åˆ›å»ºæœåŠ¡
public class EntityCreationService
{
    private readonly IUserInputService _inputService;
    private readonly IEntityRepository _entityRepository;

    public EntityCreationService()
    {
        _inputService = new UserInputService();
        _entityRepository = new EntityRepository();
    }

    public void CreateLine()
    {
        var startPoint = _inputService.GetPoint("æŒ‡å®šèµ·ç‚¹:");
        if (!startPoint.HasValue) return;

        var endPoint = _inputService.GetPoint("æŒ‡å®šç»ˆç‚¹:", startPoint.Value);
        if (!endPoint.HasValue) return;

        var line = new Line(startPoint.Value, endPoint.Value);
        _entityRepository.Add(line);

        EditorEx.WriteMessage($"ç›´çº¿åˆ›å»ºå®Œæˆï¼Œé•¿åº¦: {line.Length:F2}");
    }
}

// ç”¨æˆ·è¾“å…¥æœåŠ¡
public interface IUserInputService
{
    Point3d? GetPoint(string prompt, Point3d? basePoint = null);
    double? GetDistance(string prompt, double defaultValue = 1.0);
    string GetString(string prompt, string defaultValue = "");
}

public class UserInputService : IUserInputService
{
    private readonly Editor _editor;

    public UserInputService()
    {
        _editor = Application.DocumentManager.MdiActiveDocument.Editor;
    }

    public Point3d? GetPoint(string prompt, Point3d? basePoint = null)
    {
        var options = new PromptPointOptions(prompt);
        if (basePoint.HasValue)
        {
            options.BasePoint = basePoint.Value;
            options.UseBasePoint = true;
        }

        var result = _editor.GetPoint(options);
        return result.Status == PromptStatus.OK ? result.Value : (Point3d?)null;
    }

    public double? GetDistance(string prompt, double defaultValue = 1.0)
    {
        var result = EditorEx.GetDouble(_editor, prompt, defaultValue);
        return result.Status == PromptStatus.OK ? result.Value : (double?)null;
    }

    public string GetString(string prompt, string defaultValue = "")
    {
        var result = EditorEx.GetString(_editor, prompt, defaultValue);
        return result.Status == PromptStatus.OK ? result.StringResult : null;
    }
}

// å®ä½“ä»“å‚¨
public interface IEntityRepository
{
    void Add(Entity entity);
    void Update(Entity entity);
    void Remove(ObjectId entityId);
    T GetById<T>(ObjectId id) where T : Entity;
    IEnumerable<T> GetAll<T>() where T : Entity;
}

public class EntityRepository : IEntityRepository
{
    public void Add(Entity entity)
    {
        using (var tr = new DBTrans())
        {
            tr.CurrentSpace.AddEntity(entity);
            tr.Commit();
        }
    }

    public void Update(Entity entity)
    {
        using (var tr = new DBTrans())
        {
            var dbEntity = tr.GetObject<Entity>(entity.ObjectId, OpenMode.ForWrite);
            // æ›´æ–°å±æ€§
            tr.Commit();
        }
    }

    public void Remove(ObjectId entityId)
    {
        using (var tr = new DBTrans())
        {
            var entity = tr.GetObject<Entity>(entityId, OpenMode.ForWrite);
            entity.Erase();
            tr.Commit();
        }
    }

    public T GetById<T>(ObjectId id) where T : Entity
    {
        using (var tr = new DBTrans())
        {
            return tr.GetObject<T>(id);
        }
    }

    public IEnumerable<T> GetAll<T>() where T : Entity
    {
        using (var tr = new DBTrans())
        {
            return tr.CurrentSpace.GetEntities<T>();
        }
    }
}
```

### å†…å­˜ç®¡ç†

#### 1. å¤§æ•°æ®å¤„ç†

```csharp
// åˆ†æ‰¹å¤„ç†å¤§é‡æ•°æ®
public class LargeDataProcessor
{
    private const int BATCH_SIZE = 1000;

    public void ProcessLargeEntitySet(IEnumerable<ObjectId> entityIds)
    {
        var batches = entityIds.Batch(BATCH_SIZE);
        var processedCount = 0;

        foreach (var batch in batches)
        {
            ProcessBatch(batch);
            processedCount += batch.Count();

            // å®šæœŸæŠ¥å‘Šè¿›åº¦
            if (processedCount % (BATCH_SIZE * 10) == 0)
            {
                EditorEx.WriteMessage($"å·²å¤„ç† {processedCount} ä¸ªå®ä½“...");

                // å¼ºåˆ¶åƒåœ¾å›æ”¶ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
                GC.Collect();
                GC.WaitForPendingFinalizers();
            }
        }

        EditorEx.WriteMessage($"å¤„ç†å®Œæˆï¼Œæ€»è®¡ {processedCount} ä¸ªå®ä½“ã€‚");
    }

    private void ProcessBatch(IEnumerable<ObjectId> batch)
    {
        using (var tr = new DBTrans())
        {
            foreach (var id in batch)
            {
                try
                {
                    var entity = tr.GetObject<Entity>(id, OpenMode.ForWrite);
                    // å¤„ç†å®ä½“
                    ProcessEntity(entity);
                }
                catch (Exception ex)
                {
                    // è®°å½•é”™è¯¯ä½†ç»§ç»­å¤„ç†å…¶ä»–å®ä½“
                    Console.WriteLine($"å¤„ç†å®ä½“ {id} æ—¶å‡ºé”™: {ex.Message}");
                }
            }
            tr.Commit();
        }
    }

    private void ProcessEntity(Entity entity)
    {
        // å…·ä½“çš„å®ä½“å¤„ç†é€»è¾‘
        switch (entity)
        {
            case Line line:
                ProcessLine(line);
                break;
            case Circle circle:
                ProcessCircle(circle);
                break;
            // å…¶ä»–å®ä½“ç±»å‹...
        }
    }
}

// LINQæ‰©å±•ï¼šåˆ†æ‰¹å¤„ç†
public static class EnumerableExtensions
{
    public static IEnumerable<IEnumerable<T>> Batch<T>(this IEnumerable<T> source, int batchSize)
    {
        var batch = new List<T>(batchSize);
        foreach (var item in source)
        {
            batch.Add(item);
            if (batch.Count == batchSize)
            {
                yield return batch;
                batch = new List<T>(batchSize);
            }
        }

        if (batch.Count > 0)
        {
            yield return batch;
        }
    }
}
```

#### 2. èµ„æºç›‘æ§

```csharp
// å†…å­˜ä½¿ç”¨ç›‘æ§
public class MemoryMonitor
{
    private static readonly Timer _timer;
    private static long _lastMemoryUsage;

    static MemoryMonitor()
    {
        _timer = new Timer(CheckMemoryUsage, null, TimeSpan.FromMinutes(1), TimeSpan.FromMinutes(1));
    }

    private static void CheckMemoryUsage(object state)
    {
        var currentMemory = GC.GetTotalMemory(false);
        var memoryInMB = currentMemory / 1024 / 1024;

        if (memoryInMB > 500) // è¶…è¿‡500MBæ—¶è­¦å‘Š
        {
            Console.WriteLine($"å†…å­˜ä½¿ç”¨è­¦å‘Š: {memoryInMB} MB");

            if (memoryInMB > 1000) // è¶…è¿‡1GBæ—¶å¼ºåˆ¶å›æ”¶
            {
                GC.Collect();
                GC.WaitForPendingFinalizers();
                GC.Collect();

                var afterGC = GC.GetTotalMemory(false) / 1024 / 1024;
                Console.WriteLine($"åƒåœ¾å›æ”¶åå†…å­˜: {afterGC} MB");
            }
        }

        _lastMemoryUsage = currentMemory;
    }

    public static void LogMemoryUsage(string context)
    {
        var memory = GC.GetTotalMemory(false) / 1024 / 1024;
        Console.WriteLine($"[{context}] å†…å­˜ä½¿ç”¨: {memory} MB");
    }
}
```

## å…³é”®è¯ç´¢å¼•

### A-C
- **APIå°è£…** â†’ [PInvokeUser32](#pinvokeuser32-ç³»ç»Ÿapiå°è£…ç±»), [WindowsAPI](#windowsapi-ç³»ç»Ÿå·¥å…·ç±»)
- **AutoCAD** â†’ [EditorEx](#ç¼–è¾‘å™¨æ‰©å±•-editorex), [EntityEx](#å®ä½“æ“ä½œ-entityex)
- **Arrayæ•°ç»„** â†’ [ArrayEx](#arrayex-æ•°ç»„æ‰©å±•ç±»)
- **Associationå…³è”** â†’ [AssocPersSubentityIdPEEx](#å…³è”å­å®ä½“æ‰©å±•-assocperssubentityidpeex), [AssocUtils](#å…³è”åŠ¨ä½œå·¥å…·-assocutils)
- **Batchæ‰¹å¤„ç†** â†’ [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- **Circleåœ†** â†’ [CircleEx](#å®ä½“æ“ä½œ-entityex)
- **Configurationé…ç½®** â†’ [QuadTreeEvn](#quadtreeevn-å››å‰æ ‘ç¯å¢ƒå˜é‡)
- **Coordinateåæ ‡** â†’ [CoordinateSystemCode](#coordinatesystemcode-åæ ‡ç³»ç±»å‹)

### D-H
- **Databaseæ•°æ®åº“** â†’ [DatabaseEx](#æ•°æ®åº“æ‰©å±•-databaseex), [DBTrans](#äº‹åŠ¡ç®¡ç†-dbtrans)
- **Debugè°ƒè¯•** â†’ [DebugEx](#debugex-è°ƒè¯•å·¥å…·ç±»)
- **Documentæ–‡æ¡£** â†’ [DocumentLockManager](#æ–‡æ¡£é”ç®¡ç†å™¨-documentlockmanager)
- **DWGæ–‡ä»¶** â†’ [DwgMark](#dwgæ–‡ä»¶æ ‡è®°ç®¡ç†-dwgmark)
- **Editorç¼–è¾‘å™¨** â†’ [EditorEx](#ç¼–è¾‘å™¨æ‰©å±•-editorex)
- **Entityå®ä½“** â†’ [EntityEx](#å®ä½“æ“ä½œ-entityex)
- **Enumæšä¸¾** â†’ [EnumEx](#enumex-æšä¸¾æ‰©å±•ç±»)
- **Erroré”™è¯¯** â†’ [ErrorInfoEx](#cadé”™è¯¯ä¿¡æ¯å¤„ç†-errorinfoex), [GetPeMethodException](#peæ–¹æ³•ä¸“ç”¨å¼‚å¸¸ç±»)
- **Exceptionå¼‚å¸¸** â†’ [GetPeMethodException](#peæ–¹æ³•ä¸“ç”¨å¼‚å¸¸ç±»)
- **Fontå­—ä½“** â†’ [FontTTF](#fontttf-å­—ä½“ç±»å‹æšä¸¾)
- **Hatchå¡«å……** â†’ [HatchEx](#å¡«å……æ‰©å±•-hatchex)

### I-P
- **Indexç´¢å¼•** â†’ [QuadTree](#å››å‰æ ‘-quadtree)
- **Inputè¾“å…¥** â†’ [EditorEx](#ç¼–è¾‘å™¨æ‰©å±•-editorex)
- **Jigå¤¹ç‚¹** â†’ [JigEx](#å¤¹ç‚¹æ“ä½œ-jigex)
- **LINQ** â†’ [LinqEx](#linqex-linqæ‰©å±•ç±»)
- **Lineç›´çº¿** â†’ [EntityEx](#å®ä½“æ“ä½œ-entityex)
- **Liståˆ—è¡¨** â†’ [LoopList](#looplist-ç¯é“¾è¡¨ç±»)
- **Locké”å®š** â†’ [DocumentLockManager](#æ–‡æ¡£é”ç®¡ç†å™¨-documentlockmanager)
- **Loopå¾ªç¯** â†’ [LoopList](#looplist-ç¯é“¾è¡¨ç±»)
- **Memoryå†…å­˜** â†’ [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- **PEæ–‡ä»¶** â†’ [PeInfo](#peæ–‡ä»¶ä¿¡æ¯åˆ†æç³»ç»Ÿ), [AcadPeInfo](#peæ–‡ä»¶ä¿¡æ¯åˆ†æç³»ç»Ÿ)
- **Performanceæ€§èƒ½** â†’ [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ), [QuadTree](#å››å‰æ ‘-quadtree)
- **Pointç‚¹** â†’ [EditorEx](#ç¼–è¾‘å™¨æ‰©å±•-editorex)
- **Polylineå¤šæ®µçº¿** â†’ [PolylineEx](#å®ä½“æ“ä½œ-entityex)

### Q-Z
- **QuadTreeå››å‰æ ‘** â†’ [QuadTree](#å››å‰æ ‘-quadtree), [QuadTreeEvn](#quadtreeevn-å››å‰æ ‘ç¯å¢ƒå˜é‡)
- **QueryæŸ¥è¯¢** â†’ [QuadTree](#å››å‰æ ‘-quadtree)
- **Randoméšæœº** â†’ [RandomEx](#randomex-éšæœºæ•°æ‰©å±•ç±»)
- **Selectioné€‰æ‹©** â†’ [SelectionSetEx](#é€‰æ‹©é›†æ‰©å±•-selectionsetex)
- **Spatialç©ºé—´** â†’ [QuadTree](#å››å‰æ ‘-quadtree)
- **Systemç³»ç»Ÿ** â†’ [SystemEx](#systemex-ç³»ç»Ÿæ‰©å±•ç±»)
- **Transactionäº‹åŠ¡** â†’ [DBTrans](#äº‹åŠ¡ç®¡ç†-dbtrans)
- **UIç•Œé¢** â†’ [PaneMarginType](#panemargintype-æ‰˜ç›˜è¾¹è·ç±»å‹)
- **Userç”¨æˆ·** â†’ [EditorEx](#ç¼–è¾‘å™¨æ‰©å±•-editorex)
- **ValidationéªŒè¯** â†’ [ArgumentNullEx](#argumentnullex-å‚æ•°éªŒè¯ç±»)
- **Windows** â†’ [PInvokeUser32](#pinvokeuser32-ç³»ç»Ÿapiå°è£…ç±»), [WindowsAPI](#windowsapi-ç³»ç»Ÿå·¥å…·ç±»)
- **Xrefå¤–éƒ¨å‚ç…§** â†’ [XrefModes](#xrefmodes-å¤–éƒ¨å‚ç…§æ¨¡å¼)

## æ–¹æ³•ç´¢å¼•

### å¸¸ç”¨æ–¹æ³•å¿«é€ŸæŸ¥æ‰¾

#### å®ä½“æ“ä½œæ–¹æ³•
- **åˆ›å»ºå®ä½“** â†’ `tr.CurrentSpace.AddEntity()` - [DBTrans](#äº‹åŠ¡ç®¡ç†-dbtrans)
- **ç§»åŠ¨å®ä½“** â†’ `EntityEx.Move()` - [EntityEx](#å®ä½“æ“ä½œ-entityex)
- **æ—‹è½¬å®ä½“** â†’ `EntityEx.Rotate()` - [EntityEx](#å®ä½“æ“ä½œ-entityex)
- **ç¼©æ”¾å®ä½“** â†’ `EntityEx.Scale()` - [EntityEx](#å®ä½“æ“ä½œ-entityex)
- **é•œåƒå®ä½“** â†’ `EntityEx.Mirror()` - [EntityEx](#å®ä½“æ“ä½œ-entityex)
- **å¤åˆ¶å®ä½“** â†’ `EntityEx.Copy()` - [EntityEx](#å®ä½“æ“ä½œ-entityex)

#### ç”¨æˆ·äº¤äº’æ–¹æ³•
- **è·å–ç‚¹** â†’ `EditorEx.GetPoint()` - [EditorEx](#ç¼–è¾‘å™¨æ‰©å±•-editorex)
- **è·å–è·ç¦»** â†’ `EditorEx.GetDistance()` - [EditorEx](#ç¼–è¾‘å™¨æ‰©å±•-editorex)
- **è·å–è§’åº¦** â†’ `EditorEx.GetAngle()` - [EditorEx](#ç¼–è¾‘å™¨æ‰©å±•-editorex)
- **è·å–å­—ç¬¦ä¸²** â†’ `EditorEx.GetString()` - [EditorEx](#ç¼–è¾‘å™¨æ‰©å±•-editorex)
- **é€‰æ‹©å®ä½“** â†’ `EditorEx.GetSelection()` - [EditorEx](#ç¼–è¾‘å™¨æ‰©å±•-editorex)
- **å†™å…¥æ¶ˆæ¯** â†’ `EditorEx.WriteMessage()` - [EditorEx](#ç¼–è¾‘å™¨æ‰©å±•-editorex)

#### ç©ºé—´æŸ¥è¯¢æ–¹æ³•
- **æ’å…¥å¯¹è±¡** â†’ `QuadTree.Insert()` - [QuadTree](#å››å‰æ ‘-quadtree)
- **æŸ¥è¯¢åŒºåŸŸ** â†’ `QuadTree.Query()` - [QuadTree](#å››å‰æ ‘-quadtree)
- **æŸ¥æ‰¾é‚»å±…** â†’ `QuadTree.FindNeibor()` - [QuadTree](#å››å‰æ ‘-quadtree)
- **ç§»é™¤å¯¹è±¡** â†’ `QuadTree.Remove()` - [QuadTree](#å››å‰æ ‘-quadtree)
- **æ¸…ç©ºæ ‘** â†’ `QuadTree.Clear()` - [QuadTree](#å››å‰æ ‘-quadtree)

#### æ•°æ®åº“æ“ä½œæ–¹æ³•
- **å¼€å§‹äº‹åŠ¡** â†’ `new DBTrans()` - [DBTrans](#äº‹åŠ¡ç®¡ç†-dbtrans)
- **æäº¤äº‹åŠ¡** â†’ `tr.Commit()` - [DBTrans](#äº‹åŠ¡ç®¡ç†-dbtrans)
- **è·å–å¯¹è±¡** â†’ `tr.GetObject<T>()` - [DBTrans](#äº‹åŠ¡ç®¡ç†-dbtrans)
- **è·å–å®ä½“** â†’ `tr.CurrentSpace.GetEntities<T>()` - [DBTrans](#äº‹åŠ¡ç®¡ç†-dbtrans)
- **åˆ‡æ¢æ•°æ®åº“** â†’ `new SwitchDatabase()` - [æ•°æ®åº“åˆ‡æ¢](#æ•°æ®åº“åˆ‡æ¢-switchdatabase)

#### å¡«å……æ“ä½œæ–¹æ³•
- **åˆ›å»ºå¡«å……** â†’ `HatchEx.CreateHatch()` - [HatchEx](#å¡«å……æ‰©å±•-hatchex)
- **è®¾ç½®è¾¹ç•Œ** â†’ `HatchEx.SetBoundary()` - [HatchEx](#å¡«å……æ‰©å±•-hatchex)
- **è·å–è¾¹ç•Œ** â†’ `HatchEx.GetAssociatedBoundaryIds()` - [HatchEx](#å¡«å……æ‰©å±•-hatchex)
- **é‡ç½®è¾¹ç•Œ** â†’ `HatchEx.ResetBoundarys()` - [HatchEx](#å¡«å……æ‰©å±•-hatchex)

#### å·¥å…·ç±»æ–¹æ³•
- **æ•°ç»„åˆå¹¶** â†’ `ArrayEx.Combine2()` - [ArrayEx](#arrayex-æ•°ç»„æ‰©å±•ç±»)
- **æ•°ç»„å»é‡** â†’ `ArrayEx.Deduplication()` - [ArrayEx](#arrayex-æ•°ç»„æ‰©å±•ç±»)
- **æŸ¥æ‰¾æœ€å¤§å€¼** â†’ `LinqEx.FindByMax()` - [LinqEx](#linqex-linqæ‰©å±•ç±»)
- **æŸ¥æ‰¾æœ€å°å€¼** â†’ `LinqEx.FindByMin()` - [LinqEx](#linqex-linqæ‰©å±•ç±»)
- **ç¯é“¾è¡¨æ·»åŠ ** â†’ `LoopList.Add()` - [LoopList](#looplist-ç¯é“¾è¡¨ç±»)
- **ç¯é“¾è¡¨éå†** â†’ `LoopList.ForEach()` - [LoopList](#looplist-ç¯é“¾è¡¨ç±»)

### æŒ‰åŠŸèƒ½åˆ†ç±»çš„æ–¹æ³•ç´¢å¼•

#### ğŸ—ï¸ åŸºç¡€è®¾æ–½æ–¹æ³•
```
DBTrans:
â”œâ”€â”€ æ„é€ å‡½æ•°: new DBTrans(), new DBTrans(Database)
â”œâ”€â”€ äº‹åŠ¡ç®¡ç†: Commit(), Abort(), Dispose()
â”œâ”€â”€ å¯¹è±¡è·å–: GetObject<T>(), GetObjects<T>()
â”œâ”€â”€ å®ä½“æ“ä½œ: CurrentSpace.AddEntity(), CurrentSpace.GetEntities<T>()
â””â”€â”€ è¡¨è®¿é—®: BlockTable, LayerTable, TextStyleTable

DocumentLockManager:
â”œâ”€â”€ é”å®šç®¡ç†: LockDocument(), UnlockDocument()
â”œâ”€â”€ çŠ¶æ€æ£€æŸ¥: IsLocked(), GetLockStatus()
â””â”€â”€ æ‰¹é‡æ“ä½œ: ExecuteInLock()
```

#### ğŸ“ å®ä½“æ“ä½œæ–¹æ³•
```
EntityEx:
â”œâ”€â”€ å˜æ¢æ“ä½œ: Move(), Rotate(), Scale(), Mirror()
â”œâ”€â”€ å¤åˆ¶æ“ä½œ: Copy(), CopyTo()
â”œâ”€â”€ å±æ€§è®¾ç½®: SetLayer(), SetColor(), SetLinetype()
â””â”€â”€ å‡ ä½•è®¡ç®—: GetBounds(), GetCenter()

HatchEx:
â”œâ”€â”€ åˆ›å»ºå¡«å……: CreateHatch(), CreateBoundaryHatch()
â”œâ”€â”€ è¾¹ç•Œç®¡ç†: SetBoundary(), GetAssociatedBoundaryIds()
â”œâ”€â”€ æ ·å¼è®¾ç½®: SetPattern(), SetScale()
â””â”€â”€ å…³è”æ€§: ResetBoundarys(), UpdateAssociativity()
```

#### ğŸ–±ï¸ ç”¨æˆ·äº¤äº’æ–¹æ³•
```
EditorEx:
â”œâ”€â”€ ç‚¹è¾“å…¥: GetPoint(), GetCorner(), GetDistance()
â”œâ”€â”€ é€‰æ‹©æ“ä½œ: GetSelection(), GetEntity(), GetKeywords()
â”œâ”€â”€ è¾“å…¥è·å–: GetString(), GetInteger(), GetDouble()
â”œâ”€â”€ è§†å›¾æ§åˆ¶: ZoomExtents(), ZoomWindow(), ZoomPrevious()
â””â”€â”€ æ¶ˆæ¯è¾“å‡º: WriteMessage(), UpdateScreen()

JigEx:
â”œâ”€â”€ å¤¹ç‚¹åˆ›å»º: CreateJig(), StartJig()
â”œâ”€â”€ åŠ¨æ€é¢„è§ˆ: UpdatePreview(), GetDynamicDimension()
â””â”€â”€ ç”¨æˆ·äº¤äº’: GetPoint(), GetAngle(), GetDistance()
```

#### ğŸ” ç©ºé—´æŸ¥è¯¢æ–¹æ³•
```
QuadTree<T>:
â”œâ”€â”€ æ„å»ºæ“ä½œ: Insert(), InsertRange()
â”œâ”€â”€ æŸ¥è¯¢æ“ä½œ: Query(), QueryRange(), FindNeibor()
â”œâ”€â”€ ç»´æŠ¤æ“ä½œ: Remove(), Clear(), Rebuild()
â””â”€â”€ ç»Ÿè®¡ä¿¡æ¯: Count(), GetDepth(), GetBounds()
```

#### ğŸ› ï¸ å·¥å…·ç±»æ–¹æ³•
```
ArrayEx:
â”œâ”€â”€ åˆå¹¶æ“ä½œ: Combine2(), CombineMultiple()
â”œâ”€â”€ å»é‡æ“ä½œ: Deduplication(), DeduplicationBy()
â””â”€â”€ è½¬æ¢æ“ä½œ: ToArray(), ToList()

LinqEx:
â”œâ”€â”€ æŸ¥æ‰¾æ“ä½œ: FindByMax(), FindByMin(), FindByCondition()
â”œâ”€â”€ æ’åºæ“ä½œ: SortBy(), OrderByMultiple()
â””â”€â”€ åˆ†ç»„æ“ä½œ: GroupByKey(), PartitionBy()

LoopList<T>:
â”œâ”€â”€ æ·»åŠ æ“ä½œ: Add(), Insert(), AddRange()
â”œâ”€â”€ åˆ é™¤æ“ä½œ: Remove(), RemoveAt(), Clear()
â”œâ”€â”€ æŸ¥æ‰¾æ“ä½œ: Find(), FindAll(), Contains()
â”œâ”€â”€ éå†æ“ä½œ: ForEach(), ForEachReverse()
â””â”€â”€ è½¬æ¢æ“ä½œ: ToArray(), ToList(), Reverse()
```

## äº¤å‰å¼•ç”¨è¡¨

### ç±»ä¸æšä¸¾çš„å…³ç³»
| ç±»å | ç›¸å…³æšä¸¾ | ç”¨é€” |
|------|----------|------|
| QuadTree | QuadTreeSelectMode, QuadTreeFindMode | æŸ¥è¯¢æ¨¡å¼æ§åˆ¶ |
| EditorEx | RunLispFlag, SingleKeyWordWorkType | Lispæ‰§è¡Œå’Œäº¤äº’æ¨¡å¼ |
| DatabaseEx | SymModes, XrefModes | ç¬¦å·è¡¨å’Œå¤–éƒ¨å‚ç…§æ“ä½œ |
| PeInfo | AcadPeEnum, GetMethodErrorNum | PEæ–‡ä»¶åˆ†æå’Œé”™è¯¯å¤„ç† |
| DBmodEx | DBmod | æ•°æ®åº“ä¿®æ”¹çŠ¶æ€ç®¡ç† |

### é…ç½®ä¸ç±»çš„å…³ç³»
| é…ç½®ç±» | å½±å“çš„åŠŸèƒ½ç±» | é…ç½®é¡¹ |
|--------|--------------|--------|
| QuadTreeEvn | QuadTree | MinArea, MaxDepth, SplitCount |

### å¼‚å¸¸ä¸å¤„ç†ç±»çš„å…³ç³»
| å¼‚å¸¸ç±» | å¤„ç†ç±» | ç›¸å…³æšä¸¾ |
|--------|--------|----------|
| GetPeMethodException | ErrorInfoEx | GetMethodErrorNum |
| AcException | ErrorInfoEx | - |

---

*æœ¬æ–‡æ¡£åŸºäº IFoxCAD.AutoCAD 0.9.6 ç‰ˆæœ¬ç¼–å†™ï¼Œä¸“ä¸º Context7 AI ä¸Šä¸‹æ–‡å¹³å°ä¼˜åŒ–ï¼Œå¸®åŠ© AI åŠ©æ‰‹æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨è¯¥åº“ååŠ©å¼€å‘è€…è¿›è¡Œ AutoCAD å¼€å‘ä»»åŠ¡ã€‚*
